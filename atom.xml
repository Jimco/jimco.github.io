<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>最前端</title>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://zqianduan.com/"/>
  <updated>2017-04-27T07:01:51.000Z</updated>
  <id>http://zqianduan.com/</id>
  
  <author>
    <name>Jimco</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>浏览器的协商缓存与强缓存</title>
    <link href="http://zqianduan.com/2017/02/28/http-cache/"/>
    <id>http://zqianduan.com/2017/02/28/http-cache/</id>
    <published>2017-02-28T08:50:31.000Z</published>
    <updated>2017-04-27T07:01:51.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="什么是浏览器缓存"><a href="#什么是浏览器缓存" class="headerlink" title="什么是浏览器缓存"></a>什么是浏览器缓存</h2><p><strong>浏览器缓存(Brower Caching)</strong>是浏览器在本地磁盘对用户最近请求过的文档进行存储，当访问者再次访问同一页面时，浏览器就可以直接从本地磁盘加载文档。</p>
<p>浏览器缓存的优点有：</p>
<ol>
<li><p>减少了冗余的数据传输，节省了网费</p>
</li>
<li><p>减少了服务器的负担，大大提升了网站的性能</p>
</li>
<li><p>加快了客户端加载网页的速度</p>
<a id="more"></a>
</li>
</ol>
<h2 id="浏览器缓存的分类"><a href="#浏览器缓存的分类" class="headerlink" title="浏览器缓存的分类"></a>浏览器缓存的分类</h2><p>浏览器缓存主要有两类：<code>缓存协商</code>和<code>彻底缓存</code>，也有称之为<code>协商缓存</code>和<code>强缓存</code>。</p>
<p>浏览器在第一次请求发生后，再次请求时：</p>
<ol>
<li><p>浏览器会先获取该资源缓存的 header 信息，根据其中的 <code>expires</code> 和 <code>cahe-control</code> 判断是否命中强缓存，若命中则直接从缓存中获取资源，包括缓存的 header 信息，本次请求不会与服务器进行通信；</p>
</li>
<li><p>如果没有命中强缓存，浏览器会发送请求到服务器，该请求会携带第一次请求返回的有关缓存的 header 字段信息（<code>Last-Modified/IF-Modified-Since</code>、<code>Etag/IF-None-Match</code>），由服务器根据请求中的相关 header 信息来对比结果是否命中协商缓存，若命中，则服务器返回新的响应 header 信息更新缓存中的对应 header 信息，但是并不返回资源内容，它会告知浏览器可以直接从缓存获取；否则返回最新的资源内容。</p>
</li>
</ol>
<h3 id="强缓存"><a href="#强缓存" class="headerlink" title="强缓存"></a>强缓存</h3><p>强缓存是利用 http 的返回头中的 <code>Expires</code> 或者 <code>Cache-Control</code> 两个字段来控制的，用来表示资源的缓存时间。</p>
<ul>
<li><p><strong>Expires</strong></p>
<p>  该字段是 http1.0 时的规范，它的值为一个绝对时间的 GMT 格式的时间字符串，比如 <code>Expires:Mon,18 Oct 2066 23:59:59 GMT</code>。这个时间代表着这个资源的失效时间，在此时间之前，即命中缓存。这种方式有一个明显的缺点，由于失效时间是一个绝对时间，所以当服务器与客户端时间偏差较大时，就会导致缓存混乱。</p>
</li>
<li><p><strong>Cache-Control</strong></p>
<p>  Cache-Control 是 http1.1 时出现的 header 信息，主要是利用该字段的 max-age 值来进行判断，它是一个相对时间，例如 <code>Cache-Control:max-age=3600</code>，代表着资源的有效期是 3600 秒。cache-control 除了该字段外，还有下面几个比较常用的设置值：</p>
<ul>
<li><p><code>no-cache</code>：不使用本地缓存。需要使用缓存协商，先与服务器确认返回的响应是否被更改，如果之前的响应中存在ETag，那么请求的时候会与服务端验证，如果资源未被更改，则可以避免重新下载。</p>
</li>
<li><p><code>no-store</code>：直接禁止游览器缓存数据，每次用户请求该资源，都会向服务器发送一个请求，每次都会下载完整的资源。</p>
</li>
<li><p><code>public</code>：可以被所有的用户缓存，包括终端用户和 CDN 等中间代理服务器。</p>
</li>
<li><p><code>private</code>：只能被终端用户的浏览器缓存，不允许 CDN 等中继缓存服务器对其缓存。</p>
</li>
</ul>
</li>
</ul>
<p><strong>Cache-Control与Expires可以在服务端配置同时启用，同时启用的时候Cache-Control优先级高。</strong></p>
<h3 id="协商缓存"><a href="#协商缓存" class="headerlink" title="协商缓存"></a>协商缓存</h3><p>协商缓存就是由服务器来确定缓存资源是否可用，所以客户端与服务器端要通过某种标识来进行通信，从而让服务器判断请求资源是否可以缓存访问，这主要涉及到下面两组 header 字段，这两组搭档都是成对出现的，即第一次请求的响应头带上某个字段（<code>Last-Modified</code> 或者 <code>Etag</code>），则后续请求则会带上对应的请求字段（<code>If-Modified-Since</code> 或者 <code>If-None-Match</code>），若响应头没有 Last-Modified 或者 Etag 字段，则请求头也不会有对应的字段。</p>
<ul>
<li><p><strong>Last-Modify/If-Modify-Since</strong></p>
<p>  浏览器第一次请求一个资源的时候，服务器返回的 header 中会加上 Last-Modify，Last-modify 是一个时间标识该资源的最后修改时间，例如 <code>Last-Modify: Thu,31 Dec 2037 23:59:59 GMT</code>。</p>
<p>  当浏览器再次请求该资源时，request 的请求头中会包含 If-Modify-Since，该值为缓存之前返回的 Last-Modify。服务器收到 If-Modify-Since 后，根据资源的最后修改时间判断是否命中缓存。</p>
<p>  如果命中缓存，则返回304，并且不会返回资源内容，并且不会返回 Last-Modify。</p>
</li>
<li><p><strong>ETag/If-None-Match</strong></p>
<p>  与 Last-Modify/If-Modify-Since 不同的是，Etag/If-None-Match 返回的是一个校验码。ETag 可以保证每一个资源是唯一的，资源变化都会导致 ETag 变化。服务器根据浏览器上送的 If-None-Match 值来判断是否命中缓存。</p>
<p>  与 Last-Modified 不一样的是，当服务器返回 304 Not Modified 的响应时，由于 ETag 重新生成过，response header 中还会把这个 ETag 返回，即使这个 ETag 跟之前的没有变化。</p>
</li>
</ul>
<p><strong>为什么要有 Etag</strong></p>
<p>你可能会觉得使用 Last-Modified 已经足以让浏览器知道本地的缓存副本是否足够新，为什么还需要 Etag 呢？HTTP1.1 中 Etag 的出现主要是为了解决几个 Last-Modified 比较难解决的问题：</p>
<ul>
<li><p>一些文件也许会周期性的更改，但是他的内容并不改变(仅仅改变的修改时间)，这个时候我们并不希望客户端认为这个文件被修改了，而重新 GET；</p>
</li>
<li><p>某些文件修改非常频繁，比如在秒以下的时间内进行修改，(比方说 1s 内修改了 N 次)，If-Modified-Since 能检查到的粒度是s级的，这种修改无法判断(或者说 UNIX 记录 MTIME 只能精确到秒)；</p>
</li>
<li><p>某些服务器不能精确的得到文件的最后修改时间。</p>
</li>
</ul>
<p><strong>Last-Modified 与 ETag 是可以一起使用的，服务器会优先验证 ETag，一致的情况下，才会继续比对 Last-Modified，最后才决定是否返回 304。</strong></p>
<p>强缓存与协商缓存的区别可以用下表来表示：</p>
<table>
<thead>
<tr>
<th style="text-align:center">缓存类型</th>
<th style="text-align:center">获取资源形式</th>
<th style="text-align:center">状态码</th>
<th style="text-align:center">发送请求到服务器</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">强缓存</td>
<td style="text-align:center">从缓存取</td>
<td style="text-align:center">200（from cache）</td>
<td style="text-align:center">否，直接从缓存取</td>
</tr>
<tr>
<td style="text-align:center">协商缓存</td>
<td style="text-align:center">从缓存取</td>
<td style="text-align:center">304（Not Modified）</td>
<td style="text-align:center">否，通过服务器来告知缓存是否可用</td>
</tr>
</tbody>
</table>
<h2 id="用户行为对缓存的影响"><a href="#用户行为对缓存的影响" class="headerlink" title="用户行为对缓存的影响"></a>用户行为对缓存的影响</h2><table>
<thead>
<tr>
<th style="text-align:center">用户操作</th>
<th style="text-align:center">Expires/Cache-Control</th>
<th style="text-align:center">Last-Modied/Etag</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">地址栏回车</td>
<td style="text-align:center">有效</td>
<td style="text-align:center">有效</td>
</tr>
<tr>
<td style="text-align:center">页面链接跳转</td>
<td style="text-align:center">有效</td>
<td style="text-align:center">有效</td>
</tr>
<tr>
<td style="text-align:center">新开窗口</td>
<td style="text-align:center">有效</td>
<td style="text-align:center">有效</td>
</tr>
<tr>
<td style="text-align:center">前进回退</td>
<td style="text-align:center">有效</td>
<td style="text-align:center">有效</td>
</tr>
<tr>
<td style="text-align:center">F5刷新</td>
<td style="text-align:center">无效</td>
<td style="text-align:center">有效</td>
</tr>
<tr>
<td style="text-align:center">Ctrl+F5强制刷新</td>
<td style="text-align:center">无效</td>
<td style="text-align:center">无效</td>
</tr>
</tbody>
</table>
<h3 id="参考资料："><a href="#参考资料：" class="headerlink" title="参考资料："></a>参考资料：</h3><ul>
<li><a href="http://louiszhai.github.io/2017/04/07/http-cache/" target="_blank" rel="external">浏览器缓存机制剖析</a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;什么是浏览器缓存&quot;&gt;&lt;a href=&quot;#什么是浏览器缓存&quot; class=&quot;headerlink&quot; title=&quot;什么是浏览器缓存&quot;&gt;&lt;/a&gt;什么是浏览器缓存&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;浏览器缓存(Brower Caching)&lt;/strong&gt;是浏览器在本地磁盘对用户最近请求过的文档进行存储，当访问者再次访问同一页面时，浏览器就可以直接从本地磁盘加载文档。&lt;/p&gt;
&lt;p&gt;浏览器缓存的优点有：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;减少了冗余的数据传输，节省了网费&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;减少了服务器的负担，大大提升了网站的性能&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;加快了客户端加载网页的速度&lt;/p&gt;
    
    </summary>
    
      <category term="Server" scheme="http://zqianduan.com/categories/Server/"/>
    
    
      <category term="http" scheme="http://zqianduan.com/tags/http/"/>
    
      <category term="cache" scheme="http://zqianduan.com/tags/cache/"/>
    
      <category term="browser" scheme="http://zqianduan.com/tags/browser/"/>
    
  </entry>
  
  <entry>
    <title>开发机 samba 安装指南</title>
    <link href="http://zqianduan.com/2017/01/04/dev-server-samba/"/>
    <id>http://zqianduan.com/2017/01/04/dev-server-samba/</id>
    <published>2017-01-04T04:03:44.000Z</published>
    <updated>2017-04-27T07:01:51.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>简介：Samba 是在 Linux 和 UNIX 系统上实现 SMB 协议的一个免费软件，由服务器及客户端程序构成。SMB（Server Messages Block，信息服务块）是一种在局域网上共享文件和打印机的一种通信协议，它为局域网内的不同计算机之间提供文件及打印机等资源的共享服务。</p>
</blockquote>
<p><strong>注意：要安装samba必须有 root 权限，没有权限可以找相关同学申请。</strong></p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><ul>
<li><p>下载 samba-3.5.8.tar.gz 到 /home/work/(此处可以用自己指定 path)</p>
<p>  <code>wget &quot;http://hetu.baidu.com:80/api/tool/getFile?toolId=1145&amp;fileId=925&quot; -O &quot;samba-3.5.8.tar.gz&quot;</code></p>
</li>
<li><p>解压 <code>tar zxvf samba-3.5.8.tar.gz</code></p>
</li>
<li><p>执行 <code>cd samba-3.5.8/source3</code></p>
</li>
<li><p>执行 <code>./configure &amp;&amp; make -j 4</code></p>
</li>
<li><p>执行 <code>make install</code></p>
<a id="more"></a>
</li>
</ul>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><ul>
<li><p>执行 <code>cd /usr/local/samba/</code> (默认安装到该路径下)</p>
</li>
<li><p>执行 <code>vi lib/smb.conf</code> (将下面内容粘贴到 smb.conf)</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">[global]</div><div class="line">diplay charset = utf8</div><div class="line">unix charset = gbk</div><div class="line">dos charset = gbk</div><div class="line">workgroup = work</div><div class="line">netbios name = work</div><div class="line">server string = uc</div><div class="line">security = user</div><div class="line"></div><div class="line">[aswork]</div><div class="line">comment = uc</div><div class="line">path = /home/work</div><div class="line">create mask = 0664</div><div class="line">directory mask = 0775</div><div class="line">writable = yes</div><div class="line">valid users = work // 用户登录名称</div><div class="line">browseable = yes</div></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>配置项说明：</strong></p>
<ul>
<li><p><code>[global]</code>: 标识全局配置，前三行是对编码的配置</p>
</li>
<li><p><code>workgroup</code>: 设置服务器所要加入的工作组的名称，会在 Windows 的”网上邻居”中能看到 work 工作组，可以在此设置所需要的工作组的名称。 </p>
</li>
<li><p><code>netbios name</code>: 设置出现在”网上邻居”中的主机名，默认情况下，则使用真正的主机名。 </p>
</li>
<li><p><code>server string</code>: 设置服务器主机的说明信息，当在 Windows 的”网上邻居”中打开 Samba 上设置的工作组时，在 Windows 的资源管理器窗口，会列出”名称”和”备注”栏，其中”名称”栏会显示出 Samba 服务器的 NetBios 名称，而”备注”栏则显示出此处设置的”Samba Server”。当然，可以修改默认的”Sambe Server”，使用自己的描述信息。</p>
</li>
<li><p><code>security</code>: 设置 Samba 服务器的安全等级，默认情况下，使用 user 等级。 </p>
<p>  Samba服务器一共有四种安全等级：</p>
<p>  (1) share: 使用此等级，用户不需要帐号及密码可以登陆Samba服务器。<br>  (2) user: 使用此等级，由提供服务的Samba服务器检查用户帐号及密码。<br>  (3) server: 使用此等级，检查帐号及密码的工作可指定另一台Samba服务器负责。<br>  (4) domain: 使用此等级，需要指定一台 Windows NT/2000/XP 服务器（通常为域控制器），以验证用户输入的帐号及密码。</p>
</li>
<li><p><code>[aswork]</code>: 标识 Samba 文件共享配置（中括号中名称任意）。</p>
</li>
<li><p><code>comment</code>: 针对共享资源所作的说明、注释部分。</p>
</li>
<li><p><code>path</code>: 若共享资源是目录，则指定目录的位置；若为打印机，则指定打印机队列的位置。</p>
</li>
<li><p><code>create mask</code>: 设置文件的访问权限，默认值为0744。 </p>
</li>
<li><p><code>directory mask</code>: 设置目录的访问权限，默认值为0755。 </p>
</li>
<li><p><code>writeable</code>: 设置共享的资源是否可以写入。若共享资源是打印机，则不需设置此参数。 </p>
</li>
<li><p><code>valid users</code>: 设置合法用户名。 </p>
</li>
<li><p><code>browseable</code>: 设置用户是否可以看到此共享资源。默认值为 yes，若将此参数设置为 no，用户虽然看不到此资源，但是拥有权限的用户仍可直接输入该资源的网址来访问该资源。</p>
</li>
</ul>
<h2 id="启动和使用-Samba"><a href="#启动和使用-Samba" class="headerlink" title="启动和使用 Samba"></a>启动和使用 Samba</h2><ol>
<li><p>执行 <code>vi ~/.bash_profile</code> （在文件里添加如下内容）</p>
<p> <code>export LD_LIBRARY_PATH=/usr/local/samba/lib:$LD_LIBRARY_PATH</code></p>
<p> 保存退出； </p>
</li>
<li><p>执行 <code>. ~/.bash_profile</code></p>
</li>
<li><p>执行 <code>./bin/smbpasswd -a work</code> (设置work的密码) </p>
</li>
<li><p>执行 <code>cd /usr/local/samba/sbin</code></p>
</li>
<li><p>执行 <code>./smbd -D</code> (启动samba) </p>
</li>
<li><p><code>ps auxf | grep smbd</code> 查看进程是否启动，<code>netstat -npl</code> 查看 samba 端口号，默认会使用139、445两个端口号 </p>
</li>
<li><p>Windows 下 win+r 运行框中输入 <code>\\{IP} 地址</code> (Mac 下 cmd+k 输入 <code>smb://{IP}</code>)，输入配置的用户名、密码即可访问（windows 下可将目录映射为网络驱动器）</p>
</li>
<li><p>修改配置后需重启 Samba 服务 <code>/usr/local/samba/sbin/smbd restart</code></p>
</li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;简介：Samba 是在 Linux 和 UNIX 系统上实现 SMB 协议的一个免费软件，由服务器及客户端程序构成。SMB（Server Messages Block，信息服务块）是一种在局域网上共享文件和打印机的一种通信协议，它为局域网内的不同计算机之间提供文件及打印机等资源的共享服务。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;注意：要安装samba必须有 root 权限，没有权限可以找相关同学申请。&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&quot;安装&quot;&gt;&lt;a href=&quot;#安装&quot; class=&quot;headerlink&quot; title=&quot;安装&quot;&gt;&lt;/a&gt;安装&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;下载 samba-3.5.8.tar.gz 到 /home/work/(此处可以用自己指定 path)&lt;/p&gt;
&lt;p&gt;  &lt;code&gt;wget &amp;quot;http://hetu.baidu.com:80/api/tool/getFile?toolId=1145&amp;amp;fileId=925&amp;quot; -O &amp;quot;samba-3.5.8.tar.gz&amp;quot;&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;解压 &lt;code&gt;tar zxvf samba-3.5.8.tar.gz&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;执行 &lt;code&gt;cd samba-3.5.8/source3&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;执行 &lt;code&gt;./configure &amp;amp;&amp;amp; make -j 4&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;执行 &lt;code&gt;make install&lt;/code&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Server" scheme="http://zqianduan.com/categories/Server/"/>
    
    
      <category term="samba" scheme="http://zqianduan.com/tags/samba/"/>
    
  </entry>
  
  <entry>
    <title>Javascript this 解析</title>
    <link href="http://zqianduan.com/2016/12/19/javascript-this/"/>
    <id>http://zqianduan.com/2016/12/19/javascript-this/</id>
    <published>2016-12-19T14:42:18.000Z</published>
    <updated>2017-04-27T07:01:51.000Z</updated>
    
    <content type="html"><![CDATA[<p>在 Javascript 里，函数被调用的时候，除了接受声明时定义的形式参数，每一个函数还接受两个附加的参数: this 和 arguments。随着函数使用场合的不同，this 的值会发生变化。但是有一个总的原则，那就是 this 指的是，调用函数的那个对象。<br><a id="more"></a><br>下面分四种情况，具体讨论 this 的用法：</p>
<ol>
<li><p>对象方法调用模式</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">window</span>.name= <span class="string">'window'</span>; </div><div class="line"><span class="keyword">var</span> object = &#123;</div><div class="line">    <span class="attr">name</span>: <span class="string">'object'</span>, </div><div class="line">    <span class="attr">run</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line">object.run();   <span class="comment">// 'object'</span></div></pre></td></tr></table></figure>
<p> <strong>分析：</strong>当一个函数被保存为对象的一个属性时，我们称它为一个方法。当方法被调用时(通过 . 表达式或 object[fun] 下标表达式)，this 绑定到该对象</p>
</li>
<li><p>函数调用模式</p>
<p> 当一个函数并非一个对象的属性时，那么它就是被当做一个函数来调用的，以此模式调用函数时，this 被绑定到全局对象（ECMAScript6 的箭头函数（注意只是箭头函数）基本纠正了这个设计）：</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">window</span>.name= <span class="string">'window'</span>; </div><div class="line"><span class="keyword">var</span> object = &#123;</div><div class="line">    <span class="attr">name</span>: <span class="string">'object'</span>, </div><div class="line">    <span class="attr">run</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        innerFun();</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">innerFun</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">object.run()();</div><div class="line"><span class="comment">// =&gt;</span></div><div class="line"><span class="comment">// 'window'</span></div><div class="line"><span class="comment">// 'window'</span></div></pre></td></tr></table></figure>
<p> <strong>分析：</strong>从上面可以看出，不管外部环境的 this 是不是 window，通过函数调用模式调用的函数，this 指向 window.</p>
<p> 来看看 ES6 的 this:</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">window</span>.name= <span class="string">'window'</span>; </div><div class="line"><span class="keyword">var</span> object = &#123;</div><div class="line">    <span class="attr">name</span>: <span class="string">'object'</span>, </div><div class="line">    <span class="attr">run</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">var</span> o = &#123; <span class="attr">name</span>: <span class="string">'test_o'</span> &#125;;</div><div class="line"></div><div class="line">object.run()();         <span class="comment">// 'object'</span></div><div class="line">object.run().apply(o);  <span class="comment">// 'object'</span></div></pre></td></tr></table></figure>
<p> 如果这么写：</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">window</span>.name= <span class="string">'window'</span>; </div><div class="line"><span class="keyword">var</span> object = &#123;</div><div class="line">    <span class="attr">name</span>: <span class="string">'object'</span>, </div><div class="line">    <span class="attr">run</span>: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">var</span> o = &#123; <span class="attr">name</span>: <span class="string">'test_o'</span> &#125;;</div><div class="line"></div><div class="line">object.run();           <span class="comment">// 'window'</span></div><div class="line">object.run.apply(o);    <span class="comment">// 'window'</span></div></pre></td></tr></table></figure>
<p> <strong>分析：箭头函数和普通函数之间有一个重要的差别 - 箭头函数没有自己的 this 值，其 this 值是继承外域的 this 值。所以箭头函数不仅仅是从外观上简化了函数的写法，更解决了普通函数中 this 的 hack 问题。</strong></p>
</li>
<li><p>构造函数调用模式</p>
<p> 当一个函数被作为一个构造函数来使用（使用new关键字），它的 this 与即将被创建的新对象绑定。</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">C</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">this</span>.a = <span class="number">37</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> o = <span class="keyword">new</span> C();</div><div class="line"><span class="built_in">console</span>.log(o.a); <span class="comment">// 37</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">C2</span>(<span class="params"></span>)</span>&#123;</div><div class="line">      <span class="keyword">this</span>.a = <span class="number">37</span>;</div><div class="line">      <span class="keyword">return</span> &#123;<span class="attr">a</span>:<span class="number">38</span>&#125;;</div><div class="line">&#125;</div><div class="line"></div><div class="line">o = <span class="keyword">new</span> C2();</div><div class="line"><span class="built_in">console</span>.log(o.a); <span class="comment">// 38</span></div></pre></td></tr></table></figure>
<p> <strong>注意：</strong>当构造器返回的默认值是一个 this 引用的对象时，可以手动设置返回其他的对象，如果返回值不是一个对象，返回 this。</p>
</li>
<li><p>call, apply, bind 调用</p>
<p> call, apply 方法的用途都是在特定的作用域中调用函数。apply 方法接收两个参数：一个是在其中运行函数的作用域，另一个是参数数组。其中，第二个参数可以是 Array 的实例，也可以是 arguments 对象。call 方法与 apply 方法的作用相同，它们的区别仅在于接收参数的方式不同。对于 call 方法而言，第一个参数是 this 值没有变化，变化的是其余参数都直接传递给函数</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.a);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> o = &#123;&#125;;</div><div class="line">o.a = <span class="number">2</span>;</div><div class="line">o.fun = test;</div><div class="line"></div><div class="line">o.fun.apply(o);  <span class="comment">// 1</span></div><div class="line">o.fun.call(o);   <span class="comment">// 1</span></div></pre></td></tr></table></figure>
<p> ECMAScript 5 引入了 Function.prototype.bind。调用f.bind(someObject)会创建一个与f具有相同函数体和作用域的函数，但是在这个新函数中，this将永久地被绑定到了bind的第一个参数，无论这个函数是如何被调用的。</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.a;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> g = f.bind(&#123;<span class="attr">a</span>:<span class="string">"azerty"</span>&#125;);</div><div class="line"><span class="built_in">console</span>.log(g()); <span class="comment">// azerty</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> o = &#123;<span class="attr">a</span>:<span class="number">37</span>, <span class="attr">f</span>:f, <span class="attr">g</span>:g&#125;;</div><div class="line"><span class="built_in">console</span>.log(o.f(), o.g()); <span class="comment">// 37, azerty</span></div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="this-容易误用的情况"><a href="#this-容易误用的情况" class="headerlink" title="this 容易误用的情况"></a>this 容易误用的情况</h3><ol>
<li><p>内联式绑定 Dom 元素的事件处理函数</p>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.tagName);</div><div class="line">    &#125; </div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"btnTest"</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"点击我"</span> <span class="attr">onclick</span>=<span class="string">"hello()"</span>&gt;</span></div></pre></td></tr></table></figure>
<p> 运行结果是 <code>undefined</code>, 此时的 this 指针并不是指向 input 元素，使用内联式绑定 Dom 元素的事件处理函数时，实际 上相当于执行了以下代码：</p>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.tagName);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"btnTest"</span>).onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        hello();</div><div class="line">    &#125;;</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"btnTest"</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"点击我"</span>&gt;</span></div></pre></td></tr></table></figure>
<p> 这种情况下 hello 函数对象的所有权并没有发生转移，还是属于 window 对象所有。因为还是 window 对象在调用 hello 方法</p>
<p> <strong>解决方案：</strong>把 this 作为参数传入函数，或者直接把方法作为对象的一个属性，这样方法中的 this 直接指定的是当前对象</p>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params">el</span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(el.tagName);</div><div class="line">    &#125; </div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"btnTest"</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"点击我"</span> <span class="attr">onclick</span>=<span class="string">"hello(this)"</span>&gt;</span></div></pre></td></tr></table></figure>
<p> 或：</p>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.tagName);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"btnTest"</span>).onclick = hello;</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"btnTest"</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"点击我"</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>临时变量导致的 this 指针丢失</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">window</span>.name= <span class="string">'window'</span>; </div><div class="line"><span class="keyword">var</span> object = &#123;</div><div class="line">    <span class="attr">name</span>: <span class="string">'object'</span>, </div><div class="line">    <span class="attr">run</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">runTest</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> tmpRun = object.run;</div><div class="line"></div><div class="line">    tmpRun();</div><div class="line">&#125;</div><div class="line"></div><div class="line">runTest();  <span class="comment">// 'window'</span></div></pre></td></tr></table></figure>
<p> 此时 object.run 被赋值给了临时变量 tmpRun, 而临时变量是属于 window 对象的（只不过外界不能直接引用，只对 Javascript 引擎可见），于是在 run 函数内部的 this 指针指向的就是 window 对象了。</p>
<p> 解决方案：</p>
<ul>
<li><p>不引入临时变量，每次使用均使用 object.run() 进行调用</p>
</li>
<li><p>run 函数内部使用 object.name 显式引用 name 属性，而不通过 this 指针隐式引用</p>
</li>
<li><p>使用 apply/call 函数指定 this 指针</p>
</li>
</ul>
</li>
<li><p>函数传参导致 this 丢失</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">window</span>.name= <span class="string">'window'</span>; </div><div class="line"><span class="keyword">var</span> object = &#123;</div><div class="line">    <span class="attr">name</span>: <span class="string">'object'</span>, </div><div class="line">    <span class="attr">run</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">setTimeout(object.run, <span class="number">100</span>);    <span class="comment">// 'window'</span></div></pre></td></tr></table></figure>
</li>
</ol>
<p>其实这个问题和上一个示例中的问题是类似的，都是因为临时变量而导致的问题。当我 们执行函数的时候，如果函数带有参数，那么这个时候 Javascript 引擎会创建一个临时变量， 并将传入的参数复制（<strong>注意，Javascript 里面都是值传递的，没有引用传递的概念</strong>）给此临时变量。也就是说，整个过程就跟上面我们定义了一个 tmpRun 的临时变量，再将 object.run 赋值给这个临时变量一样。只不过在这个示例中，容易忽视临时变量导致的 bug。</p>
<h3 id="参考资料："><a href="#参考资料：" class="headerlink" title="参考资料："></a>参考资料：</h3><ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/this" target="_blank" rel="external">MDN this</a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在 Javascript 里，函数被调用的时候，除了接受声明时定义的形式参数，每一个函数还接受两个附加的参数: this 和 arguments。随着函数使用场合的不同，this 的值会发生变化。但是有一个总的原则，那就是 this 指的是，调用函数的那个对象。&lt;br&gt;
    
    </summary>
    
    
      <category term="javascript" scheme="http://zqianduan.com/tags/javascript/"/>
    
      <category term="this" scheme="http://zqianduan.com/tags/this/"/>
    
  </entry>
  
  <entry>
    <title>SSL 证书简介</title>
    <link href="http://zqianduan.com/2016/09/29/ssl-certificate/"/>
    <id>http://zqianduan.com/2016/09/29/ssl-certificate/</id>
    <published>2016-09-29T05:40:28.000Z</published>
    <updated>2017-04-27T07:01:51.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="相关概念"><a href="#相关概念" class="headerlink" title="相关概念"></a>相关概念</h2><p><strong>SSL证书：</strong>在应用HTTPS之前，用户应先配置SSL证书。SSL证书是由证书授权中心（CA）签发的对用户公钥的认证。证书的内容包括：电子签证机关的信息、公钥用户信息、公钥、权威机构的签字和有效期等。目前，证书的格式和验证方法普遍遵循X.509 国际标准。</p>
<p><strong>HTTPS：</strong>Hyper Text Transfer Protocol over Secure Socket Layer。HTTPS是以安全为目标的HTTP通道，简单讲是HTTP的安全版。即HTTP下加入SSL层，HTTPS的安全基础是SSL。</p>
<p><strong>SSL：</strong>Secure Sockets Layer。SSL是一个安全协议，它提供使用 TCP/IP 的通信应用程序间的隐私与完整性。因特网的超文本传输协议（HTTP）使用 SSL 来实现安全的通信。</p>
<p><strong>TLS：</strong>Transport Layer Security Protocol。TLS是IETF制定的一种新的协议，它建立在SSL 3.0协议规范之上，是SSL 3.0的后续版本。在TLS与SSL3.0之间存在着显著的差别，主要是它们所支持的加密算法不同，所以TLS与SSL3.0不能互操作。TLS也经常用SSL来指代。<br><a id="more"></a></p>
<p><strong>CA：</strong>即证书授权中心（CA, Certificate Authority）。CA是负责签发证书、认证证书、管理已颁发证书的机关。用户向CA提出申请后，CA负责审核用户信息，然后对关键信息利用私钥进行”签名”，并公开对应的公钥。客户端可以利用公钥验证签名。</p>
<p><strong>非对称加密：</strong>即常见的RSA、DH、EC等算法，算法特点是密钥成对出现，一般称为公钥（公开）和私钥（保密），公钥加密的信息只能私钥解开，私钥加密的信息只能公钥解开。公钥对外公开，私钥由服务器保存。因此掌握公钥的不同客户端之间不能互相解密信息，只能和掌握私钥的服务器进行加密通信，服务器可以实现1对多的通信，客户端也可以用来验证掌握私钥的服务器身份。</p>
<p><strong>CSR：</strong>CSR是Certificate Signing Request的英文缩写，即证书请求文件，也就是证书申请者在申请数字证书时由CSP（加密服务提供者）在生成私钥的同时所生成的证书请求文件。证书申请者只要把CSR文件提交给证书颁发机构后，证书颁发机构使用其根证书私钥签名就生成了证书公钥文件，也就是颁发给用户的证书。</p>
<p><strong>PEM：</strong>Openssl所使用的文档格式。<a href="http://www.rfc-editor.org/rfc/" target="_blank" rel="external">RFC 1421-1424</a>。</p>
<h2 id="创建证书"><a href="#创建证书" class="headerlink" title="创建证书"></a>创建证书</h2><p>可以使用OpenSSL来创建CSR，并通过相关机构（例如：沃通）申请证书，具体操作方法如下：</p>
<h3 id="前置任务"><a href="#前置任务" class="headerlink" title="前置任务"></a>前置任务</h3><p>在申请证书前，用户应先获取并安装相关工具。</p>
<p><strong>Linux：</strong>建议使用OpenSSL。OpenSSL是一个强大的SLL密码库，囊括主要的密码算法、常用的密钥和证书封装管理功能及SSL协议，并提供丰富的应用程序供测试或其它目的使用。</p>
<p><strong>Windows：</strong>可供选择的工具包括：IIS Manager，SelfSSL，OpenSSL和Windows PowerShell cmdlets等。</p>
<h3 id="使用OpenSSL创建证书"><a href="#使用OpenSSL创建证书" class="headerlink" title="使用OpenSSL创建证书"></a>使用OpenSSL创建证书</h3><p>提交证书申请前，用户需在本地生成私钥和证书请求文件（CSR）；然后用户可以将CSR提交至CA进行签名认证，也可以通过自签名的方式进行本地测试。具体操作方法如以下示例所示（本示例中使用的工具为OpenSSL）。</p>
<ul>
<li><p>(1) 执行命令 <code>openssl genrsa -out my-private-key.pem 2048</code>，通过RSA算法生成私钥，并保存在 <code>my-private-key.pem</code> 文件中。百度开放云支持1024、2048和4096 bits长度的私钥，建议使用2048 bits长度。</p>
<p>  <strong>注意：</strong>请妥善保管私钥，避免遗失和泄露。</p>
<p>  查看私钥文件的具体内容如下：</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">-----BEGIN RSA PRIVATE KEY-----</div><div class="line">MIIEowIBAAKCAQEAtp7N1PA57N6cA73X9WyupkjZYx1bYHZA35gTrGa6ojd8oURW</div><div class="line">8cqXD46P0dccfiJ34s1eEMquuMsFTtezVNmMH9elADnKVIRBg/NfwehhLx++eeJ0</div><div class="line">CuOT08QB373Lyzud93BefhHfYB295DI42IF8NuC60jWVlfmZG7cBSAPSt24Lya1l</div><div class="line">PzvEULnDSXgMVyDcOW4v82hcztLhfliFUmrf5Vz/uRJNwBKuMrRIBGu4u8pxplzg</div><div class="line">......</div><div class="line">9z+Rm0fnFhc3/945EIic9sUCgYA0ZoqfXOkQ07UnIPwvFKNIIQRTJfY67V6sZt4t</div><div class="line">l3pbT+BlM2ihS4G4MlSfw4l6lFSPOCsF16RbftOlUPT/ieWWROBFR2tZ1RLNTfmo</div><div class="line">3T5w9tyjjYFOxL56sPh5MmTTq9JhtfMn+xxsaPwgASDLbj58x4dRj4y7jHqOMbCE</div><div class="line">15QNOQKBgADt2m46ZRnFZNL78Xl93/D0TOXowmjiOtgBhEwsuRnlPuDNMUSF4+OZ</div><div class="line">CWm17VfZRQSeN81v3N+0jeJkl3GFemC0Zt49pce4H9paZuv9qBvBXzEaOqiJXwE1</div><div class="line">Q/92Nt5ldSLaEtuMOqxv8pdRv7jIFox2mnimFxpGpjpyPqRK5YC1</div><div class="line">-----END RSA PRIVATE KEY-----</div></pre></td></tr></table></figure>
</li>
<li><p>(2) 执行命令 <code>openssl req -sha256 -new -key my-private-key.pem -out csr.pem</code>，根据系统提示输入相关配置信息，生成CSR文件。其中，<code>-key my-private-key.pem</code> 用来指定步骤1中生成的私钥文件；<code>-out csr.pem</code> 用来指定CSR文件的名称。</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">You are about to be asked to enter information that will be incorporated</div><div class="line">into your certificate request.</div><div class="line">What you are about to enter is what is called a Distinguished Name or a DN.</div><div class="line">There are quite a few fields but you can leave some blank</div><div class="line">For some fields there will be a default value,</div><div class="line">If you enter <span class="string">'.'</span>, the field will be left blank.</div><div class="line">-----</div><div class="line">Country Name (2 letter code) [AU]:CN</div><div class="line">State or Province Name (full name) [Some-State]:Beijing</div><div class="line">Locality Name (eg, city) []:Beijing</div><div class="line">Organization Name (eg, company) [Internet Widgits Pty Ltd]:My Company</div><div class="line">Organizational Unit Name (eg, section) []:.</div><div class="line">Common Name (e.g. server FQDN or YOUR name) []:www.mycompany.com</div><div class="line">Email Address []:example@mycompany.com</div><div class="line"></div><div class="line">Please enter the following <span class="string">'extra'</span> attributes</div><div class="line">to be sent with your certificate request</div><div class="line">A challenge password []:.</div><div class="line">An optional company name []:.</div></pre></td></tr></table></figure>
<p>  查看CSR文件具体内容如下：</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">-----BEGIN CERTIFICATE REQUEST-----</div><div class="line">MIICuzCCAaMCAQAwdjELMAkGA1UEBhMCQ04xEDAOBgNVBAgMB0JlaWppbmcxEDAO</div><div class="line">BgNVBAcMB0JlaWppbmcxDjAMBgNVBAoMBUppbWNvMQ4wDAYDVQQDDAVKaW1jbzEj</div><div class="line">MCEGCSqGSIb3DQEJARYUY2FveW91bmdAZm94bWFpbC5jb20wggEiMA0GCSqGSIb3</div><div class="line">......</div><div class="line">9Dbyxk5csKIR8BHzOaIndEX37fqbw5EGeSQkfGVpoeJXF39jyobMFlrW6vgywgCe</div><div class="line">2/8Jnw/oditEdX4c2kY8JzQYHADNoXxG9SR7ZGypd+LeF6utURQk+ol7K1MwzEvX</div><div class="line">QUsm4FKVeG6ACENqUZrHzwaDAMALxnHz6UHkpoEpmif+exs/cjROmy8w96fmytQv</div><div class="line">aes433mU7TA9XznzpS28YwBaNDNtBWzgPZ2gTbTY5Q==</div><div class="line">-----END CERTIFICATE REQUEST-----</div></pre></td></tr></table></figure>
<p>  执行以上命令时所需填写的内容解释如下表所示：</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>字段</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>Country Name</td>
<td>公司/组织所在国家ISO代码，中国代码为CN，其它国家代码可参考<a href="https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2#Officially_assigned_code_elements" target="_blank" rel="external">ISO Code</a></td>
</tr>
<tr>
<td>State or Province Name</td>
<td>公司/组织所在的省/州名称</td>
</tr>
<tr>
<td>Locality Name</td>
<td>公司/组织所在城市名称</td>
</tr>
<tr>
<td>Organization Name</td>
<td>公司/组织的名称，此处应该出完整全称</td>
</tr>
<tr>
<td>Organizational Unit Name</td>
<td>产品或分支机构名称，可选</td>
</tr>
<tr>
<td>Common Name</td>
<td>公司/组织的完全限定域名（FQDN，Fully-Qualified Domain Name），例如： www.mycompany.com</td>
</tr>
<tr>
<td>Email Address</td>
<td>管理员的Email地址</td>
</tr>
<tr>
<td>A challenge password</td>
<td>加密证书请求的密码</td>
</tr>
<tr>
<td>An optional company name</td>
<td>可选公司/组织名称</td>
</tr>
</tbody>
</table>
<ul>
<li><p>(3) 向CA中心提交数字证书认证申请。用户可选择 <a href="https://www.verisign.com/" target="_blank" rel="external">VeriSign</a>、<a href="https://www.geotrust.com/" target="_blank" rel="external">GeoTrust</a> 等第三方认证机构。</p>
<p>  用户也可以执行命令 <code>openssl x509 -req -days 365 -in csr.pem -signkey my-private-key.pem -out my-certificate.pem</code>，对证书进行自签名，用于网站的测试。其中，<code>-days 365</code> 代表证书有效期为365天；<code>-in csr.pem</code> 用来指定步骤2生成CSR文件；<code>-signkey my-private-key.pem</code> 用来指定用于对CSR进行签名的私钥，本示例中使用步骤1生成的私钥进行签名；<code>-out my-certificate.pem</code> 用来指定生成的证书名称。</p>
<p>  查看生成的证书文件内容如下：</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">-----BEGIN CERTIFICATE-----</div><div class="line">MIIDaDCCAlACCQCNYeeikeNQ0TANBgkqhkiG9w0BAQUFADB2MQswCQYDVQQGEwJD</div><div class="line">TjEQMA4GA1UECAwHQmVpamluZzEQMA4GA1UEBwwHQmVpamluZzEOMAwGA1UECgwF</div><div class="line">SmltY28xDjAMBgNVBAMMBUppbWNvMSMwIQYJKoZIhvcNAQkBFhRjYW95b3VuZ0Bm</div><div class="line">b3htYWlsLmNvbTAeFw0xNjA5MjkwNjA1NDVaFw0xNzA5MjkwNjA1NDVaMHYxCzAJ</div><div class="line">......</div><div class="line">YZZ54dCkVQybjSy8O/tGLi6MDwIDAQABMA0GCSqGSIb3DQEBBQUAA4IBAQAhhOVe</div><div class="line">p1yRWvbiag/ObWtxFuhOpWpvVsrYwlbgusoCfulJUtavD33ZCVzp5/Zg6QdhlDi1</div><div class="line">XPvmoXfj3HG9tjvyZnAqi8+vyozL6QTCo1mNDGCQyLqwU8b5J0nGe1lpayDF97wL</div><div class="line">UBQh+685ILSLZA4LnNvsqfVG8CxlJK8nvIWXbW0waMsnglsf1Gj7F<span class="built_in">cd</span>RFcYeMtSY</div><div class="line">pniTCET/TtiwDk2+0YTehD8gWiscp/W87sNwpGVKEFD4aGBFTWDG5lYgslJHi/I3</div><div class="line">6j4ov3PyZWKVIFWncxFPAtFFDnu7ZnXUxggXIEvYMKYaDcHwssLSuwAqWvhEClif</div><div class="line">mvIHZCCc1FYI9bNa</div><div class="line">-----END CERTIFICATE-----</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="证书格式要求"><a href="#证书格式要求" class="headerlink" title="证书格式要求"></a>证书格式要求</h2><p>上传证书前，用户需要确保：</p>
<ol>
<li><p>证书（包括：服务器证书、私钥、证书链）格式符合PEM格式要求。如果用户从CA收到的证书不是PEM格式的，需要转换成PEM格式。具体要求如下：</p>
<ul>
<li><p>证书以 <code>-----BEGIN CERTIFICATE-----</code> 开头，<code>-----END CERTIFICATE-----</code> 结尾；</p>
</li>
<li><p>每行64字符，最后一行不超过64字符。</p>
<p>如果用户从CA收到的证书不是PEM格式的，需要转换成PEM格式，几种常见的证书格式转换为PEM格式的方法如下：</p>
</li>
<li><p><strong>DER -&gt; PEM:</strong></p>
<p>  证书：<code>openssl x509 -inform der -in my-certificate.cer -out my-certificate.pem</code></p>
<p>  私钥：<code>openssl rsa -inform DER -outform PEM -in my-private-key.der -out my-private-key.pem</code></p>
</li>
<li><p><strong>P7B -&gt; PEM:</strong></p>
<p>  证书：<code>openssl pkcs7 -print_certs -in my-certificate.p7b -out my-certificate.pem</code></p>
<p>  私钥：无私钥</p>
</li>
<li><p><strong>PFX -&gt; PEM:</strong></p>
<p>  证书：<code>openssl pkcs12 -in certname.pfx -nokeys -out my-certificate.pem</code></p>
<p>  私钥：<code>openssl pkcs12 -in certname.pfx -nocerts -out my-private-key.pem -nodes</code></p>
</li>
</ul>
</li>
<li><p>服务器证书需要在有效期内（证书开始时间 &lt;= 当前时间 &lt;= 证书失效时间）。</p>
</li>
<li><p>私钥不能加密，即执行生成私钥命令时不能添加密码参数。</p>
</li>
<li><p>服务器证书只能包含一个证书。</p>
</li>
<li><p>私钥需要和服务器证书里的公钥匹配。可以通过以下两条命令生成私钥和证书的MD5值，如果二者一致，则可认为私钥与证书里的公钥匹配。</p>
<ul>
<li><p><code>openssl x509 -noout -modulus -in my-certificate.pem | openssl md5</code></p>
</li>
<li><p><code>openssl rsa -noout -modulus -in my-private-key.pem | openssl md5</code></p>
</li>
</ul>
</li>
<li><p>证书链完整，即通过证书链可以对应到可信根证书。具体要求如下：</p>
<ul>
<li><p>证书之间不能有空行；</p>
</li>
<li><p>每一份证书遵守第一项中关于证书的格式要求，示例如下：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">-----BEGIN CERTIFICATE-----</div><div class="line"></div><div class="line">-----END CERTIFICATE-----</div><div class="line"></div><div class="line">-----BEGIN CERTIFICATE-----</div><div class="line"></div><div class="line">-----END CERTIFICATE-----</div><div class="line"></div><div class="line">-----BEGIN CERTIFICATE-----</div><div class="line"></div><div class="line">-----END CERTIFICATE-----</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;相关概念&quot;&gt;&lt;a href=&quot;#相关概念&quot; class=&quot;headerlink&quot; title=&quot;相关概念&quot;&gt;&lt;/a&gt;相关概念&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;SSL证书：&lt;/strong&gt;在应用HTTPS之前，用户应先配置SSL证书。SSL证书是由证书授权中心（CA）签发的对用户公钥的认证。证书的内容包括：电子签证机关的信息、公钥用户信息、公钥、权威机构的签字和有效期等。目前，证书的格式和验证方法普遍遵循X.509 国际标准。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;HTTPS：&lt;/strong&gt;Hyper Text Transfer Protocol over Secure Socket Layer。HTTPS是以安全为目标的HTTP通道，简单讲是HTTP的安全版。即HTTP下加入SSL层，HTTPS的安全基础是SSL。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;SSL：&lt;/strong&gt;Secure Sockets Layer。SSL是一个安全协议，它提供使用 TCP/IP 的通信应用程序间的隐私与完整性。因特网的超文本传输协议（HTTP）使用 SSL 来实现安全的通信。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;TLS：&lt;/strong&gt;Transport Layer Security Protocol。TLS是IETF制定的一种新的协议，它建立在SSL 3.0协议规范之上，是SSL 3.0的后续版本。在TLS与SSL3.0之间存在着显著的差别，主要是它们所支持的加密算法不同，所以TLS与SSL3.0不能互操作。TLS也经常用SSL来指代。&lt;br&gt;
    
    </summary>
    
      <category term="Server" scheme="http://zqianduan.com/categories/Server/"/>
    
    
      <category term="https" scheme="http://zqianduan.com/tags/https/"/>
    
      <category term="ssl" scheme="http://zqianduan.com/tags/ssl/"/>
    
  </entry>
  
  <entry>
    <title>Javascript 按位运算解析</title>
    <link href="http://zqianduan.com/2016/04/25/js-bit-operation/"/>
    <id>http://zqianduan.com/2016/04/25/js-bit-operation/</id>
    <published>2016-04-25T06:28:34.000Z</published>
    <updated>2017-04-27T07:01:51.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-按位非"><a href="#1-按位非" class="headerlink" title="1. 按位非 ~"></a>1. 按位非 <code>~</code></h2><p>对每一个比特位执行非（NOT）操作。NOT a 结果为 a 的反转（即反码）。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> num = ~<span class="number">4</span>;</div><div class="line"><span class="built_in">console</span>.log(a); <span class="comment">// -5</span></div></pre></td></tr></table></figure>
<p><strong>解析：</strong></p>
<p>4 的二进制数为 100，补满32位</p>
<p>00000000000000000000000000000100</p>
<p>按位取反</p>
<p>11111111111111111111111111111011</p>
<p>由于32位开头第一个是 1，所以这是一个负数，将二进制转换成负数，需要先反码</p>
<p>00000000000000000000000000000100</p>
<p>之后，再+1</p>
<p>00000000000000000000000000000101</p>
<p>转换成十进制为 5，加上符号变成负数 -5<br><a id="more"></a></p>
<h2 id="2-按位与-amp"><a href="#2-按位与-amp" class="headerlink" title="2. 按位与 &amp;"></a>2. 按位与 <code>&amp;</code></h2><p>对每对比特位执行与（AND）操作。只有 a 和 b 都是 1 时，a AND b 才是 1。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> num = <span class="number">2</span> &amp; <span class="number">3</span>;</div><div class="line"><span class="built_in">console</span>.log(num); <span class="comment">// 2</span></div></pre></td></tr></table></figure>
<p><strong>解析：</strong></p>
<p>2 的二进制数为 10，3 的二进制数为 11，补满 32 位分别为</p>
<p>2 = 00000000000000000000000000000010</p>
<p>3 = 00000000000000000000000000000011</p>
<p>按位 &amp; 运算，结果为</p>
<p>00000000000000000000000000000010 = 2</p>
<h2 id="3-按位或"><a href="#3-按位或" class="headerlink" title="3. 按位或 |"></a>3. 按位或 <code>|</code></h2><p>对每一对比特位执行或（OR）操作。如果 a 或 b 为 1，则 a OR b 结果为 1。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> num = <span class="number">2</span> | <span class="number">3</span>;</div><div class="line"><span class="built_in">console</span>.log(num); <span class="comment">// 3</span></div></pre></td></tr></table></figure>
<p><strong>解析：</strong></p>
<p>2 的二进制数为 10，3 的二进制数为 11，补满 32 位分别为</p>
<p>2 = 00000000000000000000000000000010</p>
<p>3 = 00000000000000000000000000000011</p>
<p>按位 | 运算，结果为</p>
<p>00000000000000000000000000000011 = 3</p>
<h2 id="4-按位异或"><a href="#4-按位异或" class="headerlink" title="4. 按位异或 ^"></a>4. 按位异或 <code>^</code></h2><p>对每一对比特位执行异或（XOR）操作。当 a 和 b 不相同时，a XOR b 的结果为 1。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> num = <span class="number">2</span>^<span class="number">3</span>;</div><div class="line"><span class="built_in">console</span>.log(num); <span class="comment">// 1</span></div></pre></td></tr></table></figure>
<p><strong>解析：</strong></p>
<p>2 的二进制数为 10，3 的二进制数为 11，补满 32 位分别为</p>
<p>2 = 00000000000000000000000000000010</p>
<p>3 = 00000000000000000000000000000011</p>
<p>按位 ^ 运算，结果为</p>
<p>00000000000000000000000000000001 = 1</p>
<h2 id="5-左移-lt-lt"><a href="#5-左移-lt-lt" class="headerlink" title="5. 左移 &lt;&lt;"></a>5. 左移 <code>&lt;&lt;</code></h2><p>该操作符会将第一个操作数向左移动指定的位数。向左被移出的位被丢弃，右侧用 0 补充。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> num = <span class="number">2</span>&lt;&lt;<span class="number">1</span>;</div><div class="line"><span class="built_in">console</span>.log(num); <span class="comment">// 4</span></div></pre></td></tr></table></figure>
<p><strong>解析：</strong></p>
<p>2 的二进制数为 10，补满 32 位</p>
<p>2 = 00000000000000000000000000000010</p>
<p>左移 1 位，结果为</p>
<p>00000000000000000000000000000100 = 4</p>
<p><strong>注意：</strong>左移不会影响操作符的符号位，例如将 -2 左移 5 位就是 -64</p>
<h2 id="6-有符号右移-gt-gt"><a href="#6-有符号右移-gt-gt" class="headerlink" title="6. 有符号右移 &gt;&gt;"></a>6. 有符号右移 <code>&gt;&gt;</code></h2><p>该操作符会将第一个操作数向右移动指定的位数。向右被移出的位被丢弃，拷贝最左侧的位以填充左侧。由于新的最左侧的位总是和以前相同，符号位没有被改变。所以被称作“符号传播”。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> num = <span class="number">9</span>&gt;&gt;<span class="number">2</span>;</div><div class="line"><span class="built_in">console</span>.log(num); <span class="comment">// 2</span></div></pre></td></tr></table></figure>
<p><strong>解析：</strong></p>
<p>2 的二进制数为 10，补满 32 位</p>
<p>9 = 00000000000000000000000000001001</p>
<p>右移 2 位，结果为</p>
<p>00000000000000000000000000000010 = 1</p>
<p>相比之下， -9 &gt;&gt; 2 得到 -3，因为符号被保留了：</p>
<p>-9 = 11111111111111111111111111110111</p>
<p>右移 2 位，结果为</p>
<p>11111111111111111111111111111101 = -3</p>
<h2 id="7-无符号右移-gt-gt-gt"><a href="#7-无符号右移-gt-gt-gt" class="headerlink" title="7. 无符号右移 &gt;&gt;&gt;"></a>7. 无符号右移 <code>&gt;&gt;&gt;</code></h2><p>该操作符会将第一个操作数向右移动指定的位数。向右被移出的位被丢弃，左侧用0填充。因为符号位变成了 0，所以结果总是非负的。（注：即便右移 0 个比特，结果也是非负的。）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> num = <span class="number">9</span>&gt;&gt;&gt;<span class="number">2</span>;</div><div class="line"><span class="built_in">console</span>.log(num); <span class="comment">// 2</span></div></pre></td></tr></table></figure>
<p><strong>解析：</strong></p>
<p>对于非负数，有符号右移和无符号右移总是返回相同的结果。例如， 9 &gt;&gt;&gt; 2 得到 2 和 9 &gt;&gt; 2 相同：</p>
<p>但是对于负数却不尽相同。 -9 &gt;&gt;&gt; 2 产生 1073741821 这和 -9 &gt;&gt; 2 不同：</p>
<p>-9 = 11111111111111111111111111110111</p>
<p>无符号右移 2 位：</p>
<p>00111111111111111111111111111101 ＝ 1073741821</p>
<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Bitwise_Operators" target="_blank" rel="external">按位操作符 - MDN</a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;1-按位非&quot;&gt;&lt;a href=&quot;#1-按位非&quot; class=&quot;headerlink&quot; title=&quot;1. 按位非 ~&quot;&gt;&lt;/a&gt;1. 按位非 &lt;code&gt;~&lt;/code&gt;&lt;/h2&gt;&lt;p&gt;对每一个比特位执行非（NOT）操作。NOT a 结果为 a 的反转（即反码）。&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; num = ~&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(a); &lt;span class=&quot;comment&quot;&gt;// -5&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;解析：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;4 的二进制数为 100，补满32位&lt;/p&gt;
&lt;p&gt;00000000000000000000000000000100&lt;/p&gt;
&lt;p&gt;按位取反&lt;/p&gt;
&lt;p&gt;11111111111111111111111111111011&lt;/p&gt;
&lt;p&gt;由于32位开头第一个是 1，所以这是一个负数，将二进制转换成负数，需要先反码&lt;/p&gt;
&lt;p&gt;00000000000000000000000000000100&lt;/p&gt;
&lt;p&gt;之后，再+1&lt;/p&gt;
&lt;p&gt;00000000000000000000000000000101&lt;/p&gt;
&lt;p&gt;转换成十进制为 5，加上符号变成负数 -5&lt;br&gt;
    
    </summary>
    
      <category term="Snippet" scheme="http://zqianduan.com/categories/Snippet/"/>
    
    
      <category term="运算符" scheme="http://zqianduan.com/tags/%E8%BF%90%E7%AE%97%E7%AC%A6/"/>
    
      <category term="二进制" scheme="http://zqianduan.com/tags/%E4%BA%8C%E8%BF%9B%E5%88%B6/"/>
    
  </entry>
  
  <entry>
    <title>常用排序算法</title>
    <link href="http://zqianduan.com/2016/04/07/js-sort-algorithm/"/>
    <id>http://zqianduan.com/2016/04/07/js-sort-algorithm/</id>
    <published>2016-04-07T07:50:43.000Z</published>
    <updated>2017-04-27T07:01:51.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="快速排序"><a href="#快速排序" class="headerlink" title="快速排序"></a>快速排序</h2><p><strong>简介</strong>：通过一趟排序将待排记录分隔成独立的两部分，其中一部分记录的关键字均比另一部分的关键字小，则可分别对这两部分记录继续进行排序，以达到整个序列有序。</p>
<p><strong>实现</strong>：</p>
<p>快速排序使用分治法来把一个串（list）分为两个子串（sub-lists）。具体算法描述如下：</p>
<ol>
<li><p>从数列中挑出一个元素，称为 “基准”（pivot）；</p>
</li>
<li><p>重新排序数列，所有元素比基准值小的摆放在基准前面，所有元素比基准值大的摆在基准的后面（相同的数可以到任一边）。在这个分区退出之后，该基准就处于数列的中间位置。这个称为分区（partition）操作；</p>
</li>
<li><p>递归地（recursive）把小于基准值元素的子数列和大于基准值元素的子数列排序。</p>
<a id="more"></a>
</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 方法一</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">quickSort</span>(<span class="params">array, left, right</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span>(<span class="built_in">Object</span>.prototype.toString.call(array).slice(<span class="number">8</span>, <span class="number">-1</span>) === <span class="string">'Array'</span> &amp;&amp; <span class="keyword">typeof</span> left === <span class="string">'number'</span> &amp;&amp; <span class="keyword">typeof</span> right === <span class="string">'number'</span>) &#123;</div><div class="line">        <span class="keyword">if</span>(left &lt; right) &#123;</div><div class="line">            <span class="keyword">var</span> x = array[right], i = left - <span class="number">1</span>, temp;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">var</span> j = left; j &lt;= right; j++) &#123;</div><div class="line">                <span class="keyword">if</span>(array[j] &lt;= x) &#123;</div><div class="line">                    i++;</div><div class="line">                    temp = array[i];</div><div class="line">                    array[i] = array[j];</div><div class="line">                    array[j] = temp;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            quickSort(array, left, i - <span class="number">1</span>);</div><div class="line">            quickSort(array, i + <span class="number">1</span>, right);</div><div class="line">        &#125;;</div><div class="line">    &#125; </div><div class="line">    <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">'array is not an Array or left or right is not a number!'</span>;</div><div class="line">    &#125;</div><div class="line">&#125;  </div><div class="line"><span class="keyword">var</span> aaa = [<span class="number">3</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">9</span>, <span class="number">1</span>];</div><div class="line">quickSort(aaa, <span class="number">0</span>, aaa.length - <span class="number">1</span>);</div><div class="line"><span class="built_in">console</span>.log(aaa);</div><div class="line"></div><div class="line"><span class="comment">// 方法二</span></div><div class="line"><span class="keyword">var</span> quickSort = <span class="function"><span class="keyword">function</span>(<span class="params">arr</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (arr.length &lt;= <span class="number">1</span>) &#123; <span class="keyword">return</span> arr; &#125;</div><div class="line">    <span class="keyword">var</span> pivotIndex = <span class="built_in">Math</span>.floor(arr.length / <span class="number">2</span>);</div><div class="line">    <span class="keyword">var</span> pivot = arr.splice(pivotIndex, <span class="number">1</span>)[<span class="number">0</span>];</div><div class="line">    <span class="keyword">var</span> left = [];</div><div class="line">    <span class="keyword">var</span> right = [];</div><div class="line"></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arr.length; i++)&#123;</div><div class="line">        <span class="keyword">if</span>(arr[i] &lt; pivot) &#123;</div><div class="line">            left.push(arr[i]);</div><div class="line">        &#125; </div><div class="line">        <span class="keyword">else</span> &#123;</div><div class="line">            right.push(arr[i]);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> quickSort(left).concat([pivot], quickSort(right));</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h2 id="插入排序"><a href="#插入排序" class="headerlink" title="插入排序"></a>插入排序</h2><p><strong>简介</strong>：插入排序（Insertion-Sort）的算法描述是一种简单直观的排序算法。它的工作原理是通过构建有序序列，对于未排序数据，在已排序序列中从后向前扫描，找到相应位置并插入。插入排序在实现上，通常采用 in-place 排序（即只需用到O(1)的额外空间的排序），因而在从后向前扫描过程中，需要反复把已排序元素逐步向后挪位，为最新元素提供插入空间。</p>
<p><strong>实现</strong>：</p>
<p>一般来说，插入排序都采用 in-place 在数组上实现。具体算法描述如下：</p>
<ol>
<li><p>从第一个元素开始，该元素可以认为已经被排序；</p>
</li>
<li><p>取出下一个元素，在已经排序的元素序列中从后向前扫描；</p>
</li>
<li><p>如果该元素（已排序）大于新元素，将该元素移到下一位置；</p>
</li>
<li><p>重复步骤3，直到找到已排序的元素小于或者等于新元素的位置；</p>
</li>
<li><p>将新元素插入到该位置后；</p>
</li>
<li><p>重复步骤2~5。</p>
</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">insertionSort</span>(<span class="params">array</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="built_in">Object</span>.prototype.toString.call(array).slice(<span class="number">8</span>, <span class="number">-1</span>) === <span class="string">'Array'</span>) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>; i &lt; array.length; i++) &#123;</div><div class="line">            <span class="keyword">var</span> key = array[i];</div><div class="line">            <span class="keyword">var</span> j = i - <span class="number">1</span>;</div><div class="line"></div><div class="line">            <span class="keyword">while</span> (j &gt;= <span class="number">0</span> &amp;&amp; array[j] &gt; key) &#123;</div><div class="line">                array[j + <span class="number">1</span>] = array[j];</div><div class="line">                j--;</div><div class="line">            &#125;</div><div class="line">            array[j + <span class="number">1</span>] = key;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> array;</div><div class="line">    &#125; </div><div class="line">    <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">'array is not an Array!'</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="二分插入排序"><a href="#二分插入排序" class="headerlink" title="二分插入排序"></a>二分插入排序</h2><p><strong>简介</strong>：二分插入（Binary-insert-sort)排序是一种在直接插入排序算法上进行小改动的排序算法。其与直接插入排序算法最大的区别在于查找插入位置时使用的是二分查找的方式，在速度上有一定提升。</p>
<p><strong>实现</strong>：</p>
<p>一般来说，插入排序都采用in-place在数组上实现。具体算法描述如下：</p>
<ol>
<li><p>从第一个元素开始，该元素可以认为已经被排序；</p>
</li>
<li><p>取出下一个元素，在已经排序的元素序列中二分查找到第一个比它大的数的位置；</p>
</li>
<li><p>将新元素插入到该位置后；</p>
</li>
<li><p>重复上述两步。</p>
</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">binaryInsertionSort</span>(<span class="params">array</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span>(<span class="built_in">Object</span>.prototype.toString.call(array).slice(<span class="number">8</span>, <span class="number">-1</span>) === <span class="string">'Array'</span>) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">1</span>; i &lt; array.length; i++) &#123;</div><div class="line">            <span class="keyword">var</span> key = array[i],</div><div class="line">                left = <span class="number">0</span>,</div><div class="line">                right = i - <span class="number">1</span>;</div><div class="line"></div><div class="line">            <span class="keyword">while</span>(left &lt;= right) &#123;</div><div class="line">                <span class="keyword">var</span> middle = <span class="built_in">parseInt</span>((left + right) / <span class="number">2</span>);</div><div class="line">                <span class="keyword">if</span>(key &lt; array[middle]) &#123;</div><div class="line">                    right = middle - <span class="number">1</span>;</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    left = middle + <span class="number">1</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">for</span>(<span class="keyword">var</span> j = i - <span class="number">1</span>; j &gt;= left; j--) &#123;</div><div class="line">                array[j + <span class="number">1</span>] = array[j];</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            array[left] = key;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> array;</div><div class="line">    &#125; </div><div class="line">    <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">'array is not an Array!'</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="冒泡排序"><a href="#冒泡排序" class="headerlink" title="冒泡排序"></a>冒泡排序</h2><p><strong>简介</strong>：冒泡排序是一种简单的排序算法。它重复地走访过要排序的数列，一次比较两个元素，如果它们的顺序错误就把它们交换过来。走访数列的工作是重复地进行直到没有再需要交换，也就是说该数列已经排序完成。这个算法的名字由来是因为越小的元素会经由交换慢慢“浮”到数列的顶端。</p>
<p><strong>实现</strong>：</p>
<ol>
<li><p>比较相邻的元素。如果第一个比第二个大，就交换它们两个；</p>
</li>
<li><p>对每一对相邻元素作同样的工作，从开始第一对到结尾的最后一对，这样在最后的元素应该会是最大的数；</p>
</li>
<li><p>针对所有的元素重复以上的步骤，除了最后一个；</p>
</li>
<li><p>重复步骤1~3，直到排序完成。</p>
</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 方法一</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">bubbleSort</span>(<span class="params">array</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span>(<span class="built_in">Object</span>.prototype.toString.call(array).slice(<span class="number">8</span>, <span class="number">-1</span>) === <span class="string">'Array'</span>) &#123;</div><div class="line">        <span class="keyword">var</span> len = array.length,</div><div class="line">            temp;</div><div class="line"></div><div class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; len - <span class="number">1</span>; i++) &#123;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">var</span> j = len - <span class="number">1</span>; j &gt;= i; j--) &#123;</div><div class="line">                <span class="keyword">if</span>(array[j] &lt; array[j - <span class="number">1</span>]) &#123;</div><div class="line">                    temp = array[j];</div><div class="line">                    array[j] = array[j - <span class="number">1</span>];</div><div class="line">                    array[j - <span class="number">1</span>] = temp;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> array;</div><div class="line">    &#125; </div><div class="line">    <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">'array is not an Array!'</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 方法二</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">bubbleSort</span>(<span class="params">array</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span>(<span class="built_in">Object</span>.prototype.toString.call(array).slice(<span class="number">8</span>, <span class="number">-1</span>) === <span class="string">'Array'</span>) &#123;</div><div class="line">        <span class="keyword">var</span> len = array.length - <span class="number">1</span>,</div><div class="line">            temp;</div><div class="line"></div><div class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</div><div class="line">            <span class="keyword">if</span>(array[i] &gt; array[i+<span class="number">1</span>]) &#123;</div><div class="line">                temp = array[i];</div><div class="line">                array[i] = array[i+<span class="number">1</span>];</div><div class="line">                array[i+<span class="number">1</span>] = temp;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">if</span>(i == len - <span class="number">1</span>) &#123;</div><div class="line">                i = <span class="number">-1</span>;</div><div class="line">                len--;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> array;</div><div class="line">    &#125; </div><div class="line">    <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">'array is not an Array!'</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="选择排序"><a href="#选择排序" class="headerlink" title="选择排序"></a>选择排序</h2><p><strong>简介</strong>：选择排序(Selection-sort)是一种简单直观的排序算法。它的工作原理：首先在未排序序列中找到最小（大）元素，存放到排序序列的起始位置，然后，再从剩余未排序元素中继续寻找最小（大）元素，然后放到已排序序列的末尾。以此类推，直到所有元素均排序完毕。</p>
<p><strong>实现</strong>：</p>
<p>n 个记录的直接选择排序可经过 n-1 趟直接选择排序得到有序结果。具体算法描述如下：</p>
<ol>
<li><p>初始状态：无序区为R[1..n]，有序区为空；</p>
</li>
<li><p>第 i 趟排序(i=1,2,3…n-1)开始时，当前有序区和无序区分别为 R[1..i-1] 和 R(i..n）。该趟排序从当前无序区中选出关键字最小的记录 R[k]，将它与无序区的第1个记录 R 交换，使 R[1..i] 和R [i+1..n) 分别变为记录个数增加1个的新有序区和记录个数减少1个的新无序区；</p>
</li>
<li><p>n-1 趟结束，数组有序化了。</p>
</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">selectionSort</span>(<span class="params">array</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span>(<span class="built_in">Object</span>.prototype.toString.call(array).slice(<span class="number">8</span>, <span class="number">-1</span>) === <span class="string">'Array'</span>) &#123;</div><div class="line">        <span class="keyword">var</span> len = array.length,</div><div class="line">            temp;</div><div class="line"></div><div class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; len - <span class="number">1</span>; i++) &#123;</div><div class="line">            <span class="keyword">var</span> min = array[i];</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">var</span> j = i + <span class="number">1</span>; j &lt; len; j++) &#123;</div><div class="line">                <span class="keyword">if</span> (array[j] &lt; min) &#123;</div><div class="line">                    temp = min;</div><div class="line">                    min = array[j];</div><div class="line">                    array[j] = temp;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            array[i] = min;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> array;</div><div class="line">    &#125; </div><div class="line">    <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">'array is not an Array!'</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="堆排序"><a href="#堆排序" class="headerlink" title="堆排序"></a>堆排序</h2><p><strong>简介</strong>：堆排序（Heapsort）是指利用堆这种数据结构所设计的一种排序算法。堆积是一个近似完全二叉树的结构，并同时满足堆积的性质：即子结点的键值或索引总是小于（或者大于）它的父节点。</p>
<p><strong>实现</strong>：</p>
<ol>
<li><p>将初始待排序关键字序列(R1,R2….Rn)构建成大顶堆，此堆为初始的无序区；</p>
</li>
<li><p>将堆顶元素 R[1] 与最后一个元素 R[n] 交换，此时得到新的无序区(R1,R2,……Rn-1)和新的有序区(Rn),且满足 R[1,2…n-1]&lt;=R[n]；</p>
</li>
<li><p>由于交换后新的堆顶 R[1] 可能违反堆的性质，因此需要对当前无序区(R1,R2,……Rn-1)调整为新堆，然后再次将 R[1] 与无序区最后一个元素交换，得到新的无序区(R1,R2….Rn-2)和新的有序区(Rn-1,Rn)。不断重复此过程直到有序区的元素个数为 n-1，则整个排序过程完成。</p>
</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 方法说明：堆排序</div><div class="line"> * @param  array 待排序数组</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">heapSort</span>(<span class="params">array</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span>(<span class="built_in">Object</span>.prototype.toString.call(array).slice(<span class="number">8</span>, <span class="number">-1</span>) === <span class="string">'Array'</span>) &#123;</div><div class="line">        <span class="comment">// 建堆</span></div><div class="line">        <span class="keyword">var</span> heapSize = array.length,</div><div class="line">            temp;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="built_in">Math</span>.floor(heapSize / <span class="number">2</span>) - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</div><div class="line">            heapify(array, i, heapSize);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// 堆排序</span></div><div class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> j = heapSize - <span class="number">1</span>; j &gt;= <span class="number">1</span>; j--) &#123;</div><div class="line">            temp = array[<span class="number">0</span>];</div><div class="line">            array[<span class="number">0</span>] = array[j];</div><div class="line">            array[j] = temp;</div><div class="line">            heapify(array, <span class="number">0</span>, --heapSize);</div><div class="line">        &#125;</div><div class="line">    &#125; </div><div class="line">    <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">'array is not an Array!'</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">/**</span></div><div class="line"> * 方法说明：维护堆的性质</div><div class="line"> * @param  arr 数组</div><div class="line"> * @param  x   数组下标</div><div class="line"> * @param  len 堆大小</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">heapify</span>(<span class="params">arr, x, len</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span>(<span class="built_in">Object</span>.prototype.toString.call(arr).slice(<span class="number">8</span>, <span class="number">-1</span>) === <span class="string">'Array'</span> &amp;&amp; <span class="keyword">typeof</span> x === <span class="string">'number'</span>) &#123;</div><div class="line">        <span class="keyword">var</span> l = <span class="number">2</span> * x + <span class="number">1</span>,</div><div class="line">            r = <span class="number">2</span> * x + <span class="number">2</span>,</div><div class="line">            largest = x,</div><div class="line">            temp;</div><div class="line"></div><div class="line">        <span class="keyword">if</span>(l &lt; len &amp;&amp; arr[l] &gt; arr[largest]) &#123;</div><div class="line">            largest = l;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(r &lt; len &amp;&amp; arr[r] &gt; arr[largest]) &#123;</div><div class="line">            largest = r;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(largest != x) &#123;</div><div class="line">            temp = arr[x];</div><div class="line">            arr[x] = arr[largest];</div><div class="line">            arr[largest] = temp;</div><div class="line">            heapify(arr, largest, len);</div><div class="line">        &#125;</div><div class="line">    &#125; </div><div class="line">    <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">'arr is not an Array or x is not a number!'</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="归并排序"><a href="#归并排序" class="headerlink" title="归并排序"></a>归并排序</h2><p><strong>简介</strong>：归并排序是建立在归并操作上的一种有效的排序算法。该算法是采用分治法（Divide and Conquer）的一个非常典型的应用。归并排序是一种稳定的排序方法。将已有序的子序列合并，得到完全有序的序列；即先使每个子序列有序，再使子序列段间有序。若将两个有序表合并成一个有序表，称为2-路归并。</p>
<p><strong>实现</strong>：</p>
<ol>
<li><p>把长度为 n 的输入序列分成两个长度为 n/2 的子序列；</p>
</li>
<li><p>对这两个子序列分别采用归并排序；</p>
</li>
<li><p>将两个排序好的子序列合并成一个最终的排序序列。</p>
</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">mergeSort</span>(<span class="params">array, p, r</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span>(p &lt; r) &#123;</div><div class="line">        <span class="keyword">var</span> q = <span class="built_in">Math</span>.floor((p + r) / <span class="number">2</span>);</div><div class="line"></div><div class="line">        mergeSort(array, p, q);</div><div class="line">        mergeSort(array, q + <span class="number">1</span>, r);</div><div class="line">        merge(array, p, q, r);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">merge</span>(<span class="params">array, p, q, r</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> n1 = q - p + <span class="number">1</span>,</div><div class="line">        n2 = r - q,</div><div class="line">        left = [],</div><div class="line">        right = [],</div><div class="line">        m = n = <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; n1; i++) &#123;</div><div class="line">        left[i] = array[p + i];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; n2; j++) &#123;</div><div class="line">        right[j] = array[q + <span class="number">1</span> + j];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    left[n1] = right[n2] = <span class="built_in">Number</span>.MAX_VALUE;</div><div class="line"></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> k = p; k &lt;= r; k++) &#123;</div><div class="line">        <span class="keyword">if</span>(left[m] &lt;= right[n]) &#123;</div><div class="line">            array[k] = left[m];</div><div class="line">            m++;</div><div class="line">        &#125; </div><div class="line">        <span class="keyword">else</span> &#123;</div><div class="line">            array[k] = right[n];</div><div class="line">            n++;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="桶排序"><a href="#桶排序" class="headerlink" title="桶排序"></a>桶排序</h2><p><strong>简介</strong>：桶排序 (Bucket sort)的工作的原理：假设输入数据服从均匀分布，将数据分到有限数量的桶里，每个桶再分别排序（有可能再使用别的排序算法或是以递归方式继续使用桶排序进行排序）。</p>
<p><strong>实现</strong>：</p>
<ol>
<li><p>设置一个定量的数组当作空桶；</p>
</li>
<li><p>遍历输入数据，并且把数据一个一个放到对应的桶里去；</p>
</li>
<li><p>对每个不是空的桶进行排序；</p>
</li>
<li><p>从不是空的桶里把排好序的数据拼接起来。</p>
</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 方法说明：桶排序</div><div class="line"> * @param  array 数组</div><div class="line"> * @param  num   桶的数量</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">bucketSort</span>(<span class="params">array, num</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span>(array.length &lt;= <span class="number">1</span>) &#123;</div><div class="line">        <span class="keyword">return</span> array;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">var</span> len = array.length,</div><div class="line">        buckets = [],</div><div class="line">        result = [],</div><div class="line">        min = max = array[<span class="number">0</span>],</div><div class="line">        regex = <span class="string">'/^[1-9]+[0-9]*$/'</span>,</div><div class="line">        space,</div><div class="line">        n = <span class="number">0</span>;</div><div class="line"></div><div class="line">    num = num || ((num &gt; <span class="number">1</span> &amp;&amp; regex.test(num)) ? num: <span class="number">10</span>);</div><div class="line"></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">1</span>; i &lt; len; i++) &#123;</div><div class="line">        min = min &lt;= array[i] ? min: array[i];</div><div class="line">        max = max &gt;= array[i] ? max: array[i];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    space = (max - min + <span class="number">1</span>) / num;</div><div class="line"></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; len; j++) &#123;</div><div class="line">        <span class="keyword">var</span> index = <span class="built_in">Math</span>.floor((array[j] - min) / space);</div><div class="line">        <span class="keyword">if</span>(buckets[index]) &#123; <span class="comment">// 非空桶，插入排序</span></div><div class="line">            <span class="keyword">var</span> k = buckets[index].length - <span class="number">1</span>;</div><div class="line">            <span class="keyword">while</span> (k &gt;= <span class="number">0</span> &amp;&amp; buckets[index][k] &gt; array[j]) &#123;</div><div class="line">                buckets[index][k + <span class="number">1</span>] = buckets[index][k];</div><div class="line">                k--;</div><div class="line">            &#125;</div><div class="line">            buckets[index][k + <span class="number">1</span>] = array[j];</div><div class="line">        &#125; </div><div class="line">        <span class="keyword">else</span> &#123; <span class="comment">// 空桶，初始化</span></div><div class="line">            buckets[index] = [];</div><div class="line">            buckets[index].push(array[j]);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">while</span>(n &lt; num) &#123;</div><div class="line">        result = result.concat(buckets[n]);</div><div class="line">        n++;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> result;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="计数排序"><a href="#计数排序" class="headerlink" title="计数排序"></a>计数排序</h2><p><strong>简介</strong>：计数排序(Counting sort)是一种稳定的排序算法。计数排序使用一个额外的数组C，其中第i个元素是待排序数组A中值等于i的元素的个数。然后根据数组C来将A中的元素排到正确的位置。它只能对整数进行排序。</p>
<p><strong>实现</strong>：</p>
<ol>
<li><p>找出待排序的数组中最大和最小的元素；</p>
</li>
<li><p>统计数组中每个值为i的元素出现的次数，存入数组C的第i项；</p>
</li>
<li><p>对所有的计数累加（从C中的第一个元素开始，每一项和前一项相加）；</p>
</li>
<li><p>反向填充目标数组：将每个元素i放在新数组的第C(i)项，每放一个元素就将C(i)减去1。</p>
</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">countingSort</span>(<span class="params">array</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> len = array.length,</div><div class="line">        B = [],</div><div class="line">        C = [],</div><div class="line">        min = max = array[<span class="number">0</span>];</div><div class="line"></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</div><div class="line">        min = min &lt;= array[i] ? min: array[i];</div><div class="line">        max = max &gt;= array[i] ? max: array[i];</div><div class="line">        C[array[i]] = C[array[i]] ? C[array[i]] + <span class="number">1</span> : <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> j = min; j &lt; max; j++) &#123;</div><div class="line">        C[j + <span class="number">1</span>] = (C[j + <span class="number">1</span>] || <span class="number">0</span>) + (C[j] || <span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> k = len - <span class="number">1</span>; k &gt;= <span class="number">0</span>; k--) &#123;</div><div class="line">        B[C[array[k]] - <span class="number">1</span>] = array[k];</div><div class="line">        C[array[k]]--;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> B;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;快速排序&quot;&gt;&lt;a href=&quot;#快速排序&quot; class=&quot;headerlink&quot; title=&quot;快速排序&quot;&gt;&lt;/a&gt;快速排序&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;简介&lt;/strong&gt;：通过一趟排序将待排记录分隔成独立的两部分，其中一部分记录的关键字均比另一部分的关键字小，则可分别对这两部分记录继续进行排序，以达到整个序列有序。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;实现&lt;/strong&gt;：&lt;/p&gt;
&lt;p&gt;快速排序使用分治法来把一个串（list）分为两个子串（sub-lists）。具体算法描述如下：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;从数列中挑出一个元素，称为 “基准”（pivot）；&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;重新排序数列，所有元素比基准值小的摆放在基准前面，所有元素比基准值大的摆在基准的后面（相同的数可以到任一边）。在这个分区退出之后，该基准就处于数列的中间位置。这个称为分区（partition）操作；&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;递归地（recursive）把小于基准值元素的子数列和大于基准值元素的子数列排序。&lt;/p&gt;
    
    </summary>
    
      <category term="Javascript" scheme="http://zqianduan.com/categories/Javascript/"/>
    
    
      <category term="algorithm" scheme="http://zqianduan.com/tags/algorithm/"/>
    
  </entry>
  
  <entry>
    <title>不用中间变量交换两个数值变量的值</title>
    <link href="http://zqianduan.com/2016/04/05/js-swap-algorithm/"/>
    <id>http://zqianduan.com/2016/04/05/js-swap-algorithm/</id>
    <published>2016-04-05T07:39:10.000Z</published>
    <updated>2017-04-27T07:01:51.000Z</updated>
    
    <content type="html"><![CDATA[<ol>
<li><p>加减法</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> a = <span class="number">1</span>,</div><div class="line">    b = <span class="number">2</span>;</div><div class="line"></div><div class="line">a = a + b;</div><div class="line">b = a - b;</div><div class="line">a = a - b;</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(a, b); <span class="comment">// 2, 1</span></div></pre></td></tr></table></figure>
 <a id="more"></a>
<p> 该方法可以交换整型和浮点型数值的变量，但在处理浮点型的时候有可能出现精度的损失，例如：</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> a = <span class="number">1.123456789</span>,</div><div class="line">    b = <span class="number">2.987654321</span>;</div><div class="line"></div><div class="line">a = a + b;</div><div class="line">b = a - b;</div><div class="line">a = a - b;</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(a, b); <span class="comment">// 2.987654321, 1.1234567889999996</span></div></pre></td></tr></table></figure>
</li>
<li><p>乘除法</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> a = <span class="number">3</span>,</div><div class="line">    b = <span class="number">4</span>;</div><div class="line"></div><div class="line">a = a * b;</div><div class="line">b = a / b;</div><div class="line">a = a / b;</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(a, b); <span class="comment">// 4, 3</span></div></pre></td></tr></table></figure>
<p> 乘除法更像是加减法向乘除运算的映射，它与加减法类似：可以处理整型和浮点型变量，但在处理浮点型变量时也存在精度损失问题。而且乘除法比加减法要多一条约束：b 必不为 0。</p>
</li>
<li><p>异或法</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> a = <span class="number">5</span>,</div><div class="line">    b = <span class="number">6</span>;</div><div class="line"></div><div class="line">a ^= b; <span class="comment">// a = a^b;</span></div><div class="line">b ^= a; <span class="comment">// b = b^a = b^(a^b) = b^a^b = b^b^a = 0^a = a;</span></div><div class="line">a ^= b; <span class="comment">// a = a^b = (a^b)^a = a^b^a = a^a^b = 0^b = b;</span></div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(a, b); <span class="comment">// 6, 5</span></div></pre></td></tr></table></figure>
<p> 异或法可以完成对整型变量的交换，对于浮点型变量它无法完成交换。</p>
</li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;ol&gt;
&lt;li&gt;&lt;p&gt;加减法&lt;/p&gt;
 &lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; a = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    b = &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;a = a + b;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;b = a - b;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;a = a - b;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(a, b); &lt;span class=&quot;comment&quot;&gt;// 2, 1&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Snippet" scheme="http://zqianduan.com/categories/Snippet/"/>
    
    
      <category term="algorithm" scheme="http://zqianduan.com/tags/algorithm/"/>
    
  </entry>
  
  <entry>
    <title>Javascript 代码片段笔记</title>
    <link href="http://zqianduan.com/2016/03/30/js-snippet-code/"/>
    <id>http://zqianduan.com/2016/03/30/js-snippet-code/</id>
    <published>2016-03-30T05:55:44.000Z</published>
    <updated>2017-04-27T07:01:51.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="千位分隔符"><a href="#千位分隔符" class="headerlink" title="千位分隔符"></a>千位分隔符</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">commafy</span>(<span class="params">num</span>) </span>&#123;</div><div class="line">    </div><div class="line">    num = num + <span class="string">''</span>;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> reg = <span class="regexp">/(-?\d+)(\d&#123;3&#125;)/</span>;</div><div class="line"></div><div class="line">    <span class="keyword">while</span>(reg.test(num)) &#123;</div><div class="line">        num = num.replace(reg, <span class="string">'$1,$2'</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> num;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="jQuery-实现简单-Router"><a href="#jQuery-实现简单-Router" class="headerlink" title="jQuery 实现简单 Router"></a>jQuery 实现简单 Router</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">$</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> pathname = location.pathname;</div><div class="line">    $.route = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        $.each(<span class="built_in">arguments</span>, <span class="function"><span class="keyword">function</span>(<span class="params">index</span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> path = <span class="keyword">this</span>[<span class="string">"path"</span>];</div><div class="line">            <span class="keyword">var</span> func = <span class="keyword">this</span>[<span class="string">"func"</span>];</div><div class="line">            <span class="keyword">if</span>(path &amp;&amp; func) &#123;</div><div class="line">                <span class="keyword">if</span>(pathname.match(path)) &#123;</div><div class="line">                    $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                        func.apply(<span class="keyword">this</span>);</div><div class="line">                    &#125;);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;;</div><div class="line">&#125;)(jQuery);</div><div class="line"></div><div class="line"><span class="comment">// Example</span></div><div class="line">$.route(</div><div class="line">    &#123;</div><div class="line">        <span class="comment">// always match</span></div><div class="line">        <span class="comment">// http://example.com/foo/bar/baz.html</span></div><div class="line">        path: <span class="regexp">/./</span>,</div><div class="line">        <span class="attr">func</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">"always match!"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    &#123;</div><div class="line">        <span class="comment">// url contains /sample/index.html</span></div><div class="line">        <span class="comment">// http://example.com/foo/bar/sample/index.html</span></div><div class="line">        path: <span class="regexp">/\/sample\/index\.html/</span>,</div><div class="line">        <span class="attr">func</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">"sample page!"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">);</div></pre></td></tr></table></figure>
<h3 id="中文输入法截断解决方案"><a href="#中文输入法截断解决方案" class="headerlink" title="中文输入法截断解决方案"></a>中文输入法截断解决方案</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 利用 compositionstart 和 compositionend 来捕获 IME (input method editor) 的启动和关闭事件</span></div><div class="line">$(<span class="string">'#text'</span>).on(<span class="string">'input'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">    <span class="keyword">if</span>($(<span class="keyword">this</span>).prop(<span class="string">'comStart'</span>)) <span class="keyword">return</span>;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> value = $(<span class="keyword">this</span>).val();</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'当前输入：'</span> + value);</div><div class="line">      </div><div class="line">    <span class="comment">// ....</span></div><div class="line">&#125;)</div><div class="line">.on(<span class="string">'compositionstart'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">    $(<span class="keyword">this</span>).prop(<span class="string">'comStart'</span>, <span class="literal">true</span>);</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'中文输入，开始'</span>);</div><div class="line">&#125;)</div><div class="line">.on(<span class="string">'compositionend'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">    $(<span class="keyword">this</span>).prop(<span class="string">'comStart'</span>, <span class="literal">false</span>);</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'中文输入，结束'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="jQuery-pub-sub-简单实现"><a href="#jQuery-pub-sub-简单实现" class="headerlink" title="jQuery pub/sub 简单实现"></a>jQuery pub/sub 简单实现</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">$</span>) </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> o = $(&#123;&#125;);</div><div class="line"></div><div class="line">    $.subscribe = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        o.on.apply(o, <span class="built_in">arguments</span>);</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    $.unsubscribe = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        o.off.apply(o, <span class="built_in">arguments</span>);</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    $.publish = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        o.trigger.apply(o, <span class="built_in">arguments</span>);</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">&#125;(jQuery));</div></pre></td></tr></table></figure>
<h3 id="观察者模式"><a href="#观察者模式" class="headerlink" title="观察者模式"></a>观察者模式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> eventSplitter = <span class="regexp">/\s+/</span>;</div><div class="line"></div><div class="line"><span class="keyword">var</span> Events = &#123;</div><div class="line">        <span class="comment">/**</span></div><div class="line">         * _callback = &#123;</div><div class="line">         *      tail: [Object],</div><div class="line">         *      next: &#123;</div><div class="line">         *          callback: [Function],</div><div class="line">         *          context: [Object],</div><div class="line">         *          next: &#123;</div><div class="line">         *              callback: [Function],</div><div class="line">         *              context: [Object],</div><div class="line">         *              next: [Object]</div><div class="line">         *          &#125;</div><div class="line">         *      &#125;</div><div class="line">         * &#125;</div><div class="line">         *</div><div class="line">         * 1. 事件列表最顶层存储了一个 tail 对象，它是最后一次绑定的回调事件的 next 的引用;</div><div class="line">         * 2. evts 允许指定多个事件名，通过空白字符进行分隔(如空格, 制表符等);</div><div class="line">         * 3. 当事件名称为"all"时, 在调用 fire 方法触发任何事件时, </div><div class="line">         * 均会调用"all"事件中绑定的所有回调函数;</div><div class="line">         */</div><div class="line">        on: <span class="function"><span class="keyword">function</span>(<span class="params">evts, callback, context</span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> evt, calls, node, tail, list;</div><div class="line"></div><div class="line">            <span class="keyword">if</span>(!callback) <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line"></div><div class="line">            evts = evts.split(eventSpliter);</div><div class="line">            calls = <span class="keyword">this</span>._callbacks || (<span class="keyword">this</span>._callbacks = &#123;&#125;);</div><div class="line"></div><div class="line">            <span class="keyword">while</span>(evt = evts.shift()) &#123;</div><div class="line">                list = calls[evt];</div><div class="line">                node = list ? list.tail : &#123;&#125;;</div><div class="line">                node.next = tail = &#123;&#125;;</div><div class="line">                node.callback = callback;</div><div class="line">                node.context = context;</div><div class="line"></div><div class="line">                calls[evt] = &#123;</div><div class="line">                    <span class="attr">tail</span>: tail,</div><div class="line">                    <span class="attr">next</span>: list ? list.next : node;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;,</div><div class="line"></div><div class="line">        <span class="attr">off</span>: <span class="function"><span class="keyword">function</span>(<span class="params">evts, callback, context</span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> evt, calls, node, tail, cb, ctx;</div><div class="line"></div><div class="line">            <span class="keyword">if</span>(!(calls = <span class="keyword">this</span>._callbacks)) <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">            <span class="keyword">if</span>(!(evts || callback || context)) &#123;</div><div class="line">                <span class="keyword">delete</span> <span class="keyword">this</span>._callbacks;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            evts = evts ? evts.split(eventSpliter) : <span class="built_in">Object</span>.key(calls);</div><div class="line"></div><div class="line">            <span class="keyword">while</span>(evt = evts.shift()) &#123;</div><div class="line">                node = calls[evt];</div><div class="line">                <span class="keyword">delete</span> calls[evt];</div><div class="line"></div><div class="line">                <span class="keyword">if</span>(!node || !(callback || context)) <span class="keyword">continue</span>;</div><div class="line"></div><div class="line">                tail = node.tail;</div><div class="line">                <span class="keyword">while</span>((node = node.next) !== tail) &#123;</div><div class="line">                    cb = node.callback;</div><div class="line">                    ctx = node.context;</div><div class="line"></div><div class="line">                    <span class="keyword">if</span>((callback &amp;&amp; cb !== callback) || (context &amp;&amp; ctx !== context)) &#123;</div><div class="line">                        <span class="keyword">this</span>.on(evt, cb, ctx);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;,</div><div class="line"></div><div class="line">        <span class="attr">fire</span>: <span class="function"><span class="keyword">function</span>(<span class="params">evts</span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> evt, node, calls, tail, args, all, rest;</div><div class="line"></div><div class="line">            <span class="keyword">if</span>(!(calls = <span class="keyword">this</span>._callbacks)) <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">            all = calls.all;</div><div class="line">            evts = evts.split(eventSpliter);</div><div class="line">            rest = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>);</div><div class="line"></div><div class="line">            <span class="keyword">while</span>(evt = evts.shift()) &#123;</div><div class="line">                <span class="keyword">if</span>(node = calls[evt]) &#123;</div><div class="line">                    tail = node.tail;</div><div class="line">                    <span class="keyword">while</span>((node = node.next) !== tail) &#123;</div><div class="line">                        node.callback.apply(node.context || <span class="keyword">this</span>, rest);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line"></div><div class="line">                <span class="keyword">if</span>(node = all) &#123;</div><div class="line">                    tail = node.tail;</div><div class="line">                    args = [evt].concat(rest);</div><div class="line"></div><div class="line">                    <span class="keyword">while</span>((node = node.next) !== tail) &#123;</div><div class="line">                        node.callback.apply(node.context || <span class="keyword">this</span>, args);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h3 id="短小强悍的-Javascript-异步调用库"><a href="#短小强悍的-Javascript-异步调用库" class="headerlink" title="短小强悍的 Javascript 异步调用库"></a>短小强悍的 Javascript 异步调用库</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> queue = <span class="function"><span class="keyword">function</span>(<span class="params">funcs, scope</span>) </span>&#123;</div><div class="line">    (<span class="function"><span class="keyword">function</span> <span class="title">next</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span>(funcs.length &gt; <span class="number">0</span>) &#123;</div><div class="line">            funcs.shift().apply(scope, [next].concat(<span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>, <span class="number">0</span>)));</div><div class="line">        &#125;</div><div class="line">    &#125;)();</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// Example</span></div><div class="line"><span class="keyword">var</span> obj = &#123; <span class="attr">value</span>: <span class="literal">null</span> &#125;;</div><div class="line"></div><div class="line">queue([</div><div class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> me = <span class="keyword">this</span>;</div><div class="line">        setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">              me.value = <span class="number">10</span>;</div><div class="line">              callback(<span class="number">20</span>);</div><div class="line">        &#125;);</div><div class="line">    &#125;,</div><div class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">callback, add</span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.value + add);</div><div class="line">        callback();</div><div class="line">    &#125;,</div><div class="line">    <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(obj.value);</div><div class="line">    &#125;</div><div class="line">], obj);</div></pre></td></tr></table></figure>
<h3 id="干掉鼠标右键菜单"><a href="#干掉鼠标右键菜单" class="headerlink" title="干掉鼠标右键菜单"></a>干掉鼠标右键菜单</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">NoRightClick</span>(<span class="params">pid</span>) </span>&#123; <span class="comment">// pid: flash's parentNode id</span></div><div class="line">    <span class="keyword">var</span> el = <span class="built_in">document</span>.getElementById(pid);</div><div class="line">    <span class="keyword">if</span>(el.addEventListener) &#123;</div><div class="line">        el.addEventListener(<span class="string">'mousedown'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</div><div class="line">            <span class="keyword">if</span>(event.button == <span class="number">2</span>)&#123;</div><div class="line">                event.stopPropagation(); <span class="comment">// for firefox</span></div><div class="line">                event.preventDefault();  <span class="comment">// for chrome</span></div><div class="line">            &#125;</div><div class="line">        &#125;,<span class="literal">true</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> &#123;</div><div class="line">        el.attachEvent(<span class="string">'onmousedown'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">if</span>(event.button == <span class="number">2</span>) &#123;</div><div class="line">                el.setCapture();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">   </div><div class="line">        el.attachEvent(<span class="string">'onmouseup'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            el.releaseCapture();</div><div class="line">        &#125;);</div><div class="line">   </div><div class="line">        el.oncontextmenu = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        &#125;;</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h3 id="判断是否是素数"><a href="#判断是否是素数" class="headerlink" title="判断是否是素数"></a>判断是否是素数</h3><pre><code class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">isPrime</span>(<span class="params">num</span>) </span>{
    <span class="keyword">return</span> n &lt; <span class="number">2</span> ? <span class="literal">false</span> : !<span class="regexp">/^(11+?)\1+$/</span>.test(<span class="built_in">Array</span>(num+<span class="number">1</span>).join(<span class="number">1</span>));
}
</code></pre>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;千位分隔符&quot;&gt;&lt;a href=&quot;#千位分隔符&quot; class=&quot;headerlink&quot; title=&quot;千位分隔符&quot;&gt;&lt;/a&gt;千位分隔符&lt;/h3&gt;&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;commafy&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;num&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    num = num + &lt;span class=&quot;string&quot;&gt;&#39;&#39;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; reg = &lt;span class=&quot;regexp&quot;&gt;/(-?\d+)(\d&amp;#123;3&amp;#125;)/&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt;(reg.test(num)) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        num = num.replace(reg, &lt;span class=&quot;string&quot;&gt;&#39;$1,$2&#39;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; num;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Snippet" scheme="http://zqianduan.com/categories/Snippet/"/>
    
    
      <category term="promise" scheme="http://zqianduan.com/tags/promise/"/>
    
      <category term="router" scheme="http://zqianduan.com/tags/router/"/>
    
      <category term="event" scheme="http://zqianduan.com/tags/event/"/>
    
  </entry>
  
  <entry>
    <title>Nginx Rewrite 规则</title>
    <link href="http://zqianduan.com/2016/03/24/nginx-rewrite-rule/"/>
    <id>http://zqianduan.com/2016/03/24/nginx-rewrite-rule/</id>
    <published>2016-03-24T11:43:20.000Z</published>
    <updated>2017-04-27T07:01:51.000Z</updated>
    
    <content type="html"><![CDATA[<p>Nginx Rewrite 是利用 nginx 提供的全局变量或自己设置的变量，结合正则表达式和标志位实现 url 重写以及重定向。rewrite 只能放在 server{}, location{}, if{} 中，并且只能对域名后边的除去传递的参数外的字符串起作用，例如 <code>http://seanlook.com/a/we/index.php?id=1&amp;u=str</code> 只对 /a/we/index.php 重写。语法 <code>rewrite regex replacement [flag]</code>;</p>
<p>如果相对域名或参数字符串起作用，可以使用全局变量匹配，也可以使用 proxy_pass 反向代理。</p>
<p>表面看 rewrite 和 location 功能有点像，都能实现跳转，主要区别在于 rewrite 是在同一域名内更改获取资源的路径，而 location 是对一类路径做控制访问或反向代理，可以 proxy_pass 到其他机器。很多情况下 rewrite 也会写在 location 里，它们的执行顺序是：<br><a id="more"></a></p>
<ol>
<li>执行 server 块的 rewrite 指令</li>
<li>执行 location 匹配</li>
<li>执行选定的 location 中的 rewrite 指令</li>
</ol>
<p>如果其中某步 URI 被重写，则重新循环执行 1-3，直到找到真实存在的文件；循环超过 10 次，则返回 500 Internal Server Error 错误。</p>
<h2 id="flag-标志位"><a href="#flag-标志位" class="headerlink" title="flag 标志位"></a>flag 标志位</h2><ul>
<li><p><code>last</code>: 相当于 Apache的[L] 标记，表示完成 rewrite</p>
</li>
<li><p><code>break</code>: 停止执行当前虚拟主机的后续 rewrite 指令集</p>
</li>
<li><p><code>redirect</code>: 返回 302 临时重定向，地址栏会显示跳转后的地址</p>
</li>
<li><p><code>permanent</code>: 返回 301 永久重定向，地址栏会显示跳转后的地址</p>
</li>
</ul>
<p>因为 301 和 302 不能简单的只返回状态码，还必须有重定向的 URL，这就是 return 指令无法返回 301, 302 的原因了。这里 last 和 break 区别有点难以理解：</p>
<ol>
<li>last 一般写在 server 和 if 中，而 break 一般使用在 location 中</li>
<li>last 不终止重写后的 url 匹配，即新的 url 会再从 server 走一遍匹配流程，而 break 终止重写后的匹配</li>
<li>break 和 last 都能组织继续执行后面的 rewrite 指令</li>
</ol>
<h2 id="if-指令与全局变量"><a href="#if-指令与全局变量" class="headerlink" title="if 指令与全局变量"></a>if 指令与全局变量</h2><p><strong>if判断指令</strong></p>
<p>语法为 <code>if(condition) {...}</code>，对给定的条件 condition 进行判断。如果为真，大括号内的 rewrite 指令将被执行，if 条件(conditon)可以是如下任何内容：</p>
<ul>
<li><p>当表达式只是一个变量时，如果值为空或任何以 0 开头的字符串都会当做 false</p>
</li>
<li><p>直接比较变量和内容时，使用 <code>=</code> 或 <code>!=</code></p>
</li>
<li><p><code>~</code> 正则表达式匹配，<code>~*</code> 不区分大小写的匹配，<code>!~</code> 区分大小写的不匹配</p>
</li>
<li><p><code>-f</code> 和 <code>!-f</code> 用来判断是否存在文件</p>
</li>
<li><p><code>-d</code> 和 <code>!-d</code> 用来判断是否存在目录</p>
</li>
<li><p><code>-e</code> 和 <code>!-e</code> 用来判断是否存在文件或目录</p>
</li>
<li><p><code>-x</code> 和 <code>!-x</code> 用来判断文件是否可执行</p>
</li>
</ul>
<p>栗子：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"># 如果UA包含"MSIE"，rewrite 请求到 /msid/ 目录下</div><div class="line">if ($http_user_agent ~ MSIE) &#123;</div><div class="line">    rewrite ^(.*)$ /msie/$1 break;</div><div class="line">&#125; </div><div class="line"></div><div class="line"># 如果 cookie 匹配正则，设置变量 $id 等于正则引用部分</div><div class="line">if ($http_cookie ~* "id=([^;]+)(?:;|$)") &#123;</div><div class="line">    set $id $1;</div><div class="line">&#125;</div><div class="line"></div><div class="line"># 如果提交方法为 POST，则返回状态 405（Method not allowed）。return 不能返回 301, 302</div><div class="line">if ($request_method = POST) &#123;</div><div class="line">    return 405;</div><div class="line">&#125;</div><div class="line"></div><div class="line"># 限速，$slow 可以通过 set 指令设置</div><div class="line">if ($slow) &#123;</div><div class="line">    limit_rate 10k;</div><div class="line">&#125; </div><div class="line"></div><div class="line"># 如果请求的文件名不存在，则反向代理到 localhost。这里的 break 也是停止 rewrite 检查</div><div class="line">if (!-f $request_filename)&#123;</div><div class="line">    break;</div><div class="line">    proxy_pass  http://127.0.0.1; </div><div class="line">&#125; </div><div class="line"></div><div class="line"># 如果 query string 中包含"post=140"，永久重定向到 example.com</div><div class="line">if ($args ~ post=140)&#123;</div><div class="line">    rewrite ^ http://example.com/ permanent;</div><div class="line">&#125;</div><div class="line"></div><div class="line"># 防盗链</div><div class="line">location ~* \.(gif|jpg|png|swf|flv)$ &#123;</div><div class="line">    valid_referers none blocked www.jefflei.com www.leizhenfang.com;</div><div class="line">    if ($invalid_referer) &#123;</div><div class="line">        return 404;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>全局变量</strong></p>
<p>下面是可以用作if判断的全局变量：</p>
<ul>
<li><p><code>$args</code>: #这个变量等于请求行中的参数，同$query_string</p>
</li>
<li><p><code>$content_length</code>: 请求头中的Content-length字段。</p>
</li>
<li><p><code>$content_type</code>: 请求头中的Content-Type字段。</p>
</li>
<li><p><code>$document_root</code>: 当前请求在root指令中指定的值。</p>
</li>
<li><p><code>$host</code>: 请求主机头字段，否则为服务器名称。</p>
</li>
<li><p><code>$http_user_agent</code>: 客户端agent信息</p>
</li>
<li><p><code>$http_cookie</code>: 客户端cookie信息</p>
</li>
<li><p><code>$limit_rate</code>: 这个变量可以限制连接速率。</p>
</li>
<li><p><code>$request_method</code>: 客户端请求的动作，通常为GET或POST。</p>
</li>
<li><p><code>$remote_addr</code>: 客户端的IP地址。</p>
</li>
<li><p><code>$remote_port</code>: 客户端的端口。</p>
</li>
<li><p><code>$remote_user</code>: 已经经过Auth Basic Module验证的用户名。</p>
</li>
<li><p><code>$request_filename</code>: 当前请求的文件路径，由root或alias指令与URI请求生成。</p>
</li>
<li><p><code>$scheme</code>: HTTP方法（如http，https）。</p>
</li>
<li><p><code>$server_protocol</code>: 请求使用的协议，通常是HTTP/1.0或HTTP/1.1。</p>
</li>
<li><p><code>$server_addr</code>: 服务器地址，在完成一次系统调用后可以确定这个值。</p>
</li>
<li><p><code>$server_name</code>: 服务器名称。</p>
</li>
<li><p><code>$server_port</code>: 请求到达服务器的端口号。</p>
</li>
<li><p><code>$request_uri</code>: 包含请求参数的原始URI，不包含主机名，如：”/foo/bar.php?arg=baz”。</p>
</li>
<li><p><code>$uri</code>: 不带请求参数的当前URI，$uri不包含主机名，如”/foo/bar.html”。</p>
</li>
<li><p><code>$document_uri</code>: 与$uri相同。</p>
</li>
</ul>
<p>栗子：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># http://localhost:88/test1/test2/test.php</div><div class="line"></div><div class="line">$host = localhost</div><div class="line">$server_port = 88</div><div class="line">$request_uri = http://localhost:88/test1/test2/test.php</div><div class="line">$document_uri = /test1/test2/test.php</div><div class="line">$document_root = /var/www/html</div><div class="line">$request_filename = /var/www/html/test1/test2/test.php</div></pre></td></tr></table></figure>
<h2 id="常用正则"><a href="#常用正则" class="headerlink" title="常用正则"></a>常用正则</h2><ul>
<li><p><code>.</code>: 匹配除换行符以外的任意字符</p>
</li>
<li><p><code>?</code>: 重复0次或1次</p>
</li>
<li><p><code>+</code>: 重复1次或更多次</p>
</li>
<li><p><code>*</code>: 重复0次或更多次</p>
</li>
<li><p><code>\d</code>: 匹配数字</p>
</li>
<li><p><code>^</code>: 匹配字符串的开始</p>
</li>
<li><p><code>$</code>: 匹配字符串的介绍</p>
</li>
<li><p><code>{n}</code>: 重复n次</p>
</li>
<li><p><code>{n,}</code>: 重复n次或更多次</p>
</li>
<li><p><code>[c]</code>: 匹配单个字符c</p>
</li>
<li><p><code>[a-z]</code>: 匹配a-z小写字母的任意一个</p>
</li>
</ul>
<p>小括号 <code>()</code> 之间匹配的内容，可以在后面通过 <code>$1</code> 来引用，<code>$2</code> 表示的是前面第二个 <code>()</code> 里的内容。正则里面容易让人困惑的是 <code>\</code> 转义特殊字符。</p>
<h2 id="rewrite-实例"><a href="#rewrite-实例" class="headerlink" title="rewrite 实例"></a>rewrite 实例</h2><ul>
<li><p>WordPress 伪静态</p>
  <figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">if</span> (-f <span class="variable">$request_filename</span>/index.html) &#123;</div><div class="line">    <span class="attribute">rewrite</span> (.*) <span class="variable">$1</span>/index.html <span class="literal">break</span>;</div><div class="line">&#125;</div><div class="line"><span class="attribute">if</span> (-f <span class="variable">$request_filename</span>/index.php) &#123;</div><div class="line">    <span class="attribute">rewrite</span> (.*) <span class="variable">$1</span>/index.php;</div><div class="line">&#125;</div><div class="line"><span class="attribute">if</span> (!-f <span class="variable">$request_filename</span>) &#123;</div><div class="line">    <span class="attribute">rewrite</span> (.*) /index.php;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>PHPCMS 伪静态</p>
  <figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">rewrite</span><span class="regexp"> ^/caipu-([0-9]+)-([0-9]+)-([0-9]+).html</span> /index.php?m=content&amp;c=index&amp;a=show&amp;catid=<span class="variable">$1</span>&amp;id=<span class="variable">$2</span>&amp;page=<span class="variable">$3</span> <span class="literal">last</span>;</div><div class="line"><span class="attribute">rewrite</span><span class="regexp"> ^/content-([0-9]+)-([0-9]+)-([0-9]+).html</span> /index.php?m=content&amp;c=index&amp;a=show&amp;catid=<span class="variable">$1</span>&amp;id=<span class="variable">$2</span>&amp;page=<span class="variable">$3</span> <span class="literal">last</span>;</div><div class="line"><span class="attribute">rewrite</span><span class="regexp"> ^/list-([0-9]+)-([0-9]+).html</span> /index.php?m=content&amp;c=index&amp;a=lists&amp;catid=<span class="variable">$1</span>&amp;page=<span class="variable">$2</span> <span class="literal">last</span>;</div><div class="line"><span class="attribute">rewrite</span><span class="regexp"> ^/tag-([^\.]*)-([0-9]+)-([0-9]+).html</span> /index.php?m=content&amp;c=tag&amp;catid=<span class="variable">$2</span>&amp;tag=<span class="variable">$1</span>&amp;page=<span class="variable">$3</span> <span class="literal">last</span>;</div><div class="line"><span class="attribute">rewrite</span><span class="regexp"> ^/comment-([0-9]+)-([0-9]+)-([0-9]+).html</span> /index.php?m=comment&amp;c=index&amp;a=init&amp;commentid=content_<span class="variable">$1</span>-<span class="variable">$2</span>-<span class="variable">$3</span> <span class="literal">last</span>;</div><div class="line"><span class="attribute">rewrite</span><span class="regexp"> ^/([^\.]*).html</span> /index.php?m=member&amp;c=index&amp;a=<span class="variable">$1</span> <span class="literal">last</span>;</div></pre></td></tr></table></figure>
</li>
<li><p>DEDECMS 伪静态</p>
  <figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">rewrite</span> <span class="string">"^/index.html$"</span> /index.php <span class="literal">last</span>;</div><div class="line"><span class="attribute">rewrite</span> <span class="string">"^/list-([0-9]+)\.html$"</span> /plus/list.php?tid=<span class="variable">$1</span> <span class="literal">last</span>;</div><div class="line"><span class="attribute">rewrite</span> <span class="string">"^/list-([0-9]+)-([0-9]+)-([0-9]+)\.html$"</span> /plus/list.php?tid=<span class="variable">$1</span>&amp;totalresult=<span class="variable">$2</span>&amp;PageNo=<span class="variable">$3</span> <span class="literal">last</span>;</div><div class="line"><span class="attribute">rewrite</span> <span class="string">"^/view-([0-9]+)-1\.html$"</span> /plus/view.php?arcID=<span class="variable">$1</span> <span class="literal">last</span>;</div><div class="line"><span class="attribute">rewrite</span> <span class="string">"^/view-([0-9]+)-([0-9]+)\.html$"</span> /plus/view.php?aid=<span class="variable">$1</span>&amp;pageno=<span class="variable">$2</span> <span class="literal">last</span>;</div><div class="line"><span class="attribute">rewrite</span> <span class="string">"^/tags.html$"</span> /tags.php <span class="literal">last</span>;</div><div class="line"><span class="attribute">rewrite</span> <span class="string">"^/tag-([0-9]+)-([0-9]+)\.html$"</span> /tags.php?/<span class="variable">$1</span>/<span class="variable">$2</span>/ <span class="literal">last</span>;</div></pre></td></tr></table></figure>
</li>
<li><p>Discuz7 伪静态</p>
  <figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">rewrite</span><span class="regexp"> ^/archiver/((fid|tid)-[\w\-]+\.html)$</span> /archiver/index.php?<span class="variable">$1</span> <span class="literal">last</span>;</div><div class="line"><span class="attribute">rewrite</span><span class="regexp"> ^/forum-([0-9]+)-([0-9]+)\.html$</span> /forumdisplay.php?fid=<span class="variable">$1</span>&amp;page=<span class="variable">$2</span> <span class="literal">last</span>;</div><div class="line"><span class="attribute">rewrite</span><span class="regexp"> ^/thread-([0-9]+)-([0-9]+)-([0-9]+)\.html$</span> /viewthread.php?tid=<span class="variable">$1</span>&amp;extra=page\%3D<span class="variable">$3</span>&amp;page=<span class="variable">$2</span> <span class="literal">last</span>;</div><div class="line"><span class="attribute">rewrite</span><span class="regexp"> ^/space-(username|uid)-(.+)\.html$</span> /space.php?<span class="variable">$1</span>=<span class="variable">$2</span> <span class="literal">last</span>;</div><div class="line"><span class="attribute">rewrite</span><span class="regexp"> ^/tag-(.+)\.html$</span> /tag.php?name=<span class="variable">$1</span> <span class="literal">last</span>;</div></pre></td></tr></table></figure>
</li>
<li><p>DiscuzX 伪静态</p>
  <figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">rewrite</span><span class="regexp"> ^([^\.]*)/topic-(.+)\.html$</span> <span class="variable">$1</span>/portal.php?mod=topic&amp;topic=<span class="variable">$2</span> <span class="literal">last</span>;</div><div class="line"><span class="attribute">rewrite</span><span class="regexp"> ^([^\.]*)/article-([0-9]+)-([0-9]+)\.html$</span> <span class="variable">$1</span>/portal.php?mod=view&amp;aid=<span class="variable">$2</span>&amp;page=<span class="variable">$3</span> <span class="literal">last</span>;</div><div class="line"><span class="attribute">rewrite</span><span class="regexp"> ^([^\.]*)/forum-(\w+)-([0-9]+)\.html$</span> <span class="variable">$1</span>/forum.php?mod=forumdisplay&amp;fid=<span class="variable">$2</span>&amp;page=<span class="variable">$3</span> <span class="literal">last</span>;</div><div class="line"><span class="attribute">rewrite</span><span class="regexp"> ^([^\.]*)/thread-([0-9]+)-([0-9]+)-([0-9]+)\.html$</span> <span class="variable">$1</span>/forum.php?mod=viewthread&amp;tid=<span class="variable">$2</span>&amp;extra=page%3D<span class="variable">$4</span>&amp;page=<span class="variable">$3</span> <span class="literal">last</span>;</div><div class="line"><span class="attribute">rewrite</span><span class="regexp"> ^([^\.]*)/group-([0-9]+)-([0-9]+)\.html$</span> <span class="variable">$1</span>/forum.php?mod=group&amp;fid=<span class="variable">$2</span>&amp;page=<span class="variable">$3</span> <span class="literal">last</span>;</div><div class="line"><span class="attribute">rewrite</span><span class="regexp"> ^([^\.]*)/space-(username|uid)-(.+)\.html$</span> <span class="variable">$1</span>/home.php?mod=space&amp;<span class="variable">$2</span>=<span class="variable">$3</span> <span class="literal">last</span>;</div><div class="line"><span class="attribute">rewrite</span><span class="regexp"> ^([^\.]*)/([a-z]+)-(.+)\.html$</span> <span class="variable">$1</span>/<span class="variable">$2</span>.php?rewrite=<span class="variable">$3</span> <span class="literal">last</span>;</div><div class="line"><span class="attribute">if</span> (!-e <span class="variable">$request_filename</span>) &#123;</div><div class="line">    <span class="attribute">return</span> <span class="number">404</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>PHPWind 伪静态</p>
  <figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">rewrite</span><span class="regexp"> ^(.*)-htm-(.*)$</span> <span class="variable">$1</span>.php?<span class="variable">$2</span> <span class="literal">last</span>;</div><div class="line"><span class="attribute">rewrite</span><span class="regexp"> ^(.*)/simple/([a-z0-9\_]+\.html)$</span> <span class="variable">$1</span>/simple/index.php?<span class="variable">$2</span> <span class="literal">last</span>;</div></pre></td></tr></table></figure>
</li>
<li><p>SHOPEX 伪静态</p>
  <figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">if</span> (!-e <span class="variable">$request_filename</span>) &#123;</div><div class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^/(.+\.(html|xml|json|htm|php|jsp|asp|shtml))$</span> /index.php?<span class="variable">$1</span> <span class="literal">last</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>Typecho 伪静态</p>
  <figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">if</span> (-f <span class="variable">$request_filename</span>/index.html) &#123;</div><div class="line">    <span class="attribute">rewrite</span> (.*) <span class="variable">$1</span>/index.html <span class="literal">break</span>;</div><div class="line">&#125;</div><div class="line"><span class="attribute">if</span> (-f <span class="variable">$request_filename</span>/index.php) &#123;</div><div class="line">    <span class="attribute">rewrite</span> (.*) <span class="variable">$1</span>/index.php;</div><div class="line">&#125;</div><div class="line"><span class="attribute">if</span> (!-f <span class="variable">$request_filename</span>) &#123;</div><div class="line">    <span class="attribute">rewrite</span> (.*) /index.php;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>Emlog 伪静态</p>
  <figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">if</span> (!-f <span class="variable">$request_filename</span>) &#123;</div><div class="line">    <span class="attribute">set</span> <span class="variable">$rule_0</span> <span class="number">1</span><span class="variable">$rule_0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="attribute">if</span> (!-d <span class="variable">$request_filename</span>) &#123;</div><div class="line">  <span class="attribute">set</span> <span class="variable">$rule_0</span> <span class="number">2</span><span class="variable">$rule_0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="attribute">if</span> (<span class="variable">$rule_0</span> = <span class="string">"21"</span>) &#123;</div><div class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^/(post|record|sort|author|page)-([0-9]+)\.html(.*)$</span> /index.php?<span class="variable">$1</span>=<span class="variable">$2</span><span class="variable">$3</span>;</div><div class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^/(post|record|sort|author|page)/([0-9]+)(.*)$</span> /index.php?<span class="variable">$1</span>=<span class="variable">$2</span><span class="variable">$3</span>;</div><div class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^/tag-(.+)\.html$</span> /index.php?tag=<span class="variable">$1</span>;</div><div class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^/tag/(.+)$</span> /index.php?tag=<span class="variable">$1</span>;</div><div class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^/t/page/([0-9]+)$</span> /t/index.php?page=<span class="variable">$1</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Nginx Rewrite 是利用 nginx 提供的全局变量或自己设置的变量，结合正则表达式和标志位实现 url 重写以及重定向。rewrite 只能放在 server{}, location{}, if{} 中，并且只能对域名后边的除去传递的参数外的字符串起作用，例如 &lt;code&gt;http://seanlook.com/a/we/index.php?id=1&amp;amp;u=str&lt;/code&gt; 只对 /a/we/index.php 重写。语法 &lt;code&gt;rewrite regex replacement [flag]&lt;/code&gt;;&lt;/p&gt;
&lt;p&gt;如果相对域名或参数字符串起作用，可以使用全局变量匹配，也可以使用 proxy_pass 反向代理。&lt;/p&gt;
&lt;p&gt;表面看 rewrite 和 location 功能有点像，都能实现跳转，主要区别在于 rewrite 是在同一域名内更改获取资源的路径，而 location 是对一类路径做控制访问或反向代理，可以 proxy_pass 到其他机器。很多情况下 rewrite 也会写在 location 里，它们的执行顺序是：&lt;br&gt;
    
    </summary>
    
      <category term="Server" scheme="http://zqianduan.com/categories/Server/"/>
    
    
      <category term="emlog" scheme="http://zqianduan.com/tags/emlog/"/>
    
      <category term="typecho" scheme="http://zqianduan.com/tags/typecho/"/>
    
      <category term="wordpress" scheme="http://zqianduan.com/tags/wordpress/"/>
    
  </entry>
  
  <entry>
    <title>前端 MVC 变形记</title>
    <link href="http://zqianduan.com/2016/03/23/mvc-deformation/"/>
    <id>http://zqianduan.com/2016/03/23/mvc-deformation/</id>
    <published>2016-03-23T14:59:13.000Z</published>
    <updated>2017-04-27T07:01:51.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>MVC是一种架构设计模式，它通过关注点分离鼓励改进应用程序组织。在过去，MVC被大量用于构建桌面和服务器端应用程序，如今Web应用程序的开发已经越来越向传统应用软件开发靠拢，Web和应用之间的界限也进一步模糊。传统编程语言中的设计模式也在慢慢地融入Web前端开发。由于前端开发的环境特性，在经典MVC模式上也引申出了诸多MV<em>模式，被实现到各个Javascript框架中都有多少的衍变。在研究MV</em>模式和各框架的过程中，却是“剪不断、理还乱”：</p>
<ol>
<li>为什么每个地方讲的MVC都不太一样？</li>
<li>MVP、MVVM的出现是要解决什么问题？</li>
<li>为什么有人义正言辞的说“MVC在Web前端开发中根本无法使用”？</li>
</ol>
<a id="more"></a>
<p>带着十万个为什么去翻阅很多资料，但是看起来像view、model、controller、解耦、监听、通知、主动、被动、注册、绑定、渲染等各种术语的排列组合，像汪峰的歌词似的。本篇希望用通俗易懂的方式阐述清楚一些关系，由于接触时间有限，英文阅读能力有限，可能会存在误解，欢迎讨论和纠正。</p>
<h2 id="MVC变形记"><a href="#MVC变形记" class="headerlink" title="MVC变形记"></a>MVC变形记</h2><h3 id="MVC历史"><a href="#MVC历史" class="headerlink" title="MVC历史"></a>MVC历史</h3><p>MVC最初是在研究Smalltalk-80（1979年）期间设计出来的，恐怕没有一本书能够回到计算机石器时代介绍一下Smalltalk的代码是如何实现MVC的，不仅如此，连想搞清楚当时的应用场景都很难了，都要追溯到80后出生以前的事了。但是当时的图形界面少之又少，施乐公司正在研发友好的用户图形界面，以取代电脑屏幕上那些拒人于千里之外的命令行和DOS提示符。那时计算机世界天地混沌，浑然一体，然后出现了一个创世者，将现实世界抽象出模型形成model，将人机交互从应用逻辑中分离形成view，然后就有了空气、水、鸡啊、蛋什么的。在1995年出版的《设计模式：可复用面向对象软件的基础》对MVC进行了深入的阐述，在推广使用方面发挥了重要作用。</p>
<p>MVC包括三类对象，将他们分离以提高灵活性和复用性。</p>
<ul>
<li><p>模型model用于封装与应用程序的业务逻辑相关的数据以及对数据的处理方法，会有一个或多个视图监听此模型。一旦模型的数据发生变化，模型将通知有关的视图。</p>
</li>
<li><p>视图view是它在屏幕上的表示，描绘的是model的当前状态。当模型的数据发生变化，视图相应地得到刷新自己的机会。</p>
</li>
<li><p>控制器controller定义用户界面对用户输入的响应方式，起到不同层面间的组织作用，用于控制应用程序的流程，它处理用户的行为和数据model上的改变。</p>
</li>
</ul>
<p><img src="http://efe.baidu.com/blog/mvc-deformation/img/typicalMVC.png" alt="经典MVC模式"></p>
<p>实线：方法调用 虚线：事件通知</p>
<p>其中涉及两种设计模式：</p>
<ul>
<li><p>view和model之间的观察者模式，view观察model，事先在此model上注册，以便view可以了解在数据model上发生的改变。</p>
</li>
<li><p>view和controller之间的策略模式</p>
<p>  一个策略是一个表述算法的对象，MVC允许在不改变视图外观的情况下改变视图对用户输入的响应方式。例如，你可能希望改变视图对键盘的响应方式，或希望使用弹出菜单而不是原来的命令键方式。MVC将响应机制封装在controller对象中。存在着一个controller的类层次结构，使得可以方便地对原有的controller做适当改变而创建新的controller。</p>
<p>  view使用controller子类的实例来实现一个特定的响应策略。要实现不同的响应的策略只要用不同种类的controller实例替换即可。甚至可以在运行时刻通过改变view的controller来改变用户输入的响应方式。例如，一个view可以被禁止接受任何输入，只需给他一个忽略输入事件的controller。</p>
</li>
</ul>
<p>好吧，如果被上述言论绕昏了，请继续研读《设计模式：可复用面向对象软件的基础》。</p>
<h3 id="MVC-for-JAVASCRIPT"><a href="#MVC-for-JAVASCRIPT" class="headerlink" title="MVC for JAVASCRIPT"></a>MVC for JAVASCRIPT</h3><p>我们回顾了经典的MVC，接下来讲到的MVC主要是在Javascript上的实现。</p>
<p><img src="http://efe.baidu.com/blog/mvc-deformation/img/javascriptMVC.png" alt="javascript MVC模式"></p>
<p>如图所示，view承接了部分controller的功能，负责处理用户输入，但是不必了解下一步做什么。它依赖于一个controller为她做决定或处理用户事件。事实上，前端的view已经具备了独立处理用户事件的能力，如果每个事件都要流经controller，势必增加复杂性。同时，view也可以委托controller处理model的更改。model数据变化后通知view进行更新，显示给用户。这个过程是一个圆，一个循环的过程。</p>
<p>这种从经典MVC到Javascript MVC的1对1转化，导致控制器的角色有点尴尬。MVC这样的结构的正确性在于，任何界面都需要面对一个用户，而controller “是用户和系统之间的链接”。在经典MVC中，controller要做的事情多数是派发用户输入给不同的view，并且在必要的时候从view中获取用户输入来更改model，而Web以及绝大多数现在的UI系统中，controller的职责已经被系统实现了。由于某种原因，控制器和视图的分界线越来越模糊，也有认为，view启动了action理论上应该把view归属于controller。比如在Backbone中，Backbone.View和Backbone.Router一起承担了controller的责任。这就为MVC中controller的衍变埋下了伏笔。</p>
<h4 id="MVP"><a href="#MVP" class="headerlink" title="MVP"></a>MVP</h4><p>MVP（model-view-Presenter）是经典MVC设计模式的一种衍生模式，是在1990年代Taligent公司创造的，一个用于C++ CommonPoint的模型。背景上不再考证，直接上图看一下与MVC的不同。</p>
<p><img src="http://efe.baidu.com/blog/mvc-deformation/img/mvp.png" alt="MVP模式"></p>
<p>经典MVC中，一对controller-view捆绑起来表示一个ui组件，controller直接接受用户输入，并将输入转为相应命令来调用model的接口，对model的状态进行修改，最后通过观察者模式对view进行重新渲染。</p>
<p>进化为MVP的切入点是修改controller-view的捆绑关系，为了解决controller-view的捆绑关系，将进行改造，使view不仅拥有UI组件的结构，还拥有处理用户事件的能力，这样就能将controller独立出来。为了对用户事件进行统一管理，view只负责将用户产生的事件传递给controller，由controller来统一处理，这样的好处是多个view可共用同一个controller。此时的controller也由组件级别上升到了应用级别，然而更新view的方式仍然与经典MVC一样：通过Presenter更新model，通过观察者模式更新view。</p>
<p>另一个显而易见的不同在于，MVC是一个圆，一个循环的过程，但MVP不是，依赖Presenter作为核心，负责从model中拿数据，填充到view中。常见的MVP的实现是被动视图(passive view),Presenter观察model，不再是view观察model，一旦model发生变化，就会更新view。Presenter有效地绑定了model到view。view暴露了setters接口以便Presenter可以设置数据。对于这种被动视图的结构，没有直接数据绑定的概念。但是他的好处是在view和model直接提供更清晰的分离。但是由于缺乏数据绑定支持，意味着不得不单独关注某个任务。在MVP里，应用程序的逻辑主要在Presenter来实现，其中的view是很薄的一层。</p>
<h4 id="MVVM"><a href="#MVVM" class="headerlink" title="MVVM"></a>MVVM</h4><p>MVVM，Model-View-ViewModel，最初是由微软在使用Windows Presentation Foundation和SilverLight时定义的，2005年John Grossman在一篇关于Avalon（WPF 的代号）的博客文章中正式宣布了它的存在。如果你用过Visual Studio, 新建一个WPF Application，然后在“设计”中拖进去一个控件、双击后在“代码”中写事件处理函数、或者绑定数据源。就对这个MVVM有点感觉了。比如VS自动生成的如下代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">GroupBox</span> <span class="attr">Header</span>=<span class="string">"绑定对象"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">StackPanel</span> <span class="attr">Orientation</span>=<span class="string">"Horizontal"</span> <span class="attr">Name</span>=<span class="string">"stackPanel1"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">TextBlock</span> <span class="attr">Text</span>=<span class="string">"学号:"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">TextBlock</span> <span class="attr">Text</span>=<span class="string">"&#123;Binding Path=StudentID&#125;"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">TextBlock</span> <span class="attr">Text</span>=<span class="string">"姓名:"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">TextBlock</span> <span class="attr">Text</span>=<span class="string">"&#123;Binding Path=Name&#125;"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">TextBlock</span> <span class="attr">Text</span>=<span class="string">"入学日期:"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">TextBlock</span> <span class="attr">Text</span>=<span class="string">"&#123;Binding Path=EntryDate, StringFormat=yyyy-MM-dd&#125;"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">TextBlock</span> <span class="attr">Text</span>=<span class="string">"学分:"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">TextBlock</span> <span class="attr">Text</span>=<span class="string">"&#123;Binding Path=Credit&#125;"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">StackPanel</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">GroupBox</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">stackPanel1.DataContext = <span class="keyword">new</span> Student() &#123;</div><div class="line">    StudentID=<span class="number">20130501</span>,</div><div class="line">    Name=<span class="string">"张三"</span>,</div><div class="line">    EntryDate=DateTime.Parse(<span class="string">"2013-09-01"</span>),</div><div class="line">    Credit=<span class="number">0.0</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>其中最重要的特性之一就是数据绑定，Data-binding。没有前后端分离，一个开发人员全搞定，一只手抓业务逻辑、一只手抓数据访问，顺带手拖放几个UI控件，绑定数据源到某个对象或某张表，一步到位。</p>
<p>背景介绍完毕，再来看一下理论图</p>
<p><img src="http://efe.baidu.com/blog/mvc-deformation/img/mvvm.png" alt="MVVM模式"></p>
<p>首先，view和model是不知道彼此存在的，同MVP一样，将view和model清晰地分离开来。 其次，view是对viewmodel的外在显示，与viewmodel保持同步，viewmodel对象可以看作是view的上下文。view绑定到viewmodel的属性上，如果viewmodel中的属性值变化了，这些新值通过数据绑定会自动传递给view。反过来viewmodel会暴露model中的数据和特定状态给view。 所以，view不知道model的存在，viewmodel和model也觉察不到view。事实上，model也完全忽略viewmodel和view的存在。这是一个非常松散耦合的设计。</p>
<h2 id="流行的MV-框架："><a href="#流行的MV-框架：" class="headerlink" title="流行的MV*框架："></a>流行的MV*框架：</h2><p>每个框架都有自己的特性，这里主要讨论MVC三个角色的责任。粗浅地过一遍每个框架的代码结构和风格。</p>
<h3 id="BackboneJS"><a href="#BackboneJS" class="headerlink" title="BackboneJS"></a>BackboneJS</h3><p>Backbone通过提供模型Model、集合Collection、视图View赋予了Web应用程序分层结构，其中模型包含领域数据和自定义事件；集合Colection是模型的有序或无序集合，带有丰富的可枚举API； 视图可以声明事件处理函数。最终将模型、集合、视图与服务端的RESTful JSON接口连接。</p>
<p>Backbone在升级的过程中，去掉了controller，由view和router代替controller，view集中处理了用户事件（如click，keypress等）、渲染HTML模板、与模型数据的交互。Backbone的model没有与UI视图数据绑定，而是需要在view中自行操作DOM来更新或读取UI数据。Router为客户端路由提供了许多方法，并能连接到指定的动作（actions）和事件（events）。</p>
<p>Backbone是一个小巧灵活的库，只是帮你实现一个MVC模式的框架，更多的还需要自己去实现。适合有一定Web基础，喜欢原生JS去操作DOM（因为没有数据绑定）的开发人员。为什么称它为库，而不是框架，不仅仅是由于仅4KB的代码，更重要的是 使用一个库，你有控制权。如果用一个框架，控制权就反转了，变成框架在控制你。库能够给予灵活和自由，但是框架强制使用某种方式，减少重复代码。这便是Backbone与Angular的区别之一了。</p>
<p>至于Backbone属于MV*中的哪种模式，有人认为不是MVC，有人觉得更接近于MVP，事实上，它借用多个架构模式中一些很好的概念，创建一个运行良好的灵活框架。不必拘泥于某种模式。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// view:</span></div><div class="line"><span class="keyword">var</span> Appview = Backbone.View.extend(&#123;</div><div class="line">    <span class="comment">// 每个view都需要一个指向DOM元素的引用，就像ER中的main属性。</span></div><div class="line">    el: <span class="string">'#container'</span>,</div><div class="line"></div><div class="line">    <span class="comment">// view中不包含html标记，有一个链接到模板的引用。</span></div><div class="line">    template: _.template(<span class="string">"&lt;h3&gt;Hello &lt;%= who %&gt;&lt;/h3&gt;"</span>),</div><div class="line"></div><div class="line">    <span class="comment">// 初始化方法</span></div><div class="line">    initialize: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">      <span class="keyword">this</span>.render();</div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    <span class="comment">// $el是一个已经缓存的jQuery对象</span></div><div class="line">    render: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">      <span class="keyword">this</span>.$el.html(<span class="string">"Hello World"</span>);</div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    <span class="comment">// 事件绑定</span></div><div class="line">    events: &#123;<span class="string">'keypress #new-todo'</span>: <span class="string">'createTodoOnEnter'</span>&#125;</div><div class="line">&#125;);</div><div class="line"><span class="keyword">var</span> appview = <span class="keyword">new</span> Appview();</div><div class="line"></div><div class="line"><span class="comment">// model:</span></div><div class="line"><span class="comment">// 每个应用程序的核心、包含了交互数据和逻辑</span></div><div class="line"><span class="comment">// 如数据验证、getter、setter、默认值、数据初始化、数据转换</span></div><div class="line"><span class="keyword">var</span> app = &#123;&#125;;</div><div class="line"></div><div class="line">app.Todo = Backbone.model.extend(&#123;</div><div class="line">  <span class="attr">defaults</span>: &#123;</div><div class="line">    <span class="attr">title</span>: <span class="string">''</span>,</div><div class="line">    <span class="attr">completed</span>: <span class="literal">false</span></div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 创建一个model实例</span></div><div class="line"><span class="keyword">var</span> todo = <span class="keyword">new</span> app.Todo(&#123;<span class="attr">title</span>: <span class="string">'Learn Backbone.js'</span>, <span class="attr">completed</span>: <span class="literal">false</span>&#125;);</div><div class="line">todo.get(<span class="string">'title'</span>); <span class="comment">// "Learn Backbone.js"</span></div><div class="line">todo.get(<span class="string">'completed'</span>); <span class="comment">// false</span></div><div class="line">todo.get(<span class="string">'created_at'</span>); <span class="comment">// undefined</span></div><div class="line">todo.set(<span class="string">'created_at'</span>, <span class="built_in">Date</span>());</div><div class="line">todo.get(<span class="string">'created_at'</span>); <span class="comment">// "Wed Sep 12 2012 12:51:17 GMT-0400 (EDT)"</span></div><div class="line"></div><div class="line"><span class="comment">// collection：</span></div><div class="line"><span class="comment">// model的有序集合，可以设置或获取model</span></div><div class="line"><span class="comment">// 监听集合中的数据变化，从后端获取模型数据、持久化。</span></div><div class="line">app.TodoList = Backbone.Collection.extend(&#123;</div><div class="line">  <span class="attr">model</span>: app.Todo,</div><div class="line">  <span class="attr">localStorage</span>: <span class="keyword">new</span> Store(<span class="string">"backbone-todo"</span>)</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// collection实例</span></div><div class="line"><span class="keyword">var</span> todoList = <span class="keyword">new</span> app.TodoList()</div><div class="line">todoList.create(&#123;<span class="attr">title</span>: <span class="string">'Learn Backbone\'s Collection'</span>&#125;);</div><div class="line"></div><div class="line"><span class="comment">// model实例</span></div><div class="line"><span class="keyword">var</span> model = <span class="keyword">new</span> app.Todo(&#123;<span class="attr">title</span>: <span class="string">'Learn models'</span>, <span class="attr">completed</span>: <span class="literal">true</span>&#125;);</div><div class="line">todoList.add(model);</div><div class="line">todoList.pluck(<span class="string">'title'</span>);</div><div class="line">todoList.pluck(<span class="string">'completed'</span>);</div></pre></td></tr></table></figure>
<h3 id="KnockoutJS"><a href="#KnockoutJS" class="headerlink" title="KnockoutJS"></a>KnockoutJS</h3><p>KnockoutJS是一个名正言顺的MVVM框架，通过简洁易读的data-bind语法，将DOM元素与viewmodel关联起来。当模型（viewmodel）状态更新时，自动更新UI界面。 viewmodel是model和view上的操作的一个连接，是一个纯粹的Javascript对象。它不是UI，没有控件和样式的概念，它也不是持久化的模型数据，它只是hold住一些用户正在编辑的数据，然后暴露出操作这些数据（增加或删除）的方法。</p>
<p>view是对viewmodel中数据的一个可视化的显示，view观察viewmodel，操作view时会发送命令到viewmodel，并且当viewmodel变化时更新。view和model是不了解彼此的存在的。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">data-bind</span>=<span class="string">"submit: addItem"</span>&gt;</span></div><div class="line">    New item:</div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">data-bind</span>=<span class="string">'value: itemToAdd, valueUpdate: "afterkeydown"'</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">data-bind</span>=<span class="string">"enable: itemToAdd().length &gt; 0"</span>&gt;</span>Add<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Your items:<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">multiple</span>=<span class="string">"multiple"</span> <span class="attr">width</span>=<span class="string">"50"</span> <span class="attr">data-bind</span>=<span class="string">"options: items"</span>&gt;</span> <span class="tag">&lt;/<span class="name">select</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// viewmodel</span></div><div class="line"><span class="keyword">var</span> SimpleListmodel = <span class="function"><span class="keyword">function</span>(<span class="params">items</span>) </span>&#123;</div><div class="line">    <span class="keyword">this</span>.items = ko.observableArray(items);</div><div class="line">    <span class="keyword">this</span>.itemToAdd = ko.observable(<span class="string">""</span>);</div><div class="line">    <span class="keyword">this</span>.addItem = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.itemToAdd() != <span class="string">""</span>) &#123;</div><div class="line">            <span class="comment">// 把input中的值加入到items，会自动更新select控件</span></div><div class="line">            <span class="keyword">this</span>.items.push(<span class="keyword">this</span>.itemToAdd());</div><div class="line">            <span class="comment">// 清空input中的值</span></div><div class="line">            <span class="keyword">this</span>.itemToAdd(<span class="string">""</span>);</div><div class="line">        &#125;</div><div class="line">    <span class="comment">// 确保这里的this一直是viewmodel</span></div><div class="line">    &#125;.bind(<span class="keyword">this</span>);</div><div class="line">&#125;;</div><div class="line"></div><div class="line">ko.applyBindings(<span class="keyword">new</span> SimpleListmodel([<span class="string">"Alpha"</span>, <span class="string">"Beta"</span>, <span class="string">"Gamma"</span>]));</div></pre></td></tr></table></figure>
<h3 id="AngularJS"><a href="#AngularJS" class="headerlink" title="AngularJS"></a>AngularJS</h3><p>AngularJS试图成为Web应用中的一种端对端的解决方案。这意味着它不只是你的Web应用中的一个小部分，而是一个完整的端对端的解决方案。这会让AngularJS在构建一个CRUD的应用时看起来很呆板，缺乏灵活性。AngularJS是为了克服HTML在构建应用上的不足而设计的。使用了不同的方法，它尝试去补足HTML本身在构建应用方面的缺陷。通过使用标识符(directives)的结构，让浏览器能够识别新的语法。例如使用双大括号语法进行数据绑定；使用ng-controller指定每个控制器负责监视视图中的哪一部分；使用ng-model，把输入数据绑定到模型中的一部分属性上。</p>
<p>双向数据绑定是AngularJS的另一个特性。UI控件的任何更改会立即反映到模型变量（一个方向），模型变量的任何更改都会立即反映到问候语文本中（另一方向）。AngularJS通过作用域来保持数据模型与视图界面UI的双向同步。一旦模型状态发生改变，AngularJS会立即刷新反映在视图界面中，反之亦然。</p>
<p>AngularJS原本是倾向于MVC，但是随着项目重构和版本升级，现在更接近MVVM。和Knockout view中的风格类似，都像从WPF衍变过来的，只是Knockout使用了自定义属性data-bind作为绑定入口，而AngularJS对于HTML的变革更彻底，扩展HTML的语法，引入一系列的指令。</p>
<p>在AngularJS中，一个视图是模型通过HTML模板渲染之后的映射。这意味着，不论模型什么时候发生变化，AngularJS会实时更新结合点，随之更新视图。比如，视图组件被AngularJS用下面这个模板构建出来：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-controller</span>=<span class="string">"PhoneListCtrl"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">ng-repeat</span>=<span class="string">"phone in phones"</span>&gt;</span></div><div class="line">            &#123;&#123;phone.name&#125;&#125;</div><div class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;phone.snippet&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div></pre></td></tr></table></figure>
<p>在li标签里面的ng-repeat语句是一个AngularJS迭代器。包裹在phone.name和phone.snippet周围的花括号标识着数据绑定，是对应用一个数据模型的引用。当页面加载的时候，AngularJS会根据模版中的属性值，将其与数据模型中相同名字的变量绑定在一起，以确保两者的同步性。</p>
<p>在PhoneListCtrl控制器里面初始化了数据模型：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// controller:</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">PhoneListCtrl</span>(<span class="params">$scope</span>) </span>&#123;</div><div class="line">  <span class="comment">// 数组中存储的对象是手机数据列表</span></div><div class="line">  $scope.phones = [</div><div class="line">    &#123;<span class="string">"name"</span>: <span class="string">"Nexus S"</span>,</div><div class="line">     <span class="string">"snippet"</span>: <span class="string">"Fast just got faster with Nexus S."</span>&#125;,</div><div class="line">    &#123;<span class="string">"name"</span>: <span class="string">"Motorola XOOM™ with Wi-Fi"</span>,</div><div class="line">     <span class="string">"snippet"</span>: <span class="string">"The Next, Next Generation tablet."</span>&#125;,</div><div class="line">    &#123;<span class="string">"name"</span>: <span class="string">"MOTOROLA XOOM™"</span>,</div><div class="line">     <span class="string">"snippet"</span>: <span class="string">"The Next, Next Generation tablet."</span>&#125;</div><div class="line">  ];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>尽管控制器看起来并没有什么控制的作用，但是它在这里的重要性在于，通过给定数据模型的作用域$scope，允许建立模型和视图之间的数据绑定。方法名PhoneListCtrl和body标签里面的ngcontroller指令的值相匹配。当应用启动之后，会有一个根作用域被创建出来，而控制器的作用域是根作用域的一个典型后继。这个控制器的作用域对所有<br>标记内部的数据绑定有效。</p>
<p>AngularJS的作用域理论非常重要：一个作用域可以视作模板、模型和控制器协同工作的粘接器。AngularJS使用作用域，同时还有模板中的信息，数据模型和控制器。这些可以帮助模型和视图分离，但是他们两者确实是同步的！任何对于模型的更改都会即时反映在视图上；任何在视图上的更改都会被立刻体现在模型中。</p>
<h2 id="实践中的思考"><a href="#实践中的思考" class="headerlink" title="实践中的思考"></a>实践中的思考</h2><p>我们使用的MVC框架是ER，适用于并能很方便地构建一个整站式的AJAX Web应用。提供精简、核心的action、model和view的抽象，使得构建RIA应用变得简单可行。在使用的过程中近距离地体会到非常多方面的优秀的设计理念。也让我开始思考各个角色的转型。</p>
<h3 id="让view上前线"><a href="#让view上前线" class="headerlink" title="让view上前线"></a>让view上前线</h3><p>我开始思考action（controller）这个角色。我觉得从纯粹地解耦角度来说，view和model应该是互相不知道彼此存在的，所有的事件流和对数据、UI的处理应该都流经action。但是这一点又极不现实。用户操作了一个UI，需要更新model的一个数据，就要fire到action，通过action来调用model的set方法。这样又有点麻烦，因为view中有对model的应用，可以一句代码搞定这一个数据的设置。所以，我自己设置了一个规则：如果是简单的模型数据读写可以直接在view中操作；如果要经过复杂的数据处理，必须流经action。于是，我遇到了一种怎么都偷不了懒（必须经过action）的情况： 比如有个主action main，两个子action list、select，用户在list中的view选择一条数据添加到右侧select中。那走过的流程是这样的：</p>
<p><img src="http://efe.baidu.com/blog/mvc-deformation/img/practice.png" alt="实践中的思考"></p>
<ol>
<li>子Action中的listView接受UI事件，fire到listAction中</li>
<li>listAction继续将事件fire到mainView中，由主action来处理另外子Action的事情。</li>
<li>mainView接收到事件、调用子Action selectAction的方法</li>
<li>selectAction继续调用selectView的方法来完成UI的更新。</li>
</ol>
<p>其中涉及的model的变化暂时不考虑。我在想，view既然把经典MVC中的controller接受用户事件的角色承接过来的，那如果借鉴Backbone的思想，把view作为controller的一个实现，推到战场的最前线。省掉两次action的中转传递，是不是更简单。</p>
<h3 id="model驱动开发"><a href="#model驱动开发" class="headerlink" title="model驱动开发"></a>model驱动开发</h3><p>实际开发中，常常会以view为核心，页面上需要展示什么数据，就去model中设置数据源。发生了用户事件，我会在action中更新model，然后刷新view。有时候会遗漏更新model，直到需要数据时才发现没有保存到model中。</p>
<p>model本身是独立的，自控制的，不依赖于view，能够同步支持多view的显示。就像linux上的应用程序通常会提供图形界面和命令行两种操作方式一样。那如果以model为核心，model驱动开发，数据在手、天下我有，以模型验证保证数据的完整性和正确性。实现数据绑定，任何对模型的更改都会在界面上反映出来。那我们只要预先写好view和model的关系映射（类似viewmodel），然后只关注模型数据，就OK了。</p>
<p><strong>对于MV<em>家族，都是在经典MVC基础上随着时代的发展、应用环境的变化衍变出来的。实现MV</em>模式的这些框架到底归属于哪种模式，也不必泥古。MV<em>是一个很有争议性的话题，能够构建一个健壮、具有良好设计、遵从关注点分离的项目比花时间去争论到底是MV</em>更有意义。</strong></p>
<blockquote>
<p>本文转载自：<a href="http://efe.baidu.com/blog/mvc-deformation/" target="_blank" rel="external">http://efe.baidu.com/blog/mvc-deformation/</a></p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h2&gt;&lt;p&gt;MVC是一种架构设计模式，它通过关注点分离鼓励改进应用程序组织。在过去，MVC被大量用于构建桌面和服务器端应用程序，如今Web应用程序的开发已经越来越向传统应用软件开发靠拢，Web和应用之间的界限也进一步模糊。传统编程语言中的设计模式也在慢慢地融入Web前端开发。由于前端开发的环境特性，在经典MVC模式上也引申出了诸多MV&lt;em&gt;模式，被实现到各个Javascript框架中都有多少的衍变。在研究MV&lt;/em&gt;模式和各框架的过程中，却是“剪不断、理还乱”：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;为什么每个地方讲的MVC都不太一样？&lt;/li&gt;
&lt;li&gt;MVP、MVVM的出现是要解决什么问题？&lt;/li&gt;
&lt;li&gt;为什么有人义正言辞的说“MVC在Web前端开发中根本无法使用”？&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
      <category term="Javascript" scheme="http://zqianduan.com/categories/Javascript/"/>
    
    
      <category term="angular" scheme="http://zqianduan.com/tags/angular/"/>
    
      <category term="mvvm" scheme="http://zqianduan.com/tags/mvvm/"/>
    
  </entry>
  
  <entry>
    <title>前端优秀文章导航</title>
    <link href="http://zqianduan.com/2016/03/22/front-end-excellent-article-navigate/"/>
    <id>http://zqianduan.com/2016/03/22/front-end-excellent-article-navigate/</id>
    <published>2016-03-22T13:07:31.000Z</published>
    <updated>2017-04-27T07:01:51.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Javascript"><a href="#Javascript" class="headerlink" title="Javascript"></a>Javascript</h2><ul>
<li><p><a href="http://web.jobbole.com/82201/" target="_blank" rel="external">解析 Facebook 的 Flux 应用架构</a></p>
</li>
<li><p><a href="https://segmentfault.com/a/1190000000732617" target="_blank" rel="external">有趣的 HTML5：离线存储</a></p>
</li>
<li><p><a href="http://www.ibm.com/developerworks/cn/web/wa-jsmemory/" target="_blank" rel="external">了解 JavaScript 应用程序中的内存泄漏</a></p>
<a id="more"></a>
</li>
<li><p><a href="https://www.h5jun.com/post/left-pad.html" target="_blank" rel="external">由NPM引发的关于 left-pad 的那些事儿</a></p>
</li>
<li><p><a href="https://github.com/livoras/blog/issues/8" target="_blank" rel="external">JavaScript 基于时间的动画算法</a></p>
</li>
<li><p><a href="http://www.cnblogs.com/whitewolf/p/javascript-single-thread-and-browser-event-loop.html" target="_blank" rel="external">JavaScript单线程和浏览器事件循环简述</a></p>
</li>
<li><p><a href="https://segmentfault.com/a/1190000003933990" target="_blank" rel="external">Sizzle选择器引擎原理分析</a></p>
</li>
<li><p><a href="http://yanhaijing.com/html/2016/03/12/html5-video/" target="_blank" rel="external">HTML5视频的那些事儿</a></p>
</li>
<li><p><a href="http://matrix.h5jun.com/slide/show?id=117" target="_blank" rel="external">前端动画原理与实现</a></p>
</li>
<li><p><a href="http://www.cnblogs.com/coco1s/p/5261646.html" target="_blank" rel="external">【深入浅出jQuery】源码浅析–整体架构</a></p>
</li>
<li><p><a href="http://www.cnblogs.com/coco1s/p/5303041.html" target="_blank" rel="external">【深入浅出jQuery】源码浅析2–奇技淫巧</a></p>
</li>
<li><p><a href="http://blog.h5jun.com/post/inherits.html" target="_blank" rel="external">从本质认识JavaScript的原型继承和类继承</a></p>
</li>
<li><p><a href="http://www.zcfy.cc/article/425" target="_blank" rel="external">3 种不同的原型继承： ES6+ 版本</a></p>
</li>
<li><p><a href="http://www.cnblogs.com/lovesueee/p/4442509.html" target="_blank" rel="external">Angular系列文章之angular路由</a></p>
</li>
<li><p><a href="http://www.cnblogs.com/ywang1724/p/3946339.html" target="_blank" rel="external">常用排序算法之JavaScript实现</a></p>
</li>
<li><p><a href="http://www.nowamagic.net/librarys/veda/detail/255" target="_blank" rel="external">JavaScript排序算法之归并排序</a></p>
</li>
<li><p><a href="https://www.h5jun.com/post/array-shuffle.html" target="_blank" rel="external">数组的完全随机排列</a></p>
</li>
<li><p><a href="http://coolshell.cn/articles/2704.html" target="_blank" rel="external">检查素数的正则表达式</a></p>
</li>
<li><p><a href="http://ouvens.github.io/frontend-javascript/2015/12/28/nine-browser-cache-methods.html" target="_blank" rel="external">九种浏览器端缓存机制知多少</a></p>
</li>
<li><p><a href="https://yq.aliyun.com/articles/50624" target="_blank" rel="external">作为前端应当了解的Web缓存知识</a></p>
</li>
<li><p><a href="http://zqianduan.com/2016/03/22/front-end-excellent-article-navigate/">Vue.js：轻量高效的前端组件化方案</a></p>
</li>
<li><p><a href="http://www.cnblogs.com/axes/p/4603984.html" target="_blank" rel="external">移动前端—图片压缩上传实践</a></p>
</li>
<li><p><a href="https://github.com/berwin/Blog/issues/11" target="_blank" rel="external">深入浅出 - vue之深入响应式原理</a></p>
</li>
<li><p><a href="http://zcfy.cc/article/513" target="_blank" rel="external">JavaScript 创建对象: 方法一览与最佳实践</a></p>
</li>
<li><p><a href="http://qianduan.guru/2016/08/13/gesture_detection_in_html5/" target="_blank" rel="external">HTML5 手势检测原理和实现</a></p>
</li>
<li><p><a href="http://www.ituring.com.cn/article/48461" target="_blank" rel="external">从零开始编写自己的JavaScript框架</a></p>
</li>
<li><p><a href="http://www.zcfy.cc/article/1211" target="_blank" rel="external">React中一个没人能解释清楚的问题——为什么要使用Virtual DOM</a></p>
</li>
<li><p><a href="http://www.alloyteam.com/2016/12/learn-rxjs/" target="_blank" rel="external">构建流式应用—RxJS详解</a></p>
</li>
<li><p><a href="http://mp.weixin.qq.com/s/9-vW_zeocvQYrzZ1Bn1uiw" target="_blank" rel="external">Redux 与异步数据逻辑封装</a></p>
</li>
<li><p><a href="https://zhuanlan.zhihu.com/p/24336831?refer=study-fe" target="_blank" rel="external">ES 5 新增特性汇总</a></p>
</li>
<li><p><a href="https://zhuanlan.zhihu.com/p/24570791" target="_blank" rel="external">ES 6 新特性汇总（一图全览）</a></p>
</li>
<li><p><a href="http://mp.weixin.qq.com/s/9-vW_zeocvQYrzZ1Bn1uiw" target="_blank" rel="external">ECMAScript 6 规范总结</a></p>
</li>
</ul>
<h2 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h2><ul>
<li><p><a href="http://www.ibm.com/developerworks/cn/web/1409_chengfu_css3flexbox/" target="_blank" rel="external">深入理解 CSS3 弹性盒布局模型</a></p>
</li>
<li><p><a href="http://div.io/topic/1092" target="_blank" rel="external">移动端高清、多屏适配方案</a></p>
</li>
<li><p><a href="http://www.html-js.com/article/Like-the-winter-flexible-design-and-implementation-of-the-mobile-phone-Taobao-cold" target="_blank" rel="external">手机淘宝的flexible设计与实现</a></p>
</li>
<li><p><a href="http://www.nihaoshijie.com.cn/index.php/archives/593" target="_blank" rel="external">移动web适配之rem</a></p>
</li>
<li><p><a href="http://www.ibm.com/developerworks/cn/web/1604-postcss-css/index.html" target="_blank" rel="external">使用 PostCSS 进行 CSS 处理</a> </p>
</li>
<li><p><a href="https://xinranliu.me/2015-05-09-1px-in-retina/" target="_blank" rel="external">Retina 屏幕下的 1px 边框</a></p>
</li>
</ul>
<h2 id="构建工具"><a href="#构建工具" class="headerlink" title="构建工具"></a>构建工具</h2><ul>
<li><p><a href="https://github.com/ericdum/mujiang.info/issues/6/" target="_blank" rel="external">NPM 的 package.json 中文文档</a></p>
</li>
<li><p><a href="https://segmentfault.com/a/1190000005659878" target="_blank" rel="external">Webpack 前端构建集成方案</a></p>
</li>
<li><p><a href="https://segmentfault.com/a/1190000005969488" target="_blank" rel="external">使用 webpack + react + redux + es6 开发组件化前端项目</a></p>
</li>
</ul>
<h2 id="开发者手册"><a href="#开发者手册" class="headerlink" title="开发者手册"></a>开发者手册</h2><ul>
<li><p><a href="http://devdocs.io/" target="_blank" rel="external">DevDocs</a></p>
</li>
<li><p><a href="http://bonsaiden.github.io/JavaScript-Garden/zh/" target="_blank" rel="external">JavaScript 秘密花园</a></p>
</li>
<li><p><a href="http://www.ruanyifeng.com/blog/2014/05/restful_api.html" target="_blank" rel="external">RESTful API 设计指南</a></p>
</li>
<li><p><a href="https://github.com/markyun/My-blog/tree/master/Front-end-Developer-Questions/Questions-and-Answers" target="_blank" rel="external">前端开发面试题</a></p>
</li>
<li><p><a href="http://docs.huihoo.com/jquery/jquery-fundamentals/zh-cn/index.html" target="_blank" rel="external">jQuery 基本原理</a></p>
</li>
<li><p><a href="http://es6.ruanyifeng.com/" target="_blank" rel="external">ECMAScript 6入门</a></p>
</li>
<li><p><a href="http://javascript.ruanyifeng.com/" target="_blank" rel="external">JavaScript 标准参考教程（alpha）</a></p>
</li>
<li><p><a href="http://css.doyoe.com/" target="_blank" rel="external">CSS参考手册</a></p>
</li>
<li><p><a href="http://www.css88.com/doc/backbone/" target="_blank" rel="external">Backbone.js(1.1.2) API中文文档</a></p>
</li>
<li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide" target="_blank" rel="external">MDN JavaScript 指南</a></p>
</li>
<li><p><a href="http://es6.ruanyifeng.com/" target="_blank" rel="external">ECMAScript 6 入门</a></p>
</li>
<li><p><a href="http://blog.csdn.net/vbdfforever/article/details/50727462" target="_blank" rel="external">ECMAScript 6规范总结</a></p>
</li>
<li><p><a href="http://cn.redux.js.org/" target="_blank" rel="external">Redux 中文文档</a></p>
</li>
<li><p><a href="http://linuxtools-rst.readthedocs.io/zh_CN/latest/base/index.html" target="_blank" rel="external">Linux基础</a></p>
</li>
<li><p><a href="http://man.linuxde.net/" target="_blank" rel="external">Linux命令大全</a></p>
</li>
</ul>
<h2 id="大前端"><a href="#大前端" class="headerlink" title="大前端"></a>大前端</h2><ul>
<li><p><a href="http://www.w3cplus.com/javascript/state-of-the-art-javascript-in-2016.html" target="_blank" rel="external">2016年JavaScript技术栈展望</a></p>
</li>
<li><p><a href="http://www.jianshu.com/p/c6257701d682" target="_blank" rel="external">你可能不知道的font</a></p>
</li>
<li><p><a href="http://taobaofed.org/blog/2015 /12/17/seller-bigpipe/" target="_blank" rel="external">新版卖家中心 Bigpipe 实践（一）</a></p>
</li>
<li><p><a href="http://taobaofed.org/blog/2016/03/25/seller-bigpipe-coding/" target="_blank" rel="external">新版卖家中心 Bigpipe 实践（二）</a></p>
</li>
<li><p><a href="http://blog.jobbole.com/12749/" target="_blank" rel="external">现代浏览器的工作原理</a></p>
</li>
<li><p><a href="http://mp.weixin.qq.com/s?__biz=MzIzMzEzODYwOA==&amp;mid=417196806&amp;idx=1&amp;sn=fb9beaec30a5836e754d4a5be81d5cec" target="_blank" rel="external">京东资深前端架构师分享前端工程化在电商首页中的实践</a></p>
</li>
<li><p><a href="https://segmentfault.com/a/1190000004523659" target="_blank" rel="external">HTTPS科普扫盲帖</a></p>
</li>
<li><p><a href="https://imququ.com/post/how-to-decrypt-https.html" target="_blank" rel="external">三种解密 HTTPS 流量的方法介绍</a></p>
</li>
<li><p><a href="http://www.alloyteam.com/2016/07/httphttp2-0spdyhttps-reading-this-is-enough/" target="_blank" rel="external">HTTP2.0,SPDY,HTTPS你应该知道的一些事</a></p>
</li>
<li><p><a href="http://www.alloyteam.com/2017/01/http2-server-push-research/" target="_blank" rel="external">HTTP2 Server Push的研究</a></p>
</li>
<li><p><a href="https://imququ.com/search.html?s=%E5%85%B3%E4%BA%8E%E5%90%AF%E7%94%A8+HTTPS+%E7%9A%84%E7%BB%8F%E9%AA%8C%E5%88%86%E4%BA%AB" target="_blank" rel="external">关于启用 HTTPS 的经验分享</a></p>
</li>
<li><p><a href="http://www.cnblogs.com/Jessy/p/3535612.html" target="_blank" rel="external">TCP的三次握手(建立连接）和四次挥手(关闭连接）</a></p>
</li>
<li><p><a href="https://jerryc8080.gitbooks.io/understand-tcp-and-udp/" target="_blank" rel="external">理解 TCP 和 UDP</a></p>
</li>
<li><p><a href="http://f2er.info/article/31" target="_blank" rel="external">超全面的移动端尺寸基础知识科普</a></p>
</li>
<li><p><a href="http://taobaofed.org/blog/2016/04/25/performance-composite/" target="_blank" rel="external">无线性能优化：Composite</a></p>
</li>
<li><p><a href="https://github.com/CraryPrimitiveMan/awesome-php-zh_CN" target="_blank" rel="external">PHP 资源列表</a></p>
</li>
<li><p><a href="http://ouvens.github.io/frontend-weboptimize/2015/11/17/front-end-image-optmize.html" target="_blank" rel="external">web前端图片极限优化策略</a></p>
</li>
<li><p><a href="https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/image-optimization?hl=zh-cn" target="_blank" rel="external">Google Developer 图片优化</a></p>
</li>
<li><p><a href="http://blog.jobbole.com/100349/" target="_blank" rel="external">如果有人问你数据库的原理，叫他看这篇文章</a></p>
</li>
<li><p><a href="http://tech.meituan.com/mysql-index.html" target="_blank" rel="external">MySQL索引原理及慢查询优化</a></p>
</li>
<li><p><a href="https://www.qcloud.com/community/article/164816001481011945" target="_blank" rel="external">MySQL开发实践8问，你能hold住几个？</a></p>
</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Javascript&quot;&gt;&lt;a href=&quot;#Javascript&quot; class=&quot;headerlink&quot; title=&quot;Javascript&quot;&gt;&lt;/a&gt;Javascript&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&quot;http://web.jobbole.com/82201/&quot;&gt;解析 Facebook 的 Flux 应用架构&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&quot;https://segmentfault.com/a/1190000000732617&quot;&gt;有趣的 HTML5：离线存储&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&quot;http://www.ibm.com/developerworks/cn/web/wa-jsmemory/&quot;&gt;了解 JavaScript 应用程序中的内存泄漏&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Snippet" scheme="http://zqianduan.com/categories/Snippet/"/>
    
    
      <category term="css" scheme="http://zqianduan.com/tags/css/"/>
    
      <category term="javascript" scheme="http://zqianduan.com/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>-webkit-text-size-adjust 使用说明</title>
    <link href="http://zqianduan.com/2016/03/19/text-size-adjust/"/>
    <id>http://zqianduan.com/2016/03/19/text-size-adjust/</id>
    <published>2016-03-19T10:30:31.000Z</published>
    <updated>2017-04-27T07:01:51.000Z</updated>
    
    <content type="html"><![CDATA[<p><code>-webkit-text-size-adjust</code> 是为了保持网页字体大小的一个属性，因为有些网页的字体缩小以后，难以识别，并且也严重影响到用户体验，如果在全局定义了 <code>html { -webkit-text-size-adjust: none; }</code> 会导致另一个现象：浏览器一般提供给小群体用户一个功能，就是放大与缩小网页视图。禁用了这一属性，在 chrome 下放大网页，会导致其它元素均放大，而文字却依然为原定义的 12px。<br><a id="more"></a></p>
<p>这样造成了不友好的体验，给有需要的用户造成阅读上的门槛。故有需要设置小于 12px 字体的元素单个定义即可，但是，这个被定义的小元素，将令浏览器的缩放功能失效。</p>
<h2 id="webkit-text-size-adjust-的使用"><a href="#webkit-text-size-adjust-的使用" class="headerlink" title="-webkit-text-size-adjust 的使用"></a>-webkit-text-size-adjust 的使用</h2><p>Chrome 浏览器在第27版本中正式取消了 -webkit-text-size-adjust 属性，可能就是因为有人设置这样的属性导致网页无法缩放，而用户却认为是浏览器坏了，这可真是鱼和熊掌不可兼得。</p>
<p>虽然这样取消了，但是还是有人在用，Chrome 下由于启用了缩放，所以字符间距出现问题，影响了美观；Firefox 下完美；Opera 能够识别 -webkit- 前缀（而且在检查元素时还抹掉了前缀），但又能够显示 12px 以下的字号，结果变成了 12×0.75。</p>
<p>所以对于 Opera 浏览器需要多定义一个规则：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.webkit</span> &#123;</div><div class="line">    <span class="attribute">font-size</span>: <span class="number">9px</span>;</div><div class="line">    <span class="attribute">-webkit-transform</span>: <span class="built_in">scale</span>(0.75);</div><div class="line">    <span class="attribute">-o-transform</span>: <span class="built_in">scale</span>(1);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="webkit-text-size-adjust-的注意事项"><a href="#webkit-text-size-adjust-的注意事项" class="headerlink" title="-webkit-text-size-adjust 的注意事项"></a>-webkit-text-size-adjust 的注意事项</h2><ol>
<li><p>当样式表里 font-size&lt;12px 时，中文版 chrome 浏览器里字体显示仍为 12px，这时可以用 <code>html { -webkit-text-size-adjust: none; }</code></p>
</li>
<li><p>-webkit-text-size-adjust 放在 body 上会导致页面缩放失效</p>
</li>
<li><p>body 会继承定义在 html 的样式</p>
</li>
<li><p>用 -webkit-text-size-adjust 不要定义成可继承的或全局的</p>
</li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;code&gt;-webkit-text-size-adjust&lt;/code&gt; 是为了保持网页字体大小的一个属性，因为有些网页的字体缩小以后，难以识别，并且也严重影响到用户体验，如果在全局定义了 &lt;code&gt;html { -webkit-text-size-adjust: none; }&lt;/code&gt; 会导致另一个现象：浏览器一般提供给小群体用户一个功能，就是放大与缩小网页视图。禁用了这一属性，在 chrome 下放大网页，会导致其它元素均放大，而文字却依然为原定义的 12px。&lt;br&gt;
    
    </summary>
    
      <category term="Snippet" scheme="http://zqianduan.com/categories/Snippet/"/>
    
    
      <category term="css" scheme="http://zqianduan.com/tags/css/"/>
    
  </entry>
  
  <entry>
    <title>Web 消息推送及 WebSocket 简介</title>
    <link href="http://zqianduan.com/2016/03/17/websocket-introduction/"/>
    <id>http://zqianduan.com/2016/03/17/websocket-introduction/</id>
    <published>2016-03-17T03:07:48.000Z</published>
    <updated>2017-04-27T07:01:51.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Web-的交互过程"><a href="#Web-的交互过程" class="headerlink" title="Web 的交互过程"></a>Web 的交互过程</h2><p>Web 应用典型的信息交互过程通常是：客户端通过浏览器发出一个请求，服务端接收请求后进行处理并返回结果给客户端，然后客户端浏览器将信息呈现出来。</p>
<p>这种机制对于信息交互不是特别频繁的应用尚能相安无事，但是对于那些实时要求比较高的应用来说（比如在线游戏），当客户端浏览器准备呈现获取到的信息的时候，这些信息在服务器端可能已经过时，所以，保持客户端和服务器端的信息同步是实时 Web 应用的关键要素。 在 WebSocket 规范出来之前，开发人员想实现这种应用，不得不采用一些折中的方案，其中最常用的就是轮询（Polling）和 Comet（轮询的改进版本，又可细分为长轮询机制与流技术）技术。这几种方案基本都是在用 Ajax 来模拟实时的效果，服务器与客户端编程都比较复杂，而且效率不高。<br><a id="more"></a></p>
<h2 id="Web-消息推送的技术"><a href="#Web-消息推送的技术" class="headerlink" title="Web 消息推送的技术"></a>Web 消息推送的技术</h2><ol>
<li><p><strong>轮询（polling）</strong>：Ajax 隔一段时间就去服务器查询是否有改变，从而进行增量式的更新。但是间隔多长时间去查询成了问题，因为性能和即时性造成了严重的反比关系。间隔太短，连续不断的请求会冲垮服务器，间隔太长，务器上的新数据就需要越多的时间才能到达客户机。</p>
<ul>
<li>优点：服务端逻辑简单；</li>
<li>缺点：其中大多数请求可能是无效请求，在大量用户轮询很频繁的情况下对服务器的压力很大；</li>
<li>应用：并发用户量少，而且要求消息的实时性不高，一般很少采用；</li>
</ul>
</li>
<li><p><strong>长轮询（long-polling）</strong>：客户端向服务器发送 Ajax 请求，服务器接到请求后 hold 住连接，直到有新消息或超时（设置）才返回响应信息并关闭连接，客户端处理完响应信息后再向服务器发送新的请求。</p>
<ul>
<li>优点：实时性高，无消息的情况下不会进行频繁的请求；</li>
<li>缺点：服务器维持着连接期间会消耗资源；</li>
</ul>
</li>
<li><p><strong>基于 iframe 及 htmlfile 的流（streaming）方式</strong>：iframe 流方式是在页面中插入一个隐藏的 iframe，利用其 src 属性在服务器和客户端之间创建一条长链接，服务器向 iframe 传输数据（通常是 HTML，内有负责插入信息的 javascript），来实时更新页面。</p>
<ul>
<li>优点：消息能够实时到达；</li>
<li>缺点：服务器维持着长连接期会消耗资源；</li>
</ul>
</li>
<li><p><strong>插件提供 socket 方式</strong>：比如利用 Flash XMLSocket，Java Applet 套接口，Activex 包装的 socket。</p>
<ul>
<li>优点：原生 socket 的支持，和 PC 端和移动端的实现方式相似；</li>
<li>缺点：浏览器端需要装相应的插件；</li>
</ul>
</li>
<li><p><strong>WebSocket</strong>：是 HTML5 开始提供的一种浏览器与服务器间进行全双工通讯的网络技术。</p>
<ul>
<li>优点：更好的节省服务器资源和带宽并达到实时通讯；</li>
<li>缺点：目前还未普及，浏览器支持不好；</li>
</ul>
</li>
</ol>
<p>HTML5 WebSocket 设计出来的目的就是要取代轮询和 Comet 技术，使客户端浏览器具备像 C/S 架构下桌面系统的实时通讯能力。浏览器向服务器发出建立 WebSocket 连接的请求，连接建立以后，客户端和服务器端就可以通过 TCP 连接直接交换数据。因为 WebSocket 连接本质上就是一个 TCP 连接，所以在数据传输的稳定性和数据传输量的大小方面，和轮询以及 Comet 技术比较，具有很大的性能优势。</p>
<h2 id="WebSocket-协议"><a href="#WebSocket-协议" class="headerlink" title="WebSocket 协议"></a>WebSocket 协议</h2><p>WebSocket 协议本质上是一个基于 TCP 协议。为了建立一个 WebSocket 连接，客户端浏览器首先要向服务器发起一个 HTTP 请求，这个请求和通常的 HTTP 请求不同，包含了一些附加头信息，其中附加头信息 ”Upgrade: WebSocket” 表明这是一个申请协议升级的 HTTP 请求(详细的 WebSocket 消息的内容这里就不详细说了，基本和 HTTP 的差不多，而且都是由 WebSocket 对象自动发送和接收的，对用户透明)，服务器端解析这些附加的头信息然后产生应答信息返回给客户端，客户端和服务器端的 WebSocket 连接就建立起来了，双方就可以通过这个连接通道自由的传递信息，并且这个连接会持续存在直到客户端或者服务器端的某一方主动的关闭连接。</p>
<p>WebSocket API 最伟大之处在于服务器和客户端可以在给定的时间范围内的任意时刻，相互推送信息。WebSocket 并不限于以 Ajax (或 XmlHttpRequest)方式通信，因为 Ajax 技术需要客户端发起请求，而 WebSocket 服务器和客户端可以彼此相互推送信息；XmlHttpRequest 通信受到域的限制，而 WebSocket 允许跨域通信。</p>
<p>需要注意的问题是，除了安全和性能以外，服务端只管往 socket 里面写数据就可以了，WebSocket 的通信数据全部是以 ”\x00″ 开头以 ”\xFF” 结尾的，无论是服务端发出的数据还是客户端发送的数据都遵从这个格式，唯一不同的是客户端的 WebSocket 对象能够自动将头尾去除，获得主体数据，这就省却了在客户端处理原始数据的必要，而且 WebSocket 通信的消息总是 UTF-8 格式的。</p>
<h3 id="参考资料："><a href="#参考资料：" class="headerlink" title="参考资料："></a>参考资料：</h3><ul>
<li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket" target="_blank" rel="external">WebSocket</a></p>
</li>
<li><p><a href="http://www.ibm.com/developerworks/cn/web/wa-lo-comet/" target="_blank" rel="external">Comet：基于 HTTP 长连接的“服务器推”技术</a></p>
</li>
<li><p><a href="http://www.workerman.net/web-sender" target="_blank" rel="external">WEB消息推送框架</a></p>
</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Web-的交互过程&quot;&gt;&lt;a href=&quot;#Web-的交互过程&quot; class=&quot;headerlink&quot; title=&quot;Web 的交互过程&quot;&gt;&lt;/a&gt;Web 的交互过程&lt;/h2&gt;&lt;p&gt;Web 应用典型的信息交互过程通常是：客户端通过浏览器发出一个请求，服务端接收请求后进行处理并返回结果给客户端，然后客户端浏览器将信息呈现出来。&lt;/p&gt;
&lt;p&gt;这种机制对于信息交互不是特别频繁的应用尚能相安无事，但是对于那些实时要求比较高的应用来说（比如在线游戏），当客户端浏览器准备呈现获取到的信息的时候，这些信息在服务器端可能已经过时，所以，保持客户端和服务器端的信息同步是实时 Web 应用的关键要素。 在 WebSocket 规范出来之前，开发人员想实现这种应用，不得不采用一些折中的方案，其中最常用的就是轮询（Polling）和 Comet（轮询的改进版本，又可细分为长轮询机制与流技术）技术。这几种方案基本都是在用 Ajax 来模拟实时的效果，服务器与客户端编程都比较复杂，而且效率不高。&lt;br&gt;
    
    </summary>
    
      <category term="Javascript" scheme="http://zqianduan.com/categories/Javascript/"/>
    
    
      <category term="server" scheme="http://zqianduan.com/tags/server/"/>
    
      <category term="socket.io" scheme="http://zqianduan.com/tags/socket-io/"/>
    
      <category term="comet" scheme="http://zqianduan.com/tags/comet/"/>
    
  </entry>
  
  <entry>
    <title>前端开发者不得不知的 ES6 十大特性</title>
    <link href="http://zqianduan.com/2016/03/15/es6-front-end-developers-will-have-to-know/"/>
    <id>http://zqianduan.com/2016/03/15/es6-front-end-developers-will-have-to-know/</id>
    <published>2016-03-15T05:30:52.000Z</published>
    <updated>2017-04-27T07:01:51.000Z</updated>
    
    <content type="html"><![CDATA[<p>ES6（ECMAScript2015）的出现，无疑给前端开发人员带来了新的惊喜，它包含了一些很棒的新特性，可以更加方便的实现很多复杂的操作，提高开发人员的效率。</p>
<p>本文主要针对 ES6 做一个简要介绍。 主要译自：<a href="http://webapplog.com/ES6/comment-page-1/" target="_blank" rel="external">http://webapplog.com/ES6/comment-page-1/</a>。也许你还不知道 ES6 是什么, 实际上, 它是一种新的 javascript 规范。在这个大家都很忙碌的时代，如果你想对 ES6 有一个快速的了解，那么请继续往下读，去了解当今最流行的编程语言 JavaScript 最新一代的十大特性。<br><a id="more"></a></p>
<p>以下是 ES6 排名前十的最佳特性列表（排名不分先后）：</p>
<ol>
<li>Default Parameters（默认参数） in ES6</li>
<li>Template Literals （模板文本）in ES6</li>
<li>Multi-line Strings （多行字符串）in ES6</li>
<li>Destructuring Assignment （解构赋值）in ES6</li>
<li>Enhanced Object Literals （增强的对象文本）in ES6</li>
<li>Arrow Functions （箭头函数）in ES6</li>
<li>Promises in ES6</li>
<li>Block-Scoped Constructs Let and Const（块作用域构造Let and Const）</li>
<li>Classes（类） in ES6</li>
<li>Modules（模块） in ES6</li>
</ol>
<p>声明：这些列表仅是个人主观意见。它绝不是为了削弱 ES6 其它功能，这里只列出了10条比较常用的特性。</p>
<p>首先回顾一下 JavaScript 的历史，不清楚历史的人，很难理解 JavaScript 为什么会这样发展。下面就是一个简单的 JavaScript 发展时间轴：</p>
<ol>
<li>1995：JavaScript 诞生，它的初始名叫 LiveScript。</li>
<li>1997：ECMAScript 标准确立。</li>
<li>1999：ES3 出现，与此同时 IE5 风靡一时。</li>
<li>2000–2005： XMLHttpRequest 又名 AJAX， 在 Outlook Web Access (2000)、Oddpost (2002)，Gmail (2004)和Google Maps (2005) 大受重用。</li>
<li>2009： ES5出现，（就是我们大多数人现在使用的）例如 foreach，Object.keys，Object.create 和 JSON 标准。</li>
<li>2015：ES6/ECMAScript2015 出现。</li>
</ol>
<p>历史回顾就先到此，现让我们进入正题。</p>
<h2 id="1-Default-Parameters（默认参数）in-ES6"><a href="#1-Default-Parameters（默认参数）in-ES6" class="headerlink" title="1. Default Parameters（默认参数）in ES6"></a>1. Default Parameters（默认参数）in ES6</h2><p>还记得我们以前不得不通过下面方式来定义默认参数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> link = <span class="function"><span class="keyword">function</span> (<span class="params">height, color, url</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> height = height || <span class="number">50</span>;</div><div class="line">    <span class="keyword">var</span> color = color || <span class="string">'red'</span>;</div><div class="line">    <span class="keyword">var</span> url = url || <span class="string">'http://azat.co'</span>;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>一切工作都是正常的，直到参数值是 0 后，就有问题了，因为在 JavaScript 中，0 表示 false，它是默认被 hard-coded 的值，而不能变成参数本身的值。当然，如果你非要用 0 作为值，我们可以忽略这一缺陷并且使用逻辑 OR 就行了！但在 ES6，我们可以直接把默认值放在函数申明里：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> link = <span class="function"><span class="keyword">function</span>(<span class="params">height = <span class="number">50</span>, color = <span class="string">'red'</span>, url = <span class="string">'http://azat.co'</span></span>) </span>&#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>顺便说一句，这个语法类似于 Ruby！</p>
<h2 id="2-Template-Literals（模板对象）in-ES6"><a href="#2-Template-Literals（模板对象）in-ES6" class="headerlink" title="2. Template Literals（模板对象）in ES6"></a>2. Template Literals（模板对象）in ES6</h2><p>在其它语言中，使用模板和插入值是在字符串里面输出变量的一种方式。因此，在 ES5，我们可以这样组合一个字符串：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> name = <span class="string">'Your name is '</span> + first + <span class="string">' '</span> + last + <span class="string">'.'</span>;</div><div class="line"><span class="keyword">var</span> url = <span class="string">'http://localhost:3000/api/messages/'</span> + id;</div></pre></td></tr></table></figure>
<p>幸运的是，在 ES6 中，我们可以使用新的语法 <code>${NAME}</code>，并把它放在反引号里：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> name = <span class="string">`Your name is <span class="subst">$&#123;first&#125;</span> <span class="subst">$&#123;last&#125;</span>. `</span>;</div><div class="line"><span class="keyword">var</span> url = <span class="string">`http://localhost:3000/api/messages/<span class="subst">$&#123;id&#125;</span>`</span>;</div></pre></td></tr></table></figure>
<h2 id="3-Multi-line-Strings（多行字符串）in-ES6"><a href="#3-Multi-line-Strings（多行字符串）in-ES6" class="headerlink" title="3. Multi-line Strings（多行字符串）in ES6"></a>3. Multi-line Strings（多行字符串）in ES6</h2><p>ES6 的多行字符串是一个非常实用的功能。在 ES5 中，我们不得不使用以下方法来表示多行字符串：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">var roadPoem = 'Then took the other, as just as fair,nt'</div><div class="line">    + 'And having perhaps the better claimnt'</div><div class="line">    + 'Because it was grassy and wanted wear,nt'</div><div class="line">    + 'Though as for that the passing therent'</div><div class="line">    + 'Had worn them really about the same,nt';</div><div class="line">var fourAgreements = 'You have the right to be you.n</div><div class="line">    You can only be you when you do your best.';</div></pre></td></tr></table></figure>
<p>然而在 ES6 中，仅仅用反引号就可以解决了：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> roadPoem = <span class="string">`Then took the other, as just as fair,</span></div><div class="line">    And having perhaps the better claim</div><div class="line">    Because it was grassy and wanted wear,</div><div class="line">    Though as for that the passing there</div><div class="line">    Had worn them really about the same,`;</div><div class="line"><span class="keyword">var</span> fourAgreements = <span class="string">`You have the right to be you.</span></div><div class="line">    You can only be you when you do your best.`;</div></pre></td></tr></table></figure>
<h2 id="4-Destructuring-Assignment（解构赋值）in-ES6"><a href="#4-Destructuring-Assignment（解构赋值）in-ES6" class="headerlink" title="4. Destructuring Assignment（解构赋值）in ES6"></a>4. Destructuring Assignment（解构赋值）in ES6</h2><p>解构可能是一个比较难以掌握的概念。先从一个简单的赋值讲起，其中 house 和 mouse 是 key，同时 house 和 mouse 也是一个变量，在 ES5 中是这样：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> data = $(<span class="string">'body'</span>).data(), <span class="comment">// data has properties house and mouse</span></div><div class="line">    house = data.house,</div><div class="line">    mouse = data.mouse;</div></pre></td></tr></table></figure>
<p>以及在 node.js 中用 ES5 是这样：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> jsonMiddleware = <span class="built_in">require</span>(<span class="string">'body-parser'</span>).jsonMiddleware;</div><div class="line"><span class="keyword">var</span> body = req.body, <span class="comment">// body has username and password</span></div><div class="line">    username = body.username,</div><div class="line">    password = body.password;</div></pre></td></tr></table></figure>
<p>在 ES6，我们可以使用这些语句代替上面的 ES5 代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> &#123; house, mouse &#125; = $(<span class="string">'body'</span>).data(); <span class="comment">// we'll get house and mouse variables</span></div><div class="line"><span class="keyword">var</span> &#123; jsonMiddleware &#125; = <span class="built_in">require</span>(<span class="string">'body-parser'</span>);</div><div class="line"><span class="keyword">var</span> &#123; username, password &#125; = req.body;</div></pre></td></tr></table></figure>
<p>这个同样也适用于数组，非常赞的用法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> [col1, col2] = $(<span class="string">'.column'</span>),</div><div class="line">    [line1, line2, line3, , line5] = file.split(<span class="string">'n'</span>);</div></pre></td></tr></table></figure>
<p>我们可能需要一些时间来习惯解构赋值语法的使用，但是它确实能给我们带来许多意外的收获。</p>
<h2 id="5-Enhanced-Object-Literals（增强的对象字面量）in-ES6"><a href="#5-Enhanced-Object-Literals（增强的对象字面量）in-ES6" class="headerlink" title="5. Enhanced Object Literals（增强的对象字面量）in ES6"></a>5. Enhanced Object Literals（增强的对象字面量）in ES6</h2><p>使用对象文本可以做许多让人意想不到的事情！通过 ES6，我们可以把 ES5 中的 JSON 变得更加接近于一个类。</p>
<p>下面是一个典型 ES5 对象文本，里面有一些方法和属性：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> serviceBase = &#123; <span class="attr">port</span>: <span class="number">3000</span>, <span class="attr">url</span>: <span class="string">'azat.co'</span> &#125;,</div><div class="line">    getAccounts = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>] &#125;;</div><div class="line"><span class="keyword">var</span> accountServiceES5 = &#123;</div><div class="line">        <span class="attr">port</span>: serviceBase.port,</div><div class="line">        <span class="attr">url</span>: serviceBase.url,</div><div class="line">        <span class="attr">getAccounts</span>: getAccounts,</div><div class="line">        <span class="attr">toString</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="built_in">JSON</span>.stringify(<span class="keyword">this</span>.valueOf());</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">getUrl</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="string">"http://"</span> + <span class="keyword">this</span>.url + <span class="string">':'</span> + <span class="keyword">this</span>.port &#125;,</div><div class="line">        <span class="attr">valueOf_1_2_3</span>: getAccounts()</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>如果我们想让它更有意思，我们可以用 Object.create 从 serviceBase 继承原型的方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> accountServiceES5ObjectCreate = <span class="built_in">Object</span>.create(serviceBase)</div><div class="line"><span class="keyword">var</span> accountServiceES5ObjectCreate = &#123;</div><div class="line">        <span class="attr">getAccounts</span>: getAccounts,</div><div class="line">        <span class="attr">toString</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="built_in">JSON</span>.stringify(<span class="keyword">this</span>.valueOf());</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">getUrl</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="string">"http://"</span> + <span class="keyword">this</span>.url + <span class="string">':'</span> + <span class="keyword">this</span>.port &#125;,</div><div class="line">        <span class="attr">valueOf_1_2_3</span>: getAccounts()</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>我们知道，accountServiceES5ObjectCreate 和 accountServiceES5 并不是完全一致的，因为一个对象 (accountServiceES5) 在 <strong>proto</strong> 对象中将有下面这些属性：</p>
<p><img src="http://cdn.alloyteam.com/wp-content/uploads/2016/03/%E5%9B%BE%E7%89%871.png" alt="accountServiceES5"></p>
<p>为了方便举例，我们将考虑它们的相似处。所以在 ES6 的对象文本中，既可以直接分配 getAccounts: getAccounts,也可以只需用一个 getAccounts，此外，我们在这里通过 <strong>proto</strong>（并不是通过’proto’）设置属性，如下所示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> serviceBase = &#123; <span class="attr">port</span>: <span class="number">3000</span>, <span class="attr">url</span>: <span class="string">'azat.co'</span> &#125;,</div><div class="line">    getAccounts = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">return</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] &#125;;</div><div class="line"><span class="keyword">var</span> accountService = &#123;</div><div class="line">        <span class="attr">__proto__</span>: serviceBase,</div><div class="line">        getAccounts,</div></pre></td></tr></table></figure>
<p>另外，我们可以调用 super 防范，以及使用动态 key 值 (valueOf_1_2_3):</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">            toString() &#123;</div><div class="line">            <span class="keyword">return</span> <span class="built_in">JSON</span>.stringify((<span class="keyword">super</span>.valueOf()));</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">getUrl</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="string">"http://"</span> + <span class="keyword">this</span>.url + <span class="string">':'</span> + <span class="keyword">this</span>.port &#125;,</div><div class="line">        [ <span class="string">'valueOf_'</span> + getAccounts().join(<span class="string">'_'</span>) ]: getAccounts()</div><div class="line">&#125;;</div><div class="line"><span class="built_in">console</span>.log(accountService)</div></pre></td></tr></table></figure>
<p><img src="http://cdn.alloyteam.com/wp-content/uploads/2016/03/%E5%9B%BE%E7%89%873.png" alt=""></p>
<p>ES6 对象文本是一个很大的进步对于旧版的对象文本来说。</p>
<h2 id="6-Arrow-Functions-in（箭头函数）ES6"><a href="#6-Arrow-Functions-in（箭头函数）ES6" class="headerlink" title="6. Arrow Functions in（箭头函数）ES6"></a>6. Arrow Functions in（箭头函数）ES6</h2><p>这是我迫不及待想讲的一个特征，CoffeeScript 就是因为它丰富的箭头函数让很多开发者喜爱。在 ES6 中，也有了丰富的箭头函数。这些丰富的箭头是令人惊讶的因为它们将使许多操作变成现实，比如：</p>
<p>以前我们使用闭包，this 总是预期之外地产生改变，而箭头函数的迷人之处在于，现在你的 this 可以按照你的预期使用了，身处箭头函数里面，this 还是原来的 this。</p>
<p>有了箭头函数在 ES6 中， 我们就不必用 that = this 或 self =  this 或 _this = this 或 .bind(this)。例如，下面的代码用 ES5 就不是很优雅：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> _this = <span class="keyword">this</span>;</div><div class="line">$(<span class="string">'.btn'</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</div><div class="line">    _this.sendData();</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>在 ES6 中就不需要用 _this = this：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$(<span class="string">'.btn'</span>).click(<span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">this</span>.sendData();</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>不幸的是，ES6 委员会决定，以前的 function 的传递方式也是一个很好的方案，所以它们仍然保留了以前的功能。<br>下面这是一个另外的例子，我们通过 call 传递文本给 logUpperCase() 函数在 ES5 中：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> logUpperCase = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> _this = <span class="keyword">this</span>;</div><div class="line"> </div><div class="line">        <span class="keyword">this</span>.string = <span class="keyword">this</span>.string.toUpperCase();</div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="built_in">console</span>.log(_this.string);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">logUpperCase.call(&#123; <span class="attr">string</span>: <span class="string">'ES6 rocks'</span> &#125;)();</div></pre></td></tr></table></figure>
<p>而在 ES6，我们并不需要用 _this 浪费时间：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> logUpperCase = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.string = <span class="keyword">this</span>.string.toUpperCase();</div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="keyword">this</span>.string);</div><div class="line">    &#125;</div><div class="line">    logUpperCase.call(&#123; <span class="attr">string</span>: <span class="string">'ES6 rocks'</span> &#125;)();</div></pre></td></tr></table></figure>
<p>请注意，只要你愿意，在 ES6 中 =&gt; 可以混合和匹配老的函数一起使用。当在一行代码中用了箭头函数，它就变成了一个表达式。它将暗地里返回单个语句的结果。如果你超过了一行，将需要明确使用 return。</p>
<p>这是用 ES5 代码创建一个消息数组：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> ids = [<span class="string">'5632953c4e345e145fdf2df8'</span>, <span class="string">'563295464e345e145fdf2df9'</span>];</div><div class="line"><span class="keyword">var</span> messages = ids.map(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"ID is "</span> + value; <span class="comment">// explicit return</span></div><div class="line">    &#125;);</div></pre></td></tr></table></figure>
<p>用 ES6 是这样：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> ids = [<span class="string">'5632953c4e345e145fdf2df8'</span>, <span class="string">'563295464e345e145fdf2df9'</span>];</div><div class="line"><span class="keyword">var</span> messages = ids.map(<span class="function"><span class="params">value</span> =&gt;</span> <span class="string">`ID is <span class="subst">$&#123;value&#125;</span>`</span>); <span class="comment">// implicit return</span></div></pre></td></tr></table></figure>
<p>请注意，这里用了字符串模板。</p>
<p>在箭头函数中，对于单个参数，括号()是可选的，但当你超过一个参数的时候你就需要他们。</p>
<p>在ES5代码有明确的返回功能：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> ids = [<span class="string">'5632953c4e345e145fdf2df8'</span>, <span class="string">'563295464e345e145fdf2df9'</span>];</div><div class="line"><span class="keyword">var</span> messages = ids.map(<span class="function"><span class="keyword">function</span>(<span class="params">value, index, list</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">'ID of '</span> + index + <span class="string">' element is '</span> + value + <span class="string">' '</span>; <span class="comment">// explicit return</span></div><div class="line">    &#125;);</div></pre></td></tr></table></figure>
<p>在 ES6 中有更加严谨的版本，参数需要被包含在括号里并且它是隐式的返回：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> ids = [<span class="string">'5632953c4e345e145fdf2df8'</span>, <span class="string">'563295464e345e145fdf2df9'</span>];</div><div class="line"><span class="keyword">var</span> messages = ids.map(<span class="function">(<span class="params">value, index, list</span>) =&gt;</span> <span class="string">`ID of <span class="subst">$&#123;index&#125;</span> element is <span class="subst">$&#123;value&#125;</span> `</span>); <span class="comment">// implicit return</span></div></pre></td></tr></table></figure>
<h2 id="7-Promises-in-ES6"><a href="#7-Promises-in-ES6" class="headerlink" title="7. Promises in ES6"></a>7. Promises in ES6</h2><p>Promises 是一个有争议的话题。因此有许多略微不同的 promise 实现语法。Q，bluebird，deferred.js，vow, avow, jquery 一些可以列出名字的。也有人说我们不需要 promises，仅仅使用异步，生成器，回调等就够了。但令人高兴的是，在 ES6 中有标准的 Promise 实现。</p>
<p>下面是一个简单的用 setTimeout() 实现的异步延迟加载函数:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'Yay!'</span>);</div><div class="line">&#125;, <span class="number">1000</span>);</div></pre></td></tr></table></figure>
<p>在 ES6 中，我们可以用 promise 重写:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> wait1000 =  <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</div><div class="line">        setTimeout(resolve, <span class="number">1000</span>);</div><div class="line">    &#125;)</div><div class="line">    .then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'Yay!'</span>);</div><div class="line">    &#125;);</div></pre></td></tr></table></figure>
<p>或者用 ES6 的箭头函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> wait1000 =  <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</div><div class="line">        setTimeout(resolve, <span class="number">1000</span>);</div><div class="line">    &#125;)</div><div class="line">    .then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'Yay!'</span>);</div><div class="line">    &#125;);</div></pre></td></tr></table></figure>
<p>到目前为止，代码的行数从三行增加到五行，并没有任何明显的好处。确实，如果我们有更多的嵌套逻辑在 setTimeout() 回调函数中，我们将发现更多好处：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'Yay!'</span>);</div><div class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'Wheeyee!'</span>);</div><div class="line">  &#125;, <span class="number">1000</span>)</div><div class="line">&#125;, <span class="number">1000</span>);</div></pre></td></tr></table></figure>
<p>在 ES6 中我们可以用 promises 重写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> wait1000 = <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123; setTimeout(resolve, <span class="number">1000</span>) &#125;);</div><div class="line"></div><div class="line">wait1000()</div><div class="line">    .then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'Yay!'</span>)</div><div class="line">        <span class="keyword">return</span> wait1000()</div><div class="line">    &#125;)</div><div class="line">    .then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'Wheeyee!'</span>)</div><div class="line">    &#125;);</div></pre></td></tr></table></figure>
<p>还是不确信 Promises 比普通回调更好？其实我也不确信，我认为一旦你有回调的想法，那么就没有必要额外增加 promises 的复杂性。</p>
<p>虽然，ES6 有让人崇拜的 Promises，Promises 是一个有利有弊的回调但是确实是一个好的特性，更多详细的信息关于 promise: <a href="http://jamesknelson.com/grokking-es6-promises-the-four-functions-you-need-to-avoid-callback-hell" target="_blank" rel="external">Introduction to ES6 Promises</a>.</p>
<h2 id="8-Block-Scoped-Constructs-Let-and-Const（块作用域和构造-let-和-const）"><a href="#8-Block-Scoped-Constructs-Let-and-Const（块作用域和构造-let-和-const）" class="headerlink" title="8. Block-Scoped Constructs Let and Const（块作用域和构造 let 和 const）"></a>8. Block-Scoped Constructs Let and Const（块作用域和构造 let 和 const）</h2><p>在 ES6 代码中，你可能已经看到那熟悉的身影 let。在 ES6 里 let 并不是一个花俏的特性，它是更复杂的。Let 是一种新的变量申明方式，它允许你把变量作用域控制在块级里面。我们用大括号定义代码块，在 ES5 中，块级作用域起不了任何作用：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">calculateTotalAmount</span>(<span class="params">vip</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> amount = <span class="number">0</span>;</div><div class="line">    <span class="keyword">if</span>(vip) &#123;</div><div class="line">        <span class="keyword">var</span> amount = <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    &#123; <span class="comment">// more crazy blocks!</span></div><div class="line">        <span class="keyword">var</span> amount = <span class="number">100</span>;</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">var</span> amount = <span class="number">1000</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;  </div><div class="line">    <span class="keyword">return</span> amount;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(calculateTotalAmount(<span class="literal">true</span>));</div></pre></td></tr></table></figure>
<p>结果将返回 1000，这真是一个 bug。在 ES6 中，我们用 let 限制块级作用域。而 var 是限制函数作用域。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">calculateTotalAmount</span> (<span class="params">vip</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> amount = <span class="number">0</span>; <span class="comment">// probably should also be let, but you can mix var and let</span></div><div class="line">    <span class="keyword">if</span>(vip) &#123;</div><div class="line">        <span class="keyword">let</span> amount = <span class="number">1</span>; <span class="comment">// first amount is still 0</span></div><div class="line">    &#125; </div><div class="line">    &#123; <span class="comment">// more crazy blocks!</span></div><div class="line">        <span class="keyword">let</span> amount = <span class="number">100</span>; <span class="comment">// first amount is still 0</span></div><div class="line">        &#123;</div><div class="line">            <span class="keyword">let</span> amount = <span class="number">1000</span>; <span class="comment">// first amount is still 0</span></div><div class="line">        &#125;</div><div class="line">    &#125;  </div><div class="line">    <span class="keyword">return</span> amount;</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="built_in">console</span>.log(calculateTotalAmount(<span class="literal">true</span>));</div></pre></td></tr></table></figure>
<p>这个结果将会是0，因为块作用域中有了let。如果（amount=1）.那么这个表达式将返回1。谈到 const，就更加容易了；它就是一个不变量，也是块级作用域就像 let 一样。下面是一个演示，这里有一堆常量，它们互不影响，因为它们属于不同的块级作用域:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">calculateTotalAmount</span> (<span class="params">vip</span>) </span>&#123;</div><div class="line">    <span class="keyword">const</span> amount = <span class="number">0</span>;  </div><div class="line">    <span class="keyword">if</span>(vip) &#123;</div><div class="line">        <span class="keyword">const</span> amount = <span class="number">1</span>;</div><div class="line">    &#125; </div><div class="line">    &#123; <span class="comment">// more crazy blocks!</span></div><div class="line">        <span class="keyword">const</span> amount = <span class="number">100</span> ;</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">const</span> amount = <span class="number">1000</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;  </div><div class="line">    <span class="keyword">return</span> amount;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(calculateTotalAmount(<span class="literal">true</span>));</div></pre></td></tr></table></figure>
<p>从我个人看来，let 和 const 使这个语言变复杂了。没有它们的话，我们只需考虑一种方式，现在有许多种场景需要考虑。</p>
<h2 id="9-Classes（类）in-ES6"><a href="#9-Classes（类）in-ES6" class="headerlink" title="9. Classes（类）in ES6"></a>9. Classes（类）in ES6</h2><p>如果你喜欢面向对象编程（OOP），那么你将喜爱这个特性。以后写一个类和继承将变得跟在 facebook 上写一个评论那么容易。</p>
<p>类的创建和使用真是一件令人头疼的事情在过去的 ES5 中，因为没有一个关键字 class （它被保留，但是什么也不能做）。在此之上，大量的继承模型像 pseudo classical, classical, functional 更加增加了混乱，JavaScript 之间的宗教战争只会更加火上浇油。</p>
<p>用 ES5 写一个类，有很多种方法，这里就先不说了。现在就来看看如何用 ES6 写一个类吧。ES6 没有用函数, 而是使用原型实现类。我们创建一个类 baseModel ，并且在这个类里定义了一个 constructor 和一个 getName() 方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">baseModel</span> </span>&#123;</div><div class="line">    <span class="keyword">constructor</span>(options, data) &#123; </div><div class="line">        <span class="comment">// class constructor，node.js5.6 暂时不支持 options = &#123;&#125;, data = [] 这样传参</span></div><div class="line">        <span class="keyword">this</span>.name = <span class="string">'Base'</span>;</div><div class="line">        <span class="keyword">this</span>.url = <span class="string">'http://azat.co/api'</span>;</div><div class="line">        <span class="keyword">this</span>.data = data;</div><div class="line">        <span class="keyword">this</span>.options = options;</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    getName() &#123; <span class="comment">// class method</span></div><div class="line">        <span class="built_in">console</span>.log(<span class="string">`Class name: <span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span>`</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>注意我们对 options 和 data 使用了默认参数值。此外方法名也不需要加 function 关键字，而且冒号(:)也不需要了。另外一个大的区别就是你不需要分配属性 this。现在设置一个属性的值，只需简单的在构造函数中分配。</p>
<p>AccountModel 从类 baseModel 中继承而来:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AccountModel</span> <span class="keyword">extends</span> <span class="title">baseModel</span> </span>&#123;</div><div class="line">    <span class="keyword">constructor</span>(options, data) &#123;</div></pre></td></tr></table></figure>
<p>为了调用父级构造函数，可以毫不费力的唤起 super() 用参数传递：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">    <span class="comment">// call the parent method with super</span></div><div class="line">    <span class="keyword">super</span>(&#123;<span class="attr">private</span>: <span class="literal">true</span>&#125;, [<span class="string">'32113123123'</span>, <span class="string">'524214691'</span>]); </div><div class="line">    <span class="keyword">this</span>.name = <span class="string">'Account Model'</span>;</div><div class="line">    <span class="keyword">this</span>.url +=<span class="string">'/accounts/'</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果你想做些更好玩的，你可以把 accountData 设置成一个属性：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">    get accountsData() &#123; <span class="comment">//calculated attribute getter</span></div><div class="line">        <span class="comment">// ... make XHR</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.data;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>那么，你如何调用他们呢？它是非常容易的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> accounts = <span class="keyword">new</span> AccountModel(<span class="number">5</span>);</div><div class="line">accounts.getName();</div><div class="line"><span class="built_in">console</span>.log(<span class="string">'Data is %s'</span>, accounts.accountsData);</div></pre></td></tr></table></figure>
<p>结果令人惊讶，输出是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Class name: Account Model</div><div class="line">Data is  32113123123,524214691</div></pre></td></tr></table></figure>
<h2 id="10-Modules（模块）in-ES6"><a href="#10-Modules（模块）in-ES6" class="headerlink" title="10. Modules（模块）in ES6"></a>10. Modules（模块）in ES6</h2><p>众所周知，在 ES6 以前 JavaScript 并不支持本地的模块。人们想出了 AMD，RequireJS，CommonJS 以及其它解决方法。现在 ES6 中可以用模块 import 和 export 操作了。 </p>
<p>在 ES5 中，你可以在 <code>&lt;script&gt;</code> 中直接写可以运行的代码（简称 IIFE），或者一些库像 AMD。然而在 ES6 中，你可以用export 导入你的类。下面举个例子，在 ES5 中，module.js 有 port 变量和 getAccounts 方法:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">    <span class="attr">port</span>: <span class="number">3000</span>,</div><div class="line">    <span class="attr">getAccounts</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="comment">// ...</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在 ES5 中，main.js 需要依赖 require(‘module’) 导入 module.js：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> service = <span class="built_in">require</span>(<span class="string">'module.js'</span>);</div><div class="line"><span class="built_in">console</span>.log(service.port); <span class="comment">// 3000</span></div></pre></td></tr></table></figure>
<p>但在 ES6 中，我们将用 export and import。例如，这是我们用 ES6 写的 module.js 文件库：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="keyword">var</span> port = <span class="number">3000</span>;</div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getAccounts</span>(<span class="params">url</span>) </span>&#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果用 ES6 来导入到文件 main.js 中，我们需用 import {name} from ‘my-module’ 语法，例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;port, getAccounts&#125; <span class="keyword">from</span> <span class="string">'module'</span>;</div><div class="line"><span class="built_in">console</span>.log(port); <span class="comment">// 3000</span></div></pre></td></tr></table></figure>
<p>或者我们可以在 main.js 中把整个模块导入, 并命名为 service：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> * <span class="keyword">as</span> service <span class="keyword">from</span> <span class="string">'module'</span>;</div><div class="line"><span class="built_in">console</span>.log(service.port); <span class="comment">// 3000</span></div></pre></td></tr></table></figure>
<p>从我个人角度来说，我觉得 ES6 模块是让人困惑的。但可以肯定的事，它们使语言更加灵活了。</p>
<p>并不是所有的浏览器都支持 ES6 模块，所以你需要使用一些像 jspm 去支持 ES6 模块。</p>
<p>更多的信息和例子关于 ES6 模块，请看 <a href="http://exploringjs.com/es6/ch_modules.html" target="_blank" rel="external">this text</a>。不管怎样，请写模块化的 JavaScript。</p>
<h2 id="如何使用-ES6-Babel"><a href="#如何使用-ES6-Babel" class="headerlink" title="如何使用 ES6(Babel)"></a>如何使用 ES6(Babel)</h2><p>ES6 已经敲定，但并不是所有的浏览器都完全支持，详见：<a href="http://kangax.github.io/compat-table/es6/" target="_blank" rel="external">http://kangax.github.io/compat-table/es6/</a>。要使用 ES6，需要一个编译器例如：babel。你可以把它作为一个独立的工具使用，也可以把它放在构建中。grunt，gulp 和 webpack 中都有可以支持 babel 的插件。</p>
<p><img src="http://cdn.alloyteam.com/wp-content/uploads/2016/03/%E5%9B%BE%E7%89%872.png" alt=""></p>
<p>这是一个gulp案列，安装gulp-babel插件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install --save-dev gulp-babel</div></pre></td></tr></table></figure>
<p>在 gulpfile.js 中，定义一个任务 build，放入 src/app.js，并且编译它进入构建文件中。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>),</div><div class="line">    babel = <span class="built_in">require</span>(<span class="string">'gulp-babel'</span>);</div><div class="line"></div><div class="line">gulp.task(<span class="string">'build'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> gulp.src(<span class="string">'src/app.js'</span>)</div><div class="line">        .pipe(babel())</div><div class="line">        .pipe(gulp.dest(<span class="string">'build'</span>));</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h2 id="Node-js-and-ES6"><a href="#Node-js-and-ES6" class="headerlink" title="Node.js and ES6"></a>Node.js and ES6</h2><p>在 nodejs 中，你可以用构建工具或者独立的 Babel 模块 babel-core 来编译你的 Node.js 文件。安装如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install --save-dev babel-core</div></pre></td></tr></table></figure>
<p>然后在 node.js 中，你可以调用这个函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">require</span>(<span class="string">"babel-core"</span>).transform(ES5Code, options);</div></pre></td></tr></table></figure>
<h2 id="ES6-总结"><a href="#ES6-总结" class="headerlink" title="ES6 总结"></a>ES6 总结</h2><p>这里还有许多 ES6 的其它特性你可能会使用到，排名不分先后：</p>
<ol>
<li>全新的Math, Number, String, Array 和 Object 方法</li>
<li>二进制和八进制数据类型</li>
<li>默认参数不定参数扩展运算符</li>
<li>Symbols符号</li>
<li>tail调用</li>
<li>Generators (生成器)</li>
<li>New data structures like Map and Set(新的数据构造对像 MAP 和 set)</li>
</ol>
<h3 id="参考文献："><a href="#参考文献：" class="headerlink" title="参考文献："></a>参考文献：</h3><ul>
<li><p><a href="https://github.com/azat-co/cheatsheets/tree/master/es6" target="_blank" rel="external">ES6 Cheatsheet</a> (<a href="https://gum.co/LDwVU/git-1CC81D40" target="_blank" rel="external">FREE PDF</a>)</p>
</li>
<li><p><a href="http://webapplog.com/es6/comment-page-1/" target="_blank" rel="external">http://webapplog.com/ES6/comment-page-1/</a></p>
</li>
<li><p><a href="https://leanpub.com/understandinges6" target="_blank" rel="external">Understanding ECMAScript 6 by Nicolas Zakas book</a></p>
</li>
<li><p><a href="http://www.alloyteam.com/2016/03/es6-front-end-developers-will-have-to-know-the-top-ten-properties/#DateTimeFormatting" target="_blank" rel="external">http://ES6-features.org/#DateTimeFormatting</a></p>
</li>
<li><p>IIFE：立刻运行的函数表达式</p>
</li>
</ul>
<blockquote>
<p>本文转载自 AlloyTeam：<a href="http://www.alloyteam.com/2016/03/es6-front-end-developers-will-have-to-know-the-top-ten-properties/" target="_blank" rel="external">http://www.alloyteam.com/2016/03/es6-front-end-developers-will-have-to-know-the-top-ten-properties/</a></p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ES6（ECMAScript2015）的出现，无疑给前端开发人员带来了新的惊喜，它包含了一些很棒的新特性，可以更加方便的实现很多复杂的操作，提高开发人员的效率。&lt;/p&gt;
&lt;p&gt;本文主要针对 ES6 做一个简要介绍。 主要译自：&lt;a href=&quot;http://webapplog.com/ES6/comment-page-1/&quot;&gt;http://webapplog.com/ES6/comment-page-1/&lt;/a&gt;。也许你还不知道 ES6 是什么, 实际上, 它是一种新的 javascript 规范。在这个大家都很忙碌的时代，如果你想对 ES6 有一个快速的了解，那么请继续往下读，去了解当今最流行的编程语言 JavaScript 最新一代的十大特性。&lt;br&gt;
    
    </summary>
    
      <category term="Javascript" scheme="http://zqianduan.com/categories/Javascript/"/>
    
    
      <category term="es6" scheme="http://zqianduan.com/tags/es6/"/>
    
      <category term="promise" scheme="http://zqianduan.com/tags/promise/"/>
    
  </entry>
  
  <entry>
    <title>前端性能优化总结</title>
    <link href="http://zqianduan.com/2016/03/14/front-end-optimization/"/>
    <id>http://zqianduan.com/2016/03/14/front-end-optimization/</id>
    <published>2016-03-14T07:56:35.000Z</published>
    <updated>2017-04-27T07:01:51.000Z</updated>
    
    <content type="html"><![CDATA[<table>
<thead>
<tr>
<th>优化方向</th>
<th style="text-align:center">优化手段</th>
</tr>
</thead>
<tbody>
<tr>
<td>请求数量</td>
<td style="text-align:center">合并脚本和样式表，CSS Sprites，拆分初始化负载，划分主域</td>
</tr>
<tr>
<td>请求带宽</td>
<td style="text-align:center">开启GZip，精简JavaScript，移除重复脚本，图像优化</td>
</tr>
<tr>
<td>缓存利用</td>
<td style="text-align:center">使用CDN，使用外部JavaScript和CSS，添加Expires头，减少DNS查找，配置ETag，使AjaX可缓存</td>
</tr>
<tr>
<td>页面结构</td>
<td style="text-align:center">将样式表放在顶部，将脚本放在底部，尽早刷新文档的输出</td>
</tr>
<tr>
<td>代码校验</td>
<td style="text-align:center">避免CSS表达式，避免重定向</td>
</tr>
</tbody>
</table>
<a id="more"></a>
<p>参考资料：</p>
<ul>
<li><p><a href="https://developer.yahoo.com/performance/rules.html" target="_blank" rel="external">雅虎14条性能优化原则</a></p>
</li>
<li><p><a href="http://www.infoq.com/cn/articles/front-end-engineering-and-performance-optimization-part1" target="_blank" rel="external">前端工程精粹（一）：静态资源版本更新与缓存</a></p>
</li>
<li><p><a href="http://www.infoq.com/cn/articles/front-end-engineering-and-performance-optimization-part2" target="_blank" rel="external">前端工程精粹（二）：静态资源管理与模板框架</a></p>
</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;优化方向&lt;/th&gt;
&lt;th style=&quot;text-align:center&quot;&gt;优化手段&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;请求数量&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;合并脚本和样式表，CSS Sprites，拆分初始化负载，划分主域&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;请求带宽&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;开启GZip，精简JavaScript，移除重复脚本，图像优化&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;缓存利用&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;使用CDN，使用外部JavaScript和CSS，添加Expires头，减少DNS查找，配置ETag，使AjaX可缓存&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;页面结构&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;将样式表放在顶部，将脚本放在底部，尽早刷新文档的输出&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;代码校验&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;避免CSS表达式，避免重定向&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
    
    </summary>
    
      <category term="Snippet" scheme="http://zqianduan.com/categories/Snippet/"/>
    
    
      <category term="gzip" scheme="http://zqianduan.com/tags/gzip/"/>
    
      <category term="uglify" scheme="http://zqianduan.com/tags/uglify/"/>
    
  </entry>
  
  <entry>
    <title>SASS优化响应式断点管理</title>
    <link href="http://zqianduan.com/2016/03/13/sass-responsive-breakpoints/"/>
    <id>http://zqianduan.com/2016/03/13/sass-responsive-breakpoints/</id>
    <published>2016-03-13T04:33:27.000Z</published>
    <updated>2017-04-27T07:01:51.000Z</updated>
    
    <content type="html"><![CDATA[<p>当你需要搞定响应式布局时，一堆堆的媒体查询、大量的属性、属性值往往可以把你搞颠，SASS（或者诸如此类的预处理器）被认为是处理响应式断点的最佳利器。</p>
<p>说到响应式断点处理，很多种方式涌上心头，经常有人问哪种方式最优，正如前端开发领域的大多数问题一样，这个问题同样没有标准答案，我们需要具体问题具体分析。更确切的说，难度不在于提出一个系统，而是提出一个既足够灵活（适用大部分场合）又不非常复杂的系统。</p>
<p>在今天的文章里，我将给大家介绍若干种响应式布局断点的解决方案，每一种都经过实践验证，一些方案可能优于其他方案，我会把决定的权利交给大家。<br><a id="more"></a></p>
<h2 id="1-使用变量-With-variables"><a href="#1-使用变量-With-variables" class="headerlink" title="1. 使用变量(With variables)"></a>1. 使用变量(With variables)</h2><p><a href="https://github.com/twbs/bootstrap/blob/master/less/variables.less#L259" target="_blank" rel="external">Bootstrap</a> 和 <a href="http://foundation.zurb.com/docs/media-queries.html" target="_blank" rel="external">Foundation</a> 采用这种方式，首先定义变量，然后在媒体查询中使用变量。换句话说，你可以在配置文件或者其他地方定义变量以备使用。我们来看看 Bootstrap 怎么干的。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">// Defining values</div><div class="line">$screen-sm-min: 768px;</div><div class="line">$screen-xs-max: ($screen-sm-min - 1);</div><div class="line">$screen-md-min: 992px;</div><div class="line">$screen-sm-max: ($screen-md-min - 1);</div><div class="line">$screen-lg-min: 1200px;</div><div class="line">$screen-md-max: ($screen-lg-min - 1);</div><div class="line"></div><div class="line">// Usage</div><div class="line">@media (max-width: $screen-xs-max) &#123; ... &#125;</div><div class="line">@media (min-width: $screen-sm-min) &#123; ... &#125;</div><div class="line">@media (max-width: $screen-sm-max) &#123; ... &#125;</div><div class="line">@media (min-width: $screen-md-min) &#123; ... &#125;</div><div class="line">@media (max-width: $screen-md-max) &#123; ... &#125;</div><div class="line">@media (min-width: $screen-lg-min) &#123; ... &#125;</div></pre></td></tr></table></figure>
<p>Foudation 更进一步，使用跨范围的媒体查询，避免使用过多的 max-width 和 min-width</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">// Defining values</div><div class="line">$small-range:   (0em, 40em);       /* 0, 640px */</div><div class="line">$medium-range:  (40.063em, 64em);  /* 641px, 1024px */</div><div class="line">$large-range:   (64.063em, 90em);  /* 1025px, 1440px */</div><div class="line">$xlarge-range:  (90.063em, 120em); /* 1441px, 1920px */</div><div class="line">$xxlarge-range: (120.063em);       /* 1921px */</div><div class="line"> </div><div class="line">// Defining media queries</div><div class="line">$screen:       &quot;only screen&quot; !default;</div><div class="line">$landscape:    &quot;#&#123;$screen&#125; and (orientation: landscape)&quot; !default;</div><div class="line">$portrait:     &quot;#&#123;$screen&#125; and (orientation: portrait)&quot; !default;</div><div class="line">$small-up:     $screen !default;</div><div class="line">$small-only:   &quot;#&#123;$screen&#125; and (max-width: #&#123;upper-bound($small-range)&#125;)&quot; !default;</div><div class="line">$medium-up:    &quot;#&#123;$screen&#125; and (min-width:#&#123;lower-bound($medium-range)&#125;)&quot; !default;</div><div class="line">$medium-only:  &quot;#&#123;$screen&#125; and (min-width:#&#123;lower-bound($medium-range)&#125;) and (max-width:#&#123;upper-bound($medium-range)&#125;)&quot; !default;</div><div class="line">$large-up:     &quot;#&#123;$screen&#125; and (min-width:#&#123;lower-bound($large-range)&#125;)&quot; !default;</div><div class="line">$large-only:   &quot;#&#123;$screen&#125; and (min-width:#&#123;lower-bound($large-range)&#125;) and (max-width:#&#123;upper-bound($large-range)&#125;)&quot; !default;</div><div class="line">$xlarge-up:    &quot;#&#123;$screen&#125; and (min-width:#&#123;lower-bound($xlarge-range)&#125;)&quot; !default;</div><div class="line">$xlarge-only:  &quot;#&#123;$screen&#125; and (min-width:#&#123;lower-bound($xlarge-range)&#125;) and (max-width:#&#123;upper-bound($xlarge-range)&#125;)&quot; !default;</div><div class="line">$xxlarge-up:   &quot;#&#123;$screen&#125; and (min-width:#&#123;lower-bound($xxlarge-range)&#125;)&quot; !default;</div><div class="line">$xxlarge-only: &quot;#&#123;$screen&#125; and (min-width:#&#123;lower-bound($xxlarge-range)&#125;) and (max-width:#&#123;upper-bound($xxlarge-range)&#125;)&quot; !default;</div><div class="line"> </div><div class="line">// Usage</div><div class="line">@media #&#123;$small-up&#125;     &#123; ... &#125;</div><div class="line">@media #&#123;$small-only&#125;   &#123; ... &#125;</div><div class="line">@media #&#123;$medium-up&#125;    &#123; ... &#125;</div><div class="line">@media #&#123;$medium-only&#125;  &#123; ... &#125;</div><div class="line">@media #&#123;$large-up&#125;     &#123; ... &#125;</div><div class="line">@media #&#123;$large-only&#125;   &#123; ... &#125;</div><div class="line">@media #&#123;$xlarge-up&#125;    &#123; ... &#125;</div><div class="line">@media #&#123;$xlarge-only&#125;  &#123; ... &#125;</div><div class="line">@media #&#123;$xxlarge-up&#125;   &#123; ... &#125;</div><div class="line">@media #&#123;$xxlarge-only&#125; &#123; ... &#125;</div></pre></td></tr></table></figure>
<p>两种方法各有一个不爽的地方，在 Bootstrap 里每次都要使用 max-width，在 Foundation 里我们需要使用插值变量这种又丑又烦的方式，我们需要想办法解决这些问题。</p>
<h2 id="2-使用独立-Mixin-With-a-standalone-mixin"><a href="#2-使用独立-Mixin-With-a-standalone-mixin" class="headerlink" title="2. 使用独立 Mixin(With a standalone mixin)"></a>2. 使用独立 Mixin(With a standalone mixin)</h2><p><a href="http://css-tricks.com/media-queries-sass-3-2-and-codekit/" target="_blank" rel="external">《media queries in Sass 3.2》</a>是 <a href="http://css-tricks.com/" target="_blank" rel="external">CSS-Tricks</a> 里最火的文章之一，在这篇文章里 Chris Coyier 在借鉴 <a href="http://thesassway.com/intermediate/responsive-web-design-in-sass-using-media-queries-in-sass-32" target="_blank" rel="external">a former idea by Mason Wendell</a> 和 <a href="http://jeffcroft.com/blog/2012/mar/02/implementing-responsive-design/" target="_blank" rel="external">a former idea by Jeff Croft</a> 两文的基础上，如何使用 sass 实现响应式布局的断点管理。</p>
<p>命名断点是非常重要的，因为可以为抽象的数字赋予意义（你知道767px是什么意思吗，我不知道，直到我去使用小屏幕的时候才知道）。为什么 Bootstrap 和 Foundation 要使用变量呢，不也是为了给抽象的数字起个名字吗？</p>
<p>所以我们定义个 mixin，接收断点名作唯一的参数，返回媒体查询的内容。准备好了吗？走起。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">@mixin respond-to($breakpoint) &#123;</div><div class="line">    @if $breakpoint == &quot;small&quot; &#123;</div><div class="line">        @media (min-width: 767px) &#123;</div><div class="line">            @content;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    @else if $breakpoint == &quot;medium&quot; &#123;</div><div class="line">        @media (min-width: 992px) &#123;</div><div class="line">            @content;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    @else if $breakpoint == &quot;large&quot; &#123;</div><div class="line">        @media (min-width: 1200px) &#123;</div><div class="line">            @content;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后，我们这样使用 mixin：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">@include respond-to(small) &#123; ... &#125;</div><div class="line">@include respond-to(medium) &#123; ... &#125;</div><div class="line">@include respond-to(large) &#123; ... &#125;</div></pre></td></tr></table></figure>
<p>这个方法是极好的（甄嬛体，老外也看？），原因有二：抽象数据有意义，大量断点集中管理。如果你想把“992px”改成“970px”，你不需要爬过每一个 css 文件，而只需更新 mixin，然后全部更新。</p>
<p>但是也还有两个问题：</p>
<ul>
<li>断点不容易从mixin里拿出来，放到配置文件里去</li>
<li>冗余太多</li>
</ul>
<h2 id="3-可配置的mixin-With-a-configurable-mixin"><a href="#3-可配置的mixin-With-a-configurable-mixin" class="headerlink" title="3. 可配置的mixin(With a configurable mixin)"></a>3. 可配置的mixin(With a configurable mixin)</h2><p>为了解决上面的两个问题，我们需要从断点 mixin 中抽出一个列表，只剩下 mixin 核心，然后这个列表就可以随便移动，或者扔到配置文件中。然后，使用 sass 3.3+ 中的 maps，我们可以方便的使用关联的属性和属性值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$breakpoints: (</div><div class="line">    &apos;small&apos;  : 767px,</div><div class="line">    &apos;medium&apos; : 992px,</div><div class="line">    &apos;large&apos;  : 1200px</div><div class="line">);</div></pre></td></tr></table></figure>
<p>然后原来的 mixin 进行相应的修改：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">@mixin respond-to($breakpoint) &#123;</div><div class="line">    // Retrieves the value from the key</div><div class="line">    $value: map-get($breakpoints, $breakpoint);</div><div class="line"> </div><div class="line">    // If the key exists in the map</div><div class="line">    @if $value != null &#123;</div><div class="line">        // Prints a media query based on the value</div><div class="line">        @media (min-width: $value) &#123;</div><div class="line">            @content;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    // If the key doesn&apos;t exist in the map</div><div class="line">    @else &#123;</div><div class="line">        @warn &quot;Unfortunately, no value could be retrieved from `#&#123;$breakpoint&#125;`. &quot;</div><div class="line">            + &quot;Please make sure it is defined in `$breakpoints` map.&quot;;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们在修改 mixin 的同时也进行了一些提高，不要小看这些提高，我们加上了错误处理，如果在 maps 中没有找到断点值，将会弹出一个错误提示，这将便于我们开发过程中的调试。</p>
<p>我们让 mixin 变得更加精简，能很好的处理错误，同时我们去掉了一个功能——判断属性是否是你想要的（min-width, max-width, min-height等），这在移动优先的网页中没问题，因为我们仅仅需要 min-width。但是，如果需要查询其他属性，我们需要把这个功能加回来。为了达到这个目的，我想到了一个非常优雅的解决方案，同时并不增加复杂性。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">$breakpoints: (</div><div class="line">    &apos;small&apos;  : ( min-width:  767px ),</div><div class="line">    &apos;medium&apos; : ( min-width:  992px ),</div><div class="line">    &apos;large&apos;  : ( min-width: 1200px )</div><div class="line">);</div><div class="line">  </div><div class="line">@mixin respond-to($name) &#123;</div><div class="line">    // If the key exists in the map</div><div class="line">    @if map-has-key($breakpoints, $name) &#123;</div><div class="line">        // Prints a media query based on the value</div><div class="line">        @media #&#123;inspect(map-get($breakpoints, $name))&#125; &#123;</div><div class="line">            @content;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    // If the key doesn&apos;t exist in the map</div><div class="line">    @else &#123;</div><div class="line">        @warn &quot;Unfortunately, no value could be retrieved from `#&#123;$breakpoint&#125;`. &quot;</div><div class="line">            + &quot;Please make sure it is defined in `$breakpoints` map.&quot;;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在这里，我们主要做了三个事情</p>
<ul>
<li>检查查询的断点在map中存在不存在</li>
<li>如果存在，打印对应的媒体查询。</li>
<li>如果不在，进行错误提示。</li>
</ul>
<p>简单吧，如果我们回顾前面的两个缺陷，已经不再有 WET(Write Everything Twice) 问题，也不再有不灵活的媒体查询。但是还有一个问题，不支持复杂的媒体查询。复杂指的是涉及多个组件的查询（e.g. screen and (min-width: 767px)）。我们上面这些方案除了第一种变量之外都不能很好的解决这个问题。</p>
<h2 id="4-使用外部工具-With-an-external-tool"><a href="#4-使用外部工具-With-an-external-tool" class="headerlink" title="4. 使用外部工具(With an external tool)"></a>4. 使用外部工具(With an external tool)</h2><p>最后一个同样重要的是，如果不想创建自己的 mixin，你可以使用外部的工具处理响应式布局的断点，有很多 sass 的扩展在这个方面做得很好。</p>
<ul>
<li><a href="https://github.com/guardian/sass-mq" target="_blank" rel="external">SassMQ</a> by Kaelig</li>
<li><a href="http://breakpoint-sass.com/" target="_blank" rel="external">Breakpoint</a> by Mason Wendell and Sam Richard</li>
<li><a href="https://github.com/BPScott/breakup" target="_blank" rel="external">Breakup</a> by Ben Scott</li>
</ul>
<table>
<thead>
<tr>
<th></th>
<th style="text-align:center">SassMQ</th>
<th style="text-align:right">Breakpoint</th>
<th style="text-align:right">Breakup</th>
</tr>
</thead>
<tbody>
<tr>
<td>MQ type</td>
<td style="text-align:center"><code>*-width</code></td>
<td style="text-align:right">any</td>
<td style="text-align:right">any</td>
</tr>
<tr>
<td>No Query fallback</td>
<td style="text-align:center">yep</td>
<td style="text-align:right">yep</td>
<td style="text-align:right">yep</td>
</tr>
<tr>
<td>API complexity</td>
<td style="text-align:center">simple</td>
<td style="text-align:right">very simple</td>
<td style="text-align:right">medium</td>
</tr>
<tr>
<td>Code complexity</td>
<td style="text-align:center">very simple</td>
<td style="text-align:right">complexe</td>
<td style="text-align:right">simple</td>
</tr>
<tr>
<td>Extra</td>
<td style="text-align:center">Debug mode</td>
<td style="text-align:right">Singularity.gs</td>
<td style="text-align:right">—</td>
</tr>
</tbody>
</table>
<p>基本上是这样，如果发现有没有涉及的，记得一定告诉我。</p>
<ul>
<li><p>SassMQ</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">// Configuration</div><div class="line">$mq-responsive: true;</div><div class="line">$mq-static-breakpoint: desktop;</div><div class="line">$mq-breakpoints: (</div><div class="line">    mobile:  320px,</div><div class="line">    tablet:  740px,</div><div class="line">    desktop: 980px,</div><div class="line">    wide:    1300px</div><div class="line">);</div><div class="line"> </div><div class="line">// Example</div><div class="line">selector &#123;</div><div class="line">    @include mq($from: mobile) &#123;</div><div class="line">        property: value;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>BreakPoints</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">$high-tide: 500px;</div><div class="line">$ex-presidents: 600px 800px;</div><div class="line">$surfboard-width: max-width 1000px;</div><div class="line">$surfboard-height: (min-height 1000px) (orientation portrait);</div><div class="line">     </div><div class="line">selector &#123;</div><div class="line">    @include breakpoint($high-tide) &#123;</div><div class="line">        property: value;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>Breakup</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">$breakup-breakpoints: (</div><div class="line">    &apos;thin&apos; &apos;(max-width: 35.999em)&apos;,</div><div class="line">    &apos;wide&apos; &apos;(min-width: 36em)&apos;,</div><div class="line">    &apos;full&apos; &apos;(min-width: 61em)&apos;</div><div class="line">);</div><div class="line"> </div><div class="line">selector &#123;</div><div class="line">    @include breakup-block(&apos;thin&apos;) &#123;</div><div class="line">        property: value;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="5-总结"><a href="#5-总结" class="headerlink" title="5. 总结"></a>5. 总结</h2><p>我们在这篇文章里看到的这么些个方案，都有长有短，没有一个完美的方案。最后我觉得还是由你来决定怎么把握可用性和复杂性的平衡。</p>
<p>一句话，在合适的场合使用合适的工具。</p>
<blockquote>
<p>本文转载自：<a href="http://blog.csdn.net/whqet/article/details/26564287" target="_blank" rel="external">http://blog.csdn.net/whqet/article/details/26564287</a><br>原文：<a href="https://www.sitepoint.com/managing-responsive-breakpoints-sass/" target="_blank" rel="external">《Managing Responsive Breakpoints with Sass》</a><br>作者：<a href="https://www.sitepoint.com/author/hgiraudel/" target="_blank" rel="external">Hugo Giraudel</a>，来自法国，<a href="http://hugogiraudel.com/" target="_blank" rel="external">著名 SASS 大牛</a>，在 <a href="http://thesassway.com/" target="_blank" rel="external">SassWay</a> 等多个网站撰文推广 sass，是 SassyJSON、SassyMatrix 等多个开源项目的开发者，大家可以到他的<a href="http://hugogiraudel.com/" target="_blank" rel="external">官方网站</a>、<a href="https://github.com/HugoGiraudel" target="_blank" rel="external">github</a> 上了解详情。<br>翻译：前端开发whqet，以意译为主，不当之处请大家批评指正。</p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;当你需要搞定响应式布局时，一堆堆的媒体查询、大量的属性、属性值往往可以把你搞颠，SASS（或者诸如此类的预处理器）被认为是处理响应式断点的最佳利器。&lt;/p&gt;
&lt;p&gt;说到响应式断点处理，很多种方式涌上心头，经常有人问哪种方式最优，正如前端开发领域的大多数问题一样，这个问题同样没有标准答案，我们需要具体问题具体分析。更确切的说，难度不在于提出一个系统，而是提出一个既足够灵活（适用大部分场合）又不非常复杂的系统。&lt;/p&gt;
&lt;p&gt;在今天的文章里，我将给大家介绍若干种响应式布局断点的解决方案，每一种都经过实践验证，一些方案可能优于其他方案，我会把决定的权利交给大家。&lt;br&gt;
    
    </summary>
    
      <category term="HTML/CSS" scheme="http://zqianduan.com/categories/HTML-CSS/"/>
    
    
      <category term="css" scheme="http://zqianduan.com/tags/css/"/>
    
      <category term="media" scheme="http://zqianduan.com/tags/media/"/>
    
  </entry>
  
  <entry>
    <title>BigPipe 学习研究</title>
    <link href="http://zqianduan.com/2016/03/12/an-introduction-to-bigpipe/"/>
    <id>http://zqianduan.com/2016/03/12/an-introduction-to-bigpipe/</id>
    <published>2016-03-12T05:02:10.000Z</published>
    <updated>2017-04-27T07:01:51.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-技术背景：FaceBook-页面加载技术"><a href="#1-技术背景：FaceBook-页面加载技术" class="headerlink" title="1. 技术背景：FaceBook 页面加载技术"></a>1. 技术背景：FaceBook 页面加载技术</h2><p>试想这样一个场景，一个经常访问的网站，每次打开它的页面都要要花费 6 秒；同时另外一个网站提供了相似的服务，但响应时间只需 3 秒，那么你会如何选择呢？数据表明，如果用户打开一个网站，等待 3~4 秒还没有任何反应，他们会变得急躁，焦虑，抱怨，甚至关闭网页并且不再访问，这是非常糟糕的情况。所以，网页加载的速度十分重要,尤其对于拥有遍布全球的 5 亿用户的 Facebook(全球最大的社交服务网站)这样的大型网站，有着大量并发请求、海量数据等客观情况，速度就成了必须攻克的难题之一。<br><a id="more"></a></p>
<p>2010 年初的时候，Facebook 的前端性能研究小组开始了他们的优化项目，经过了六个月的努力，成功的将个人空间主页面加载耗时由原来的 5 秒减少为现在的 2.5 秒。这是一个非常了不起的成就，也给用户来带来了很好的体验。在优化项目中，工程师提出了一种新的页面加载技术，称之为 Bigpipe。目前淘宝和 Facebook 面临的问题非常相似：海量数据和页面过大，如果可以在详情页、列表页中使用 bigpipe，或者在 webx 中集成 bigpipe，将会带来明显的页面加载速度提升。</p>
<h2 id="2-相关介绍"><a href="#2-相关介绍" class="headerlink" title="2. 相关介绍"></a>2. 相关介绍</h2><ul>
<li><p>2.1 网站前端优化的重要性</p>
<p>  《高性能网站建设指南》一书中指出，只有10%~20%的最终用户响应时间是花费在从Web 服务器获取HTML 文档并传送到浏览器中的。如果希望能够有效地减少页面的响应时间，就必须关注剩余的80%~90%的最终用户体验。做个比较，如果对后台业务逻辑进行优化，效率提高了50%，但最终的页面响应时间只减少了5%~10%，因为它所占的比重较少。如果对前端进行性能优化，效率提升50%，则会使最终页面响应时间减少40%~45%。这是多么可观的数字！另外，前端的性能优化一般比业务逻辑的优化更加容易。所以，前端优化投入小，见效快，性价比极高，需要投入更多的关注。</p>
</li>
<li><p>2.2 BigPipe与AJAX</p>
<p>  Web2.0 的重要特征是网页显示大量动态内容，即 web2.0 注重网页与用户的交互。其核心技术是 AJAX，如今所有主流网站都或多或少使用 AJAX。与 AJAX 类似，BigPipe 实现了分块儿的概念，使页面能够分步输出，即每次输出一部分网页内容。接下来讨论 BigPipe 与 AJAX 的区别。</p>
<p>  简单的说，BigPipe 比AJAX 有三个好处：</p>
<ul>
<li><p>AJAX 的核心是XMLHttpRequest，客户端需要异步的向服务器端发送请求，然后将传送过来的内容动态添加到网页上。如此实现存在一些缺陷，即发送往返请求需要耗费时间，而BigPipe 技术使浏览器并不需要发送XMLHttpRequest 请求，这样就节省时间损耗。</p>
</li>
<li><p>使用AJAX时，浏览器和服务器的工作顺序执行。服务器必须等待浏览器的请求，这样就会造成服务器的空闲。浏览器工作时，服务器在等待，而服务器工作时，浏览器在等待，这也是一种性能的浪费。使用BigPipe，浏览器和服务器可以并行同时工作，服务器不需要等待浏览器的请求，而是一直处于加载页面内容的工作阶段，这就会使效率得到更大的提高。</p>
</li>
<li><p>减少浏览器发送到请求。对一个5亿用户的网站来说，减少了使用AJAX额外带来的请求，会减少服务器的负载，同样会带来很大的性能提升。</p>
<p>基于以上三点，Facebook 在进行页面优化时采用了BigPipe 技术。目前淘宝主搜索结果页中，需要加载类目，相关搜索，宝贝列表，广告等内容，前端这里使用php 的curl 的批处理来并发的访问引擎获取相应的数据，并进行分步输出。这种模式还是与bigpipe有些不同，这点后面会讲到。一般来讲，在页面比较大，而且比较复杂，样式表和脚本比较多的情况下，使用BigPipe 来优化输出页面是比较合适的。另外非常重要的一点，BigPipe 并不改变浏览器的结构与网络协议，仅使用JS就可以实现，用户不需要做任何的设置，就会看到明显的访问时间缩短。</p>
</li>
</ul>
</li>
</ul>
<h2 id="3-目前的问题"><a href="#3-目前的问题" class="headerlink" title="3. 目前的问题"></a>3. 目前的问题</h2><p>接下来讨论现有的瓶颈。面对网页越来越大的情况，尤其是大量的css 文件和js 文件需要加载，传统的页面加载模型很难满足这样的需求，直接结果就是页面加载速度变慢，这绝不是我们希望看到的。目前的技术实现中，用户提出页面访问请求后，页面的完整加载流程如下：</p>
<ol>
<li><p>用户访问网页，浏览器发送一个HTTP 请求到网络服务器</p>
</li>
<li><p>服务器解析这个请求，然后从存储层去数据，接着生成一个html 文件内容，并在一个HTTP Response 中把它传送给客户端</p>
</li>
<li><p>HTTP response 在网络中传输</p>
</li>
<li><p>浏览器解析这个Response ，创建一个DOM 树，然后下载所需的CSS 和JS文件</p>
</li>
<li><p>下载完CSS 文件后，浏览器解析他们并且应用在相应的内容上</p>
</li>
<li><p>下载完JS 后，浏览器解析和执行他们</p>
</li>
</ol>
<p><img src="http://www.searchtb.com/wp-content/uploads/2011/03/12.jpg" alt="图1"></p>
<p>完整流程见图1，图中左侧表示服务器，右侧表示浏览器。浏览器先发送请求，然后服务器进行查找数据，生成页面，返回html 代码，最后浏览器进行渲染页面。这种模式有非常明显的缺陷：流程中的操作有着严格的顺序，如果前面的一个操作没有执行结束，后面的操作就不能执行，即操作之间是不能重叠。这样就造成性能的瓶颈：服务器生成一个页面的内容时，浏览器是空闲的，显示空白内容；而当浏览器加载渲染页面内容时，服务器又是空闲的，时间与性能的浪费由此产生。</p>
<p><img src="http://www.searchtb.com/wp-content/uploads/2011/03/800px-Bigpipe40.jpg" alt="图2"></p>
<p>考虑图2 中现有的服务模型，横轴表示花费的时间。黄色表示在服务器的生成页面内容的时间，白色表示网络传输时间，蓝色表示在浏览器渲染页面的时间。可以看出，现有的模式造成很大的时间浪费。 考虑图3 中的情况，图中绿色表示服务器从春储层取查数据花费的时间，在海量数据下，当执行一条很费时的查询语句时（如下图右侧），服务器就就阻塞在那 里没有其他操作，而浏览器更是得不到任何反馈。这会造成非常不友好的用户体验，用户不知道什么原因使他们等待很长时间。</p>
<p><img src="http://www.searchtb.com/wp-content/uploads/2011/03/800px-Bigpipe51.jpg" alt="图3"></p>
<h2 id="4-BigPipe思想与原理"><a href="#4-BigPipe思想与原理" class="headerlink" title="4. BigPipe思想与原理"></a>4. BigPipe思想与原理</h2><p>面对上述问题，我们看下 BigPipe 的解决办法。BigPipe 提出分块的概念，即根据页面内容位置的不同，将整个页面分成不同的块儿 – 称为 pagelet。该技术的设计者 Changhao Jiang 是研究电子电路的博士，可能从微机上得到了启发，将众多 pagelet 加载的不同阶段像流水线一样在浏览器和服务器上执行，这样就做到了浏览器和服务器的并行化，从而达到重叠服务器端运行时间和浏览器端运行时间的目的。使用 BigPipe 不仅可以节省时间，使加载的时间缩短，而且可以同过 pagelet 的分步输出，使一部分的页面内容更快的输出，从而获得更好的用户体验。BigPipe 中，用户提出页面访问请求后，页面的完整加载流程如下:</p>
<ol>
<li><p>Request parsing：服务器解析和检查http request</p>
</li>
<li><p>Datafetching：服务器从存储层获取数据</p>
</li>
<li><p>Markup generation：服务器生成html 标记</p>
</li>
<li><p>Network transport ： 网络传输response</p>
</li>
<li><p>CSS downloading：浏览器下载CSS</p>
</li>
<li><p>DOM tree construction and CSS styling:浏览器生成DOM 树，并且使用CSS</p>
</li>
<li><p>JavaScript downloading: 浏览器下载页面引用的JS 文件</p>
</li>
<li><p>JavaScript execution: 浏览器执行页面JS代码</p>
</li>
</ol>
<p>这 8 个流程几乎与上文中提到现有的模式没有区别，但这整个流程只是一个 pagelet 的完整流程，而多个 pagelet 的不同操作阶段就可以像流水线一样进行执行了。</p>
<p><img src="http://www.searchtb.com/wp-content/uploads/2011/03/22.jpg" alt="图4"></p>
<p>图4 中，可以看出 BigPipe 对原有的模式进行的改进。浏览器发送访问请求，然后浏览器分步返回不同的 pagelet 的内容，具体实现将在后面介绍.考虑图5中的改进，BigPipe 打破了原有的顺序执行，将页面分成不同的 pagelet ，如此一来，所有的 pagelet 的执行时间累加起来还是原有的时间。但是， 通过叠加不同 pagelet 的不同阶段的执行时间，使总的运行时间大大减少，这就是 Bigpipe 减少页面加载时间的秘密。</p>
<p><img src="http://www.searchtb.com/wp-content/uploads/2011/03/Bigpipe60.jpg" alt="图5"></p>
<p>FaceBook的页面被分成了很多不同的pagelets，如图：</p>
<p><img src="http://www.searchtb.com/wp-content/uploads/2011/03/BigPipe_11.jpg" alt="图6"></p>
<h2 id="5-BigPipe实现原理"><a href="#5-BigPipe实现原理" class="headerlink" title="5. BigPipe实现原理"></a>5. BigPipe实现原理</h2><p>了解了 BigPipe 的核心思想后，我们讨论它的实现原理。当浏览器访问服务器时，服务器接受请求并对其进行检查。如果请求有效，服务器端不做任何的查询，而是立刻返回一个 http request 给浏览器，内容是一段 html 代码，包括 html <head> 标签和 </head><body> 标签的一部分。<head> 标签包括 BigPipe 的 js 文件和 css 文件，这个 js 文件用来解析后面接收的 http response，因为后面传输的内容都为 js 脚本。未封闭的 </head><body> 标签中，是显示页面的逻辑结构和 pagelet 的占位符的模板，例如：</body></body></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"hotnews"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"societynews"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"financialnews"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"ITnews"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"sportsnews"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>上述模板使用 css-div 描述了页面的结构，不同的 div 标签对应不同的 pagelet，id 对应了 pagelet 的名称。将这个 response 返回给浏览器后，服务器开始对每个 pagelet 的内容进行查询，加载，生成。当一个 pagelet 的内容生成好，立刻调用 flush() 函数，将其返回给客户端，传输的数据是以 json 格式的，包括这个 pagelet 需要的 CSS 和 JS，以及 html 内容和一些元数据。例如：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    big_pipe.onPageletArrive(&#123;</div><div class="line">        <span class="attr">id</span>: <span class="string">'pagelet_composer'</span>,</div><div class="line">        <span class="attr">content</span>: <span class="string">'&lt;html&gt;'</span>,</div><div class="line">        <span class="attr">css</span>: <span class="string">'[..]'</span>,</div><div class="line">        <span class="attr">js</span>: <span class="string">'[..]'</span>,</div><div class="line">        <span class="comment">// ......</span></div><div class="line">    &#125;);</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p>其中 “content” 表示这个 pagelet 的内容，是 html 源码，特殊字符如”/“需要进行转义；”id” 表示 content 要显示的位置，即为对应的 pagelet 的 id 标签；”css” 表示需要下载的 CSS 资源的路径；”js” 表示需要下载的 JS 脚本的路径。为了避免文件路径过长，所以在前面需要对 css 和 js 文件的路径进行转换，转换后为 5 位字符串：不同的 pagelet 可能会加载同一个 css 或 js 文件，所以要避免重复下载。</p>
<p>虽然每个 pagelet 都有要加载的 js 文件，但是所有的 js 文件都是在最后加载，这样有利于加快页面加载速度。客户端，当通过调用 <code>onPageletArrive(json)</code> 函数，第一次影响传输的 JS 脚本中的函数解析了传入的 json 数据，接着下载需要的 CSS，然后把 html 内容显示到响应的 DIV 标签位置上。多个 pagelets 的 CSS 文件可以同时下载，CSS 下载完成的 pagelet 先显示。</p>
<p>在 BigPipe 中，js 被给予了比 CSS 和 content 更低的优先级。这样， 只有当所有的 pagelets 都显示了，BigPipe 才开始去下载 JS 文件。所有的 JS 文件都下载完成后，Pagelets 的 JS 初始化代码开始执行，按照下载完成时间的先后顺序。在这个高度并行的系统中，几个的 pagelet 所要执行的不同的阶段可以同时执行。例如，浏览器可以给两个 pagelets 下载 CSS 资源，同时浏览器可以渲染另外一个 pagelet 的内容，同时服务器仍然在为另一个 pagelet 生成 html 源码。从用户的角度看来，页面时逐步呈现的。初始的页面显示的更快，可以有效减短用户感觉到的延迟。</p>
<h2 id="6-BigPipe实现问题讨论"><a href="#6-BigPipe实现问题讨论" class="headerlink" title="6. BigPipe实现问题讨论"></a>6. BigPipe实现问题讨论</h2><ul>
<li><p>6.1 服务器端的并行化</p>
<p>  理想情况下，服务器端的实现是并行处理不同的 pagelet 的内容，这样可以提升性能。服务器并发处理多个 pagelet 的内容时，一个 pagelet 内容生成好了，立刻将其 flush 给浏览器。但是 PHP 是不支持线程，所以服务器无法利用多线程的概念去并发的加载多个 pagelet 的内容。对于小型网站来说，使用串行的加载 pagelet 的内容就已经可以达到优化的要求了。对于大型网站，为了达到更快的速度，服务器端可以选择并发的独立不同的 pagelet 的内容，具体实现有以下几种方式：</p>
<ul>
<li><p>java 多线程。后台逻辑使用 java，可以使用 java 的多线程机制去同时加载不同的 pagelet 的内容，加载完成后加页面内容返回给浏览器。在最后的引用部分可以看到网上用 java 多线程实现的例子。</p>
</li>
<li><p>使用 PHP 实现。PHP 不支持线程，无法像 java 使用多线程的机制来并发处理不同 pagelet 的内容。但是，Facebook 和淘宝主搜索的业务逻辑是用 PHP 实现的，所以我们必须考虑如何在 PHP 下完成并发处理。PHP 扩展中有 curl 模块，可以在该模块中 <code>curl_multi_fetch()</code> 函数进行批处理请求，把本来应该串行的请求访问并发的执行。可以这样写：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">do</span> &#123;</div><div class="line">    $mrc = curl_multi_exec($mh, $active);</div><div class="line">&#125;</div><div class="line"><span class="keyword">while</span>($mrc==CURLM_CALL_MULTI_PERFORM);</div><div class="line"> </div><div class="line"><span class="keyword">while</span>($active &amp;amp;&amp;amp; $mrc == CURLM_OK) &#123;</div><div class="line"> </div><div class="line">    <span class="keyword">if</span> (curl_multi_select($mh) != <span class="number">-1</span>) &#123;</div><div class="line"> </div><div class="line">        <span class="keyword">do</span> &#123;             </div><div class="line">            $mrc = curl_multi_exec($mh,$active);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">while</span>($mrc == CURLM_CALL_MULTI_PERFORM);</div><div class="line"> </div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>但是会碰到一个问题，多个请求是同时返回结果的。当所有的 pagelet 的页面请求所消耗的时间差不多时，可以达到很好的性能，但是当有的消耗时间很长（执行一条复杂的查询）的情况下，批处理就会阻塞在那里，等每个请求都返回结果了才结束。而在这段时间致服务器会阻塞在那里不返回任何内容，而浏览器更是没有响应，这样就违背了 BigPipe 的原理。另外一种实现方法是使用 <code>stream_select</code> 函数。跟上一种方法类似，不过可以使用 PHP5 中新增的 <code>stream_socket_client()</code> 函数链接而不是之前 PHP 函数中的 <code>fsocketopen()</code> 函数。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">while</span> (count($sockets)) &#123;</div><div class="line">    $read = $write = $sockets;</div><div class="line">    $n = stream_select($read,$write, $e, $timeout);</div><div class="line">     </div><div class="line">    <span class="keyword">if</span> ($n &amp;gt; <span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">foreach</span> ($read <span class="keyword">as</span> $r) &#123;</div><div class="line">            $id = array_search($r, $sockets);</div><div class="line">            $data = fread($r, <span class="number">8192</span>);</div><div class="line">             </div><div class="line">            <span class="keyword">if</span> (strlen($data) == <span class="number">0</span>) &#123;</div><div class="line">                fclose($r);                         </div><div class="line">                <span class="keyword">unset</span> ($sockets[$id]);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">else</span> &#123;</div><div class="line">                $retdata[$id] .= $data;                     </div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">         </div><div class="line">        $retdata[$id] = preg_replace(<span class="string">'/^HTTP(.*?)\r\n\r\n/is'</span>, &lt;em&gt;, $retdata[$id]);</div><div class="line">         </div><div class="line">        <span class="keyword">foreach</span> ($write <span class="keyword">as</span> $w) &#123;</div><div class="line">            <span class="keyword">if</span> (!is_resource($w)) <span class="keyword">continue</span>;</div><div class="line"></div><div class="line">            $id = array_search($w, $sockets);</div><div class="line">            fwrite($w, <span class="string">"GET /"</span> . $url[$id] . <span class="string">"HTTP/1.0\r\nHost: "</span> . $hosts[$id] .<span class="string">"\r\n\r\n"</span>);</div><div class="line">            $status[$id] = <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">     </div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这样实现也可以做到服务器的并发访问，但是会碰到和上一种方法同样的问题：服务器的阻塞问题。所以，可以采用另一种方法，用多进程模拟多线程。使用 PHP 的扩展模块 pctnl 模块中的 <code>pcntl_fork()</code> 函数来生成子进程， 用不同的子进程去处理不同的 pagelet 的页面内容。如果子进程返回内容，则返回给浏览器。或者，修改 curl 模块。使其可以支持回调函数，当并发请求中一个请求完成时，立刻调用回调函数。这两种方法目前还在探索中。</p>
</li>
</ul>
</li>
<li><p>6.2 直接调用 flush 函数输出</p>
<p>  到这里，可能会有这样的疑问，为什服务器不直接把生成好的 HTML 内容分部 flush 返回给客户端，而是使用 json 格式传递，然后用 js 解析呢？这不是多此一举么？实际上，这也是目前主搜索前端使用的方法。我们看看使用 BigPipe 方式的两大好处：</p>
<ul>
<li><p>如果直接调用 <code>flush()</code> 函数输出 html 源码，当模块较多的情况，模块间必须按顺序加载，在 html 前面的模块必须先加载完，后面的才能加载，这样也就没办法每个模块同时显示一些内容。例如下面的 html：</p>
<p>  上面 3 个 div 分别代表 3 个模块，如果直接分部输出 html，服务器端必须先加载完毕 div1 模块中的内容并 flush 出去后，才能继续加载 div2 的内容，如果 flush 顺序不一样，输出的 html 结构肯定就会出问题，这样就导致前台页面没办法同时显示 3 个 loading。因为这样 flush 必须要有先后顺序。而如果采用 JS 的话，可以前台显示3 个 loading，而且不需要关心到底哪个模块先加载完，这样还能发挥后台多线程处理数据的优势。</p>
</li>
<li><p>使用 JS 这种方式可以是页面结构更加清晰，管理更加方便。同时做到了页面逻辑结构和数据解耦，首先返回的是页面的结构，接着不断地返回 js 脚本，然后动态添加页面内容，而不是所有完整的 html 源码一起输出，增加了可维护性。</p>
</li>
</ul>
</li>
<li><p>6.3 访问者是爬虫或者访问者浏览器禁止使用 JS 的情况</p>
<p>  我们知道 BigPipe 使用 js 脚本加载页面，那么当用户在浏览器里设置禁止使用 js 脚本（虽然人数很少），就会造成加载页面失败，这同样是非常不好的用户体验。对搜索引擎的爬虫来讲，同样会遇到类似的问题。解决办法是当用户发送访问请求时，服务器端检测 user-agent 和客户端是否支持 js 脚本。如果 user-agent 显示是一个搜索引擎爬虫或者客户端不支持 js，就不使用 BigPipe，而用原有的模式，从而解决问题。</p>
</li>
<li><p>6.4 对 SEO 的影响</p>
<p>  这是一个必须考虑的问题，如今是搜索引擎的时代，如果网页对搜索引擎不友好，或者使搜索引擎很难识别内容，那么会降低网页在搜索引擎中的排名，直接减少网站的访问次数。在 BigPipe 中，页面的内容都是动态添加的，所以可能会使搜索引擎无法识别。但是正如前面所说，在服务器端首先要根据 user-agent 判断客户端是否是搜索引擎的爬虫，如果是的话，则转化为原有的模式，而不是动态添加。这样就解决了对搜索引擎的不友好。</p>
</li>
<li><p>6.5 融合其他技术</p>
<p>  除了使用 BigPipe，Facebook 的页面加载技术还融合了其他的页面优化技术，具体如下：</p>
<ul>
<li><p>6.5.1 资源文件的G-zip压缩</p>
<p>  这是非常重要的技术，使用 Gzip 对 css 和 js 文件压缩可以使大小减少70%，这是多么诱人的数字！在网络传输的文件中，主要就是样式表和脚本文件。如此可以大大减小传输的内容，使页面加载速度变得更快。具体实现可以借助服务器来进行，例如 Apache，使用 mod_deflate 模块来完成，具体配置为：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">AddOutputFilterByType DEFLATE text/html text/css application/xjavascript</div></pre></td></tr></table></figure>
</li>
<li><p>6.5.2 将 js 文件进行了精简</p>
<p>  对 js 文件进行精简，可以从代码中移除不必要的字符，注释以及空行以减小 js 文件的大小，从而改善加载的页面的时间。精简 js 脚本的工具可以使用 JSMin，使用精简后的脚本的大小会减少 20% 左右。这也是一个很大的提升。</p>
</li>
<li><p>6.5.3 将 css 和 js 文件进行合并</p>
<p>  这是前端优化的一项原则，将多个样式表和 js 文件进行合并，这样的话，将会减少 http 的请求个数。对于上亿用户的网站来说，这也会带来性能的提升，大约会减少5%左右的时间损耗。</p>
</li>
<li><p>6.5.4 使用外部 JS 和 CSS</p>
<p>  同样是前端优化的一项原则。纯粹就速度来言，使用内联的 js 和 css 速度要更快，因为减少了 http 请求。但是，使用外部的文件更有利于文件的复用，这与面向对象编程的概念很像。更为重要的是，虽然在第一次的加载速度慢一点，但 css 文件和 js 脚本是可以被浏览器缓存。即之后用户的多次访问中，使用外部的 js 和 css 将会将会更好的提升速度。</p>
</li>
<li><p>6.5.5 将样式表放在顶部</p>
<p>  和上面内容相似，这也是一种规范，将 html 内容所需的 css 文件放在首部加载是非常重要的。如果放在页面尾部，虽然会使页面内容更快的加载（因为将加载 css 文件的时间放在最后，从而使页面内容先显示出来），但是这样的内容是没有使用样式表的，在 css 文件加载进来后，浏览器会对其使用样式表，即再次改变页面的内容和样式，称之为“无样式内容的闪烁”，这对于用户来说当然是不友好的。实现的时候将 css 文件放在 <head> 标签中即可。</head></p>
</li>
<li><p>6.5.6 将脚本放在底部实现“barrier”</p>
<p>  支持页面动态内容的 Js 脚本对于页面的加载并没有什么作用，把它放在顶部加载只会使页面更慢的加载，这点和前面的提到的 css 文件刚好相反，所以可以将它放在页尾加载。是用户能看到的页面内容先加载，js 文件最后加载，这样会使用户觉得页面速度更快。Bigpipe 实现一个 “barrier” 的概念，即当所有的 pagelet 的内容全部加载好了之后，浏览器再向服务器发送 js 的http 请求。可以在 BigPipe.js 中将所有的 pagelet 所需的 js 文件的路径保存下来，在判断所有的内容加载完成后统一向服务器发送请求。</p>
</li>
</ul>
</li>
</ul>
<h2 id="7-BigPipe-具体实现细节"><a href="#7-BigPipe-具体实现细节" class="headerlink" title="7. BigPipe 具体实现细节"></a>7. BigPipe 具体实现细节</h2><p>如上文讨论的那样，具体实现如下：</p>
<p>当用户访问该页面时，在第一个 flush 的 Response 内容中，返回大部分的 HTML 代码，包括完整的 <heaad> 标签，和一个未封闭的 <body>，其中 <head> 标签中有需要导入的文件的路径，如一些公共的 css 文件和 BigPipe.js 文件，</head><body> 标签有页面的主要布局，第二块 flush 的内容为一段 js 脚本，处理 BigPipe 对象的生成，以及 js 和 css 文件的路径和字符串的映射</body></body></heaad></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> bigPipe = <span class="keyword">new</span> bigPipe();</div><div class="line"></div><div class="line">bigPipe.setResourceMap(&#123;</div><div class="line">    <span class="attr">aaaaa</span>: &#123;</div><div class="line">        <span class="string">'name'</span>: <span class="string">'js/list1.js'</span>,</div><div class="line">        <span class="string">'type'</span>: <span class="string">'js'</span>,</div><div class="line">        <span class="string">'src'</span>: <span class="string">'js/list1.js'</span></div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p><code>setResourceMap(json)</code> 为 BigPipe 中的函数，功能是设置文件的映射。”aaaaa” 应该是在服务器随即生成的五位字符串，name 表示文件名称，type 为文件的类型，可以是 js 或 css，”src” 为文件的路径。在下面的页面中，就可以使用 “aaaaa” 来替代 “js/list1.js” 了，减少了复杂性。接下来 flush 的是每一个 pagelet 的内容了，例如：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    bigPipe.onPageletArrive(&#123;</div><div class="line">        <span class="attr">id</span>: <span class="string">'list1'</span>,</div><div class="line">        <span class="attr">content</span>: <span class="string">'this is list 1 &lt;\/ br&gt; &lt;img src = \"img13.jpg\" \/&gt;'</span>,</div><div class="line"></div><div class="line">        <span class="attr">css</span>: [<span class="string">'eeeee'</span>],</div><div class="line"></div><div class="line">        <span class="attr">js</span>: [<span class="string">'aaaaa'</span>],</div><div class="line"></div><div class="line">        <span class="string">'resource_map'</span>: &#123;</div><div class="line"></div><div class="line">            <span class="attr">aaaaa</span>: &#123;</div><div class="line">                <span class="string">'name'</span>: <span class="string">'js/list1.js'</span>,</div><div class="line">                <span class="string">'type'</span>: <span class="string">'js'</span>,</div><div class="line">                <span class="string">'src'</span>: <span class="string">'js/list1.js'</span></div><div class="line">            &#125;,</div><div class="line">            <span class="attr">eeeee</span>: &#123;</div><div class="line">                <span class="string">'name'</span>: <span class="string">'css/list1.css'</span>,</div><div class="line">                <span class="string">'type'</span>: <span class="string">'css'</span></div><div class="line">                <span class="string">'src'</span>: <span class="string">'css/list1.css'</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p><code>onPageletArrive(json_arrive)</code> 也是 BigPipe 的函数，功能是动态添加页面的内容和加载 pagelet 所需的文件，函数的参数为 json 格式的数据。其参数含义是：”id” 用来寻找 pagelet 标签；”content” 是 html 页面内容，在找到对应的 pagelet 的标签之后，将 content 内动态添加到 html 页面中；”css” 为该 Pagelet 所需的 css 文件，这里的 css 文件可能在之前导入过了；”js” 为该 pagelet 所需的 js 文件，同样，有可能在之前的 pagelet 已经导入过了。在函数实现过程中，因为 js 文件是最后加载的，可以把这些 js 的路径存入到一个数组当中（去掉重复的），在最后一起加载。”resource_map” 为该 pagelet 所单独需要加载的 js 和 css 文件，同样也是 json 格式的，结构与前面的 <code>setResource()</code> 中的参数一样。最后 flush 的是</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>即为最后的标签。</p>
<h2 id="8-结论"><a href="#8-结论" class="headerlink" title="8. 结论"></a>8. 结论</h2><p>经过上面的讨论，我们可以发现，使用 BigPipe 技术优化页面可以有四个好处：</p>
<p>1． 减少页面的加载时间</p>
<p>2． 使页面分步输出，改善用户体验</p>
<p>3． 使页面结构化，提高可读性，更加便于维护</p>
<p>4． 每个pagelet 都是相互独立的，如果有一个pagelet 的内容不能加载，并不会影响其他的pagelet 的内容显示。</p>
<p>同时，BigPipe 是一项比较新的理念， 在去年六月份才由 Facebook 的工程师提出，应该说有很大的发展空间。BigPipe 的原理非常简单，并不会引入很多额外的负担，适用范围很广，容易上手。几乎所有的网页都可以采用 BigPipe 的理念去进行优化，尤其对于是有着海量数据和网页比较大的网站，将会以低成本带来高回报。一般来讲，网站越大，脚本和样式表越多，浏览器版本越旧，网络环境越差，优化的结果越可观。</p>
<h2 id="9-引用与参考资料"><a href="#9-引用与参考资料" class="headerlink" title="9. 引用与参考资料"></a>9. 引用与参考资料</h2><ul>
<li><p>作者的博客：<a href="http://www.facebook.com/note.php?note_id=389414033919" target="_blank" rel="external">http://www.facebook.com/note.php?note_id=389414033919</a></p>
</li>
<li><p>bigpipe 技术的 ppt：<a href="http://twork.taobao.net/books/237" target="_blank" rel="external">http://twork.taobao.net/books/237</a></p>
</li>
<li><p>bigpipe 的 java 实现： <a href="http://codemonkeyism.com/facebook-bigpipe-java/" target="_blank" rel="external">http://codemonkeyism.com/facebook-bigpipe-java/</a></p>
</li>
<li><p>一篇介绍 bigpipe 的文章：<a href="http://www.54chen.com/architecture/rose-pipe-http-54chen.html" target="_blank" rel="external">http://www.54chen.com/architecture/rose-pipe-http-54chen.html</a></p>
</li>
<li><p>另一篇挺有用的文章：<a href="http://www.cnblogs.com/BearsTaR/archive/2010/06/18/facebook_html_chunk.html" target="_blank" rel="external">http://www.cnblogs.com/BearsTaR/archive/2010/06/18/facebook_html_chunk.html</a></p>
</li>
<li><p>人人网类似 bigpipe 的技术 – rosepipe：<a href="http://www.54chen.com/architecture/rose-open-source-portal-framework.html" target="_blank" rel="external">http://www.54chen.com/architecture/rose-open-source-portal-framework.html</a></p>
</li>
<li><p>《高性能网站建设指南》by Steve Souder， Copyright 2007 Steve Sounder， 978-0-596- 52930-7</p>
</li>
</ul>
<blockquote>
<p>本文转载自：<a href="http://www.searchtb.com/2011/04/an-introduction-to-bigpipe.html" target="_blank" rel="external">http://www.searchtb.com/2011/04/an-introduction-to-bigpipe.html</a></p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;1-技术背景：FaceBook-页面加载技术&quot;&gt;&lt;a href=&quot;#1-技术背景：FaceBook-页面加载技术&quot; class=&quot;headerlink&quot; title=&quot;1. 技术背景：FaceBook 页面加载技术&quot;&gt;&lt;/a&gt;1. 技术背景：FaceBook 页面加载技术&lt;/h2&gt;&lt;p&gt;试想这样一个场景，一个经常访问的网站，每次打开它的页面都要要花费 6 秒；同时另外一个网站提供了相似的服务，但响应时间只需 3 秒，那么你会如何选择呢？数据表明，如果用户打开一个网站，等待 3~4 秒还没有任何反应，他们会变得急躁，焦虑，抱怨，甚至关闭网页并且不再访问，这是非常糟糕的情况。所以，网页加载的速度十分重要,尤其对于拥有遍布全球的 5 亿用户的 Facebook(全球最大的社交服务网站)这样的大型网站，有着大量并发请求、海量数据等客观情况，速度就成了必须攻克的难题之一。&lt;br&gt;
    
    </summary>
    
      <category term="Javascript" scheme="http://zqianduan.com/categories/Javascript/"/>
    
    
      <category term="server" scheme="http://zqianduan.com/tags/server/"/>
    
  </entry>
  
  <entry>
    <title>利用 HTML 和 CSS 实现常见的布局</title>
    <link href="http://zqianduan.com/2016/03/10/html-css-layout/"/>
    <id>http://zqianduan.com/2016/03/10/html-css-layout/</id>
    <published>2016-03-10T14:50:59.000Z</published>
    <updated>2017-04-27T07:01:51.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="单列布局"><a href="#单列布局" class="headerlink" title="单列布局"></a>单列布局</h2><ol>
<li><p>水平居中</p>
<p> 水平居中的页面布局中最为常见的一种布局形式，多出现于标题，以及内容区域的组织形式，下面介绍四种实现水平居中的方法（注：下面各个实例中实现的是child元素的对齐操作，child元素的父容器是parent元素）</p>
<ul>
<li><p>使用 inline-block 和 text-align 实现</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.parent</span> &#123;</div><div class="line">    <span class="attribute">text-align</span>: center;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.child</span> &#123; </div><div class="line">    <span class="attribute">display</span>: inline-block;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>  优点：兼容性好；<br>  不足：需要同时设置子元素和父元素</p>
<a id="more"></a>
</li>
<li><p>使用 <code>margin:0 auto</code> 来实现</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.child</span> &#123;</div><div class="line">    <span class="attribute">width</span>: <span class="number">200px</span>; </div><div class="line">    <span class="attribute">margin</span>: <span class="number">0</span> auto;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>  优点：兼容性好<br>  缺点: 需要指定宽度</p>
</li>
<li><p>使用 table 实现</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.child</span> &#123;</div><div class="line">    <span class="attribute">display</span>: table; </div><div class="line">    <span class="attribute">margin</span>: <span class="number">0</span> auto;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>  优点：只需要对自身进行设置<br>  不足：IE6,7 需要调整结构</p>
</li>
<li><p>使用绝对定位实现</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.parent</span> &#123;</div><div class="line">    <span class="attribute">position</span>: relative;</div><div class="line">&#125;</div><div class="line"><span class="comment">/* 或者实用 margin-left 的负值为盒子宽度的一半也可以实现，不过这样就必须知道盒子的宽度，但兼容性好 */</span></div><div class="line"><span class="selector-class">.child</span> &#123;</div><div class="line">    <span class="attribute">position</span>: absolute; </div><div class="line">    <span class="attribute">left</span>: <span class="number">50%</span>; </div><div class="line">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(-50%);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>  不足：兼容性差，IE9 及以上可用</p>
</li>
<li><p>使用 flex 布局实现</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* 第一种方法 */</span></div><div class="line"><span class="selector-class">.parent</span> &#123;</div><div class="line">    <span class="attribute">display</span>:flex; </div><div class="line">    <span class="attribute">justify-content</span>: center;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/* 第二种方法 */</span></div><div class="line"><span class="selector-class">.parent</span> &#123;</div><div class="line">    <span class="attribute">display</span>: flex;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.child</span> &#123;</div><div class="line">    <span class="attribute">margin</span>:<span class="number">0</span> auto;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>  缺点：兼容性差，如果进行大面积的布局可能会影响效率</p>
</li>
</ul>
</li>
<li><p>垂直居中</p>
<ul>
<li><p>vertical-align</p>
<p>  我们都知道，每个人都有不同的嗜好，有的人喜欢吃甜食，有的人喜欢吃辣的东西，有的人不喜欢吃芹菜，有的人不喜欢吃羊肉等等。CSS 中的有些元素也是这样，他们有的只对牛奶感兴趣，有的只喜欢吃坚果和果冻，而讨厌牛奶。而 vertical-align 呢，是个比较挑食的家伙，它只喜欢吃果冻，从小吃果冻长大，没有了果冻，它就会闹脾气，对你不理不睬。我称之为“果冻依赖型元素”，又称之为“inline-block 依赖型元素”，也就是说,只有一个元素属于 inline 或是 inline-block（table-cell 也可以理解为 inline-block 水平）水平，其身上的 vertical-align 属性才会起作用（<a href="http://www.zhangxinxu.com/wordpress/2010/05/%E6%88%91%E5%AF%B9css-vertical-align%E7%9A%84%E4%B8%80%E4%BA%9B%E7%90%86%E8%A7%A3%E4%B8%8E%E8%AE%A4%E8%AF%86%EF%BC%88%E4%B8%80%EF%BC%89/" target="_blank" rel="external">参考</a>）</p>
<p>  在使用 vertical-align 的时候，由于对齐的基线是用行高的基线作为标记，故需要设置 line-height 或设置 <code>display: table-cell</code>;</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*第一种方法*/</span></div><div class="line"><span class="selector-class">.parent</span> &#123;</div><div class="line">    <span class="attribute">display</span>: table-cell;</div><div class="line">    <span class="attribute">vertical-align</span>: middle;</div><div class="line">    <span class="attribute">height</span>:<span class="number">20px</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">/*第二种方法*/</span></div><div class="line"><span class="selector-class">.parent</span> &#123;</div><div class="line">    <span class="attribute">display</span>: inline-block;</div><div class="line">    <span class="attribute">vertical-align</span>: middle;</div><div class="line">    <span class="attribute">line-height</span>: <span class="number">20px</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>利用绝对定位</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.parent</span> &#123;</div><div class="line">    <span class="attribute">position</span>: relative;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.child</span> &#123;</div><div class="line">    <span class="attribute">positon</span>: absolute; </div><div class="line">    <span class="attribute">top</span>: <span class="number">50%</span>; </div><div class="line">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(0,-50%);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>利用 flex 实现</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.parent</span> &#123;</div><div class="line">    <span class="attribute">display</span>: flex; </div><div class="line">    <span class="attribute">align-items</span>: center;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>水平垂直全部居中</p>
<ul>
<li><p>利用 vertical-align, text-align, inline-block 实现</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.parent</span> &#123;</div><div class="line">    <span class="attribute">display</span>: table-cell; </div><div class="line">    <span class="attribute">vertical-align</span>: middle; </div><div class="line">    <span class="attribute">text-align</span>: center;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.child</span> &#123;</div><div class="line">    <span class="attribute">display</span>: inline-block;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>利用绝对定位实现</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.parent</span> &#123;</div><div class="line">    <span class="attribute">position</span>: relative;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.child</span> &#123;</div><div class="line">    <span class="attribute">position</span>: absolute;</div><div class="line">    <span class="attribute">top</span>: <span class="number">50%</span>;</div><div class="line">    <span class="attribute">left</span>: <span class="number">50%</span>;</div><div class="line">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(-50%,-50%);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>利用 flex 实现</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.parent</span> &#123;</div><div class="line">    <span class="attribute">display</span>: flex; </div><div class="line">    <span class="attribute">justify-content</span>: center;</div><div class="line">    <span class="attribute">align-items</span>: center;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h2 id="多列布局"><a href="#多列布局" class="headerlink" title="多列布局"></a>多列布局</h2><ol>
<li><p>左列定宽，右列自适应</p>
<p> 该布局方式非常常见，适用于定宽的一侧常为导航，自适应的一侧为内容的布局</p>
<p> <img src="https://segmentfault.com/img/bVqEeN" alt="左列定宽，右列自适应"></p>
<ul>
<li><p>利用 float+margin 实现</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.left</span> &#123;</div><div class="line">    <span class="attribute">float</span>: left;</div><div class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.right</span> &#123;</div><div class="line">    <span class="attribute">margin-left</span>: <span class="number">100px</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>  <strong>注：IE6 会有 3px 的 bug</strong></p>
</li>
<li><p>利用 float+margin(fix) 实现</p>
<p>  <img src="https://segmentfault.com/img/bVqEh4" alt="利用 float+margin(fix) 实现"></p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"parent"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"left"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"right-fix"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"right"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.left</span> &#123;</div><div class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</div><div class="line">    <span class="attribute">float</span>: left;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.right-fix</span> &#123;</div><div class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</div><div class="line">    <span class="attribute">margin-left</span>: -<span class="number">100px</span>;</div><div class="line">    <span class="attribute">float</span>: right;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.right</span> &#123;</div><div class="line">    <span class="attribute">margin-left</span>: <span class="number">100px</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>利用 float+overflow 实现</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.left</span> &#123;</div><div class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</div><div class="line">    <span class="attribute">float</span>:left;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.right</span> &#123;</div><div class="line">    <span class="attribute">overflow</span>: hidden;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>  <code>overflow: hidden</code> 触发 bfc 模式，浮动无法影响，隔离其他元素，IE6 不支持（<a href="http://zqianduan.com/2016/03/08/bfc-haslayout/">关于BFC</a>）</p>
<p>  如果我们需要将两列设置为等高，可以用下述方法将“背景”设置为等高，其实并不是内容的等高</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.left</span> &#123;</div><div class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</div><div class="line">    <span class="attribute">float</span>: left;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.right</span> &#123;</div><div class="line">    <span class="attribute">height</span>: <span class="number">500px</span>;</div><div class="line">    <span class="attribute">overflow</span>: hidden;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.parent</span> &#123;</div><div class="line">    <span class="attribute">overflow</span>: hidden;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.left</span>, <span class="selector-class">.right</span> &#123;</div><div class="line">    <span class="attribute">padding-bottom</span>: <span class="number">9999px</span>;</div><div class="line">    <span class="attribute">margin-bottom</span>: -<span class="number">9999px</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>利用 table 实现</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.parent</span> &#123;</div><div class="line">    <span class="attribute">display</span>: table;</div><div class="line">    <span class="attribute">table-layout</span>: fixed;</div><div class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.left</span> &#123; </div><div class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.right</span>, <span class="selector-class">.left</span> &#123;</div><div class="line">    <span class="attribute">display</span>: table-cell;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>利用 flex 实现</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.parent</span> &#123;</div><div class="line">    <span class="attribute">display</span>: flex;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.left</span> &#123;</div><div class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.right</span> &#123;</div><div class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>  利用右侧容器的 flex:1，均分了剩余的宽度，也实现了同样的效果。而 align-items 默认值为 stretch，故二者高度相等</p>
</li>
</ul>
</li>
<li><p>右列定宽，左列自适应</p>
<ul>
<li><p>使用 float+margin 实现</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.parent</span> &#123;</div><div class="line">    <span class="attribute">background</span>: red;</div><div class="line">    <span class="attribute">height</span>: <span class="number">100px</span>;</div><div class="line">    <span class="attribute">margin</span>: <span class="number">0</span> auto;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.left</span> &#123;</div><div class="line">    <span class="attribute">background</span>: green;</div><div class="line">    <span class="attribute">margin-right</span>: -<span class="number">100px</span>;</div><div class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</div><div class="line">    <span class="attribute">float</span>:left;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.right</span> &#123;</div><div class="line">    <span class="attribute">float</span>: right;</div><div class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</div><div class="line">    <span class="attribute">background</span>: blue;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>使用 table 实现</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.parent</span> &#123;</div><div class="line">    <span class="attribute">display</span>: table;</div><div class="line">    <span class="attribute">table-layout</span>: fixed;</div><div class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.left</span> &#123;</div><div class="line">    <span class="attribute">display</span>: table-cell;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.right</span> &#123;</div><div class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</div><div class="line">    <span class="attribute">display</span>: table-cell;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>使用 flex 实现</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.parent</span> &#123;</div><div class="line">    <span class="attribute">display</span>: flex;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.left</span> &#123;</div><div class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.right</span> &#123;</div><div class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>两列定宽，一列自适应</p>
<p> <img src="https://segmentfault.com/img/bVqEJe" alt="两列定宽，一列自适应"></p>
<p> 基本 html 结构为父容器为 parent，自容器为 left, center, right. 其中，left, center 定宽，right 自适应</p>
<ul>
<li><p>利用 float+margin 实现</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.left</span>, <span class="selector-class">.center</span> &#123;</div><div class="line">    <span class="attribute">float</span>: left;</div><div class="line">    <span class="attribute">width</span>: <span class="number">200px</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.right</span> &#123;</div><div class="line">    <span class="attribute">margin-left</span>: <span class="number">400px</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>利用 float+overflow 实现</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.left</span>, <span class="selector-class">.center</span> &#123;</div><div class="line">    <span class="attribute">float</span>: left; </div><div class="line">    <span class="attribute">width</span>: <span class="number">200px</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.right</span> &#123;</div><div class="line">    <span class="attribute">overflow</span>: hidden;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>利用 table 实现</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.parent</span> &#123;</div><div class="line">    <span class="attribute">display</span>: table;</div><div class="line">    <span class="attribute">table-layout</span>: fixed;</div><div class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.left</span>, <span class="selector-class">.center</span>, <span class="selector-class">.right</span> &#123;</div><div class="line">    <span class="attribute">display</span>: table-cell;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.left</span>, <span class="selector-class">.center</span> &#123;</div><div class="line">    <span class="attribute">width</span>: <span class="number">200px</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>利用 flex 实现</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.parent</span> &#123;</div><div class="line">    <span class="attribute">display</span>: flex;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.left</span>, <span class="selector-class">.center</span> &#123;</div><div class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.right</span> &#123;</div><div class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>两侧定宽，中栏自适应</p>
<p> <img src="https://segmentfault.com/img/bVqEL8" alt="两侧定宽，中栏自适应"></p>
<ul>
<li><p>利用 float+margin 实现</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.left</span> &#123;</div><div class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</div><div class="line">    <span class="attribute">float</span>: left;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.center</span> &#123;</div><div class="line">    <span class="attribute">float</span>: left;</div><div class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</div><div class="line">    <span class="attribute">margin-right</span>: -<span class="number">200px</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.right</span> &#123;</div><div class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</div><div class="line">    <span class="attribute">float</span>: right;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>利用 table 实现</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.parent</span> &#123;</div><div class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</div><div class="line">    <span class="attribute">display</span>: table;</div><div class="line">    <span class="attribute">table-layout</span>: fixed;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.left</span>, <span class="selector-class">.center</span>, <span class="selector-class">.right</span> &#123;</div><div class="line">    <span class="attribute">display</span>: table-cell;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.left</span> &#123;</div><div class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.right</span> &#123;</div><div class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>利用 flex 实现</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.parent</span> &#123;</div><div class="line">    <span class="attribute">display</span>: flex;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.left</span> &#123;</div><div class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.center</span> &#123;</div><div class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.right</span> &#123;</div><div class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>一列不定宽，一列自适应</p>
<p> <img src="https://segmentfault.com/img/bVqEPt" alt="一列不定宽，一列自适应"></p>
<ul>
<li><p>利用 float+overflow 实现</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.left</span> &#123;</div><div class="line">    <span class="attribute">float</span>: left;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.right</span> &#123;</div><div class="line">    <span class="attribute">overflow</span>: hidden;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>利用 table 实现</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.parent</span> &#123;</div><div class="line">    <span class="attribute">display</span>: table;</div><div class="line">    <span class="attribute">table-layout</span>: fixed;</div><div class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.left</span> &#123;</div><div class="line">    <span class="attribute">width</span>: <span class="number">0.1%</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.left</span>, <span class="selector-class">.right</span> &#123;</div><div class="line">    <span class="attribute">display</span>: table-cell;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>利用 flex 实现</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.parent</span> &#123;</div><div class="line">    <span class="attribute">display</span>: flex;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.right</span> &#123;</div><div class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>多列等分布局</p>
<p> 多列等分布局常出现在内容中，多数为功能的，同阶级内容的并排显示等。</p>
<p> <img src="https://segmentfault.com/img/bVqEPQ" alt="多列等分布局"></p>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- Html 结构如下 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"parent"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"column"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"column"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"column"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"column"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li><p>使用 float 实现</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.parent</span> &#123;</div><div class="line">    <span class="comment">/* 假设列之间的间距为20px */</span></div><div class="line">    <span class="attribute">margin-left</span>: -<span class="number">20px</span></div><div class="line">&#125;</div><div class="line"><span class="selector-class">.column</span> &#123;</div><div class="line">    <span class="attribute">float</span>: left;</div><div class="line">    <span class="attribute">width</span>: <span class="number">25%</span>;</div><div class="line">    <span class="attribute">padding-left</span>: <span class="number">20px</span>;</div><div class="line">    <span class="attribute">box-sizing</span>: border-box;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>利用 table 实现</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.parent-fix</span> &#123;</div><div class="line">    <span class="attribute">margin-left</span>: -<span class="number">20px</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.parent</span> &#123;</div><div class="line">    <span class="attribute">display</span>: table;</div><div class="line">    <span class="attribute">table-layout</span>: fixed;</div><div class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.column</span> &#123;</div><div class="line">    <span class="attribute">display</span>: table-cell;</div><div class="line">    <span class="attribute">padding-left</span>: <span class="number">20px</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>利用 flex 实现</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.parent</span> &#123;</div><div class="line">    <span class="attribute">display</span>: flex;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.column</span> &#123;</div><div class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.column</span> + <span class="selector-class">.column</span> &#123;</div><div class="line">    <span class="attribute">margin-left</span>: <span class="number">20px</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>九宫格布局</p>
<ul>
<li><p>使用 table 实现</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"parent"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.parent</span> &#123;</div><div class="line">    <span class="attribute">display</span>: table;</div><div class="line">    <span class="attribute">table-layout</span>: fixed;</div><div class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.row</span> &#123;</div><div class="line">    <span class="attribute">display</span>: table-row;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.item</span> &#123;</div><div class="line">    <span class="attribute">display</span>: table-cell;</div><div class="line">    <span class="attribute">width</span>: <span class="number">33.3%</span>;</div><div class="line">    <span class="attribute">height</span>: <span class="number">200px</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>利用 flex 实现</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"parent"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.parent</span> &#123;</div><div class="line">    <span class="attribute">display</span>: flex;</div><div class="line">    <span class="attribute">flex-direction</span>: column;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.row</span> &#123;</div><div class="line">    <span class="attribute">height</span>: <span class="number">100px</span>;</div><div class="line">    <span class="attribute">display</span>: flex;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.item</span> &#123;</div><div class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</div><div class="line">    <span class="attribute">background</span>: red;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>全屏布局</p>
<p> <img src="https://segmentfault.com/img/bVqEZQ" alt="全屏布局"></p>
<ul>
<li><p>利用绝对定位实现</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"parent"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"top"</span>&gt;</span>top<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"left"</span>&gt;</span>left<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"right"</span>&gt;</span>right<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"bottom"</span>&gt;</span>bottom<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">html</span>, <span class="selector-tag">body</span>, <span class="selector-tag">parent</span> &#123;</div><div class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</div><div class="line">    <span class="attribute">overflow</span>: hidden;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.top</span> &#123;</div><div class="line">    <span class="attribute">position</span>: absolute; </div><div class="line">    <span class="attribute">top</span>: <span class="number">0</span>;</div><div class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</div><div class="line">    <span class="attribute">right</span>: <span class="number">0</span>;</div><div class="line">    <span class="attribute">height</span>: <span class="number">100px</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.left</span> &#123;</div><div class="line">    <span class="attribute">position</span>: absolute;</div><div class="line">    <span class="attribute">top</span>: <span class="number">100px</span>;</div><div class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</div><div class="line">    <span class="attribute">bottom</span>: <span class="number">50px</span>;</div><div class="line">    <span class="attribute">width</span>: <span class="number">200px</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.right</span> &#123;</div><div class="line">    <span class="attribute">position</span>: absolute;</div><div class="line">    <span class="attribute">overflow</span>: auto;</div><div class="line">    <span class="attribute">left</span>: <span class="number">200px</span>;</div><div class="line">    <span class="attribute">right</span>: <span class="number">0</span>;</div><div class="line">    <span class="attribute">top</span>: <span class="number">100px</span>;</div><div class="line">    <span class="attribute">bottom</span>: <span class="number">50px</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.bottom</span> &#123;</div><div class="line">    <span class="attribute">position</span>: absolute;</div><div class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</div><div class="line">    <span class="attribute">right</span>: <span class="number">0</span>;</div><div class="line">    <span class="attribute">bottom</span>: <span class="number">0</span>;</div><div class="line">    <span class="attribute">height</span>: <span class="number">50px</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>利用 flex 实现</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"parent"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"top"</span>&gt;</span>top<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"middle"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"left"</span>&gt;</span>left<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"right"</span>&gt;</span>right<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"bottom"</span>&gt;</span>bottom<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.parent</span> &#123;</div><div class="line">    <span class="attribute">display</span>: flex;</div><div class="line">    <span class="attribute">flex-direction</span>: column;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.top</span> &#123;</div><div class="line">    <span class="attribute">height</span>: <span class="number">100px</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.bottom</span> &#123;</div><div class="line">    <span class="attribute">height</span>: <span class="number">50px</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.middle</span> &#123;</div><div class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</div><div class="line">    <span class="attribute">display</span>: flex;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.left</span> &#123;</div><div class="line">    <span class="attribute">width</span>: <span class="number">200px</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.right</span> &#123;</div><div class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</div><div class="line">    <span class="attribute">overflow</span>: auto;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>响应式布局</p>
<ul>
<li><p>meta 标签的使用</p>
<p>  设置布局宽度等于设备宽度，布局 viewport 等于度量 viewport</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1"</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>媒体查询</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 语法 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></div><div class="line">    @<span class="keyword">media</span> screen and (max-width:<span class="number">960px</span>) &#123; </div><div class="line">        .... </div><div class="line">    &#125;</div><div class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">media</span>=<span class="string">"screen and (max-width:960px)"</span> <span class="attr">href</span>=<span class="string">'xxx.css'</span> /&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<blockquote>
<p>本文转载自：<a href="https://segmentfault.com/a/1190000003931851" target="_blank" rel="external">https://segmentfault.com/a/1190000003931851</a></p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;单列布局&quot;&gt;&lt;a href=&quot;#单列布局&quot; class=&quot;headerlink&quot; title=&quot;单列布局&quot;&gt;&lt;/a&gt;单列布局&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;p&gt;水平居中&lt;/p&gt;
&lt;p&gt; 水平居中的页面布局中最为常见的一种布局形式，多出现于标题，以及内容区域的组织形式，下面介绍四种实现水平居中的方法（注：下面各个实例中实现的是child元素的对齐操作，child元素的父容器是parent元素）&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;使用 inline-block 和 text-align 实现&lt;/p&gt;
  &lt;figure class=&quot;highlight css&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;selector-class&quot;&gt;.parent&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;attribute&quot;&gt;text-align&lt;/span&gt;: center;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;selector-class&quot;&gt;.child&lt;/span&gt; &amp;#123; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;attribute&quot;&gt;display&lt;/span&gt;: inline-block;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;  优点：兼容性好；&lt;br&gt;  不足：需要同时设置子元素和父元素&lt;/p&gt;
    
    </summary>
    
      <category term="HTML/CSS" scheme="http://zqianduan.com/categories/HTML-CSS/"/>
    
    
      <category term="layout" scheme="http://zqianduan.com/tags/layout/"/>
    
      <category term="flex" scheme="http://zqianduan.com/tags/flex/"/>
    
  </entry>
  
  <entry>
    <title>javascript 跨域总结</title>
    <link href="http://zqianduan.com/2016/03/09/js-cross-domain/"/>
    <id>http://zqianduan.com/2016/03/09/js-cross-domain/</id>
    <published>2016-03-09T02:42:04.000Z</published>
    <updated>2017-04-27T07:01:51.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="什么情况会跨域"><a href="#什么情况会跨域" class="headerlink" title="什么情况会跨域"></a>什么情况会跨域</h3><ol>
<li>主域不同</li>
<li>主域相同，子域不同</li>
<li>域名相同，协议不同（http / https）</li>
<li>域名相同，端口不同<a id="more"></a>
</li>
</ol>
<h3 id="跨域解决办法"><a href="#跨域解决办法" class="headerlink" title="跨域解决办法"></a>跨域解决办法</h3><ol>
<li><p><strong>document.domain + iframe</strong></p>
<p> 对于主域相同而子域不同的例子，可以通过设置 document.domain 的办法来解决。具体的做法如下：</p>
<p> 是可以在 a.com/a.html 和 1.a.com/b.html 两个文件中分别加上 <code>document.domain = &#39;a.com&#39;;</code> 然后通过 a.html 文件中创建一个 iframe，去控制 iframe 的 contentDocument，当然这种办法只能解决主域相同而二级域名不同的情况。</p>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- a.com/a.html --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">id</span>=<span class="string">'i'</span> <span class="attr">src</span>=<span class="string">"1.a.com"</span> <span class="attr">onload</span>=<span class="string">"do()"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="built_in">document</span>.domain = <span class="string">'a.com'</span>;</div><div class="line">    <span class="built_in">document</span>.getElementById(<span class="string">'i'</span>).contentWindow;</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 1.a.com/b.html --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="built_in">document</span>.domain = <span class="string">'a.com'</span>;</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p> 这样，就可以解决问题了。值得注意的是：<strong>document.domain 的设置是有限制的，只能设置为页面本身或者更高一级的域名</strong>。利用这种方法是极其方便的，<strong>但是如果一个网站被攻击之后另外一个网站很可能会引起安全漏洞</strong>。</p>
</li>
<li><p><strong>动态创建 script (jsonp)</strong></p>
<p> <code>JSONP</code> 的全称是 “JSON With Padding”， 词面意思上理解就是 “填充式的JSON”。由于浏览器的同源策略，使得在网页端出现了这个“跨域”的问题，然而我们发现，所有的 src 属性并没有受到相关的限制，比如 img / script 等，jsonp 就是利用了 <code>script</code> 可以执行其它域的 js 函数，比如这样：</p>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- a.com/a.html --&gt;</span></div><div class="line">...</div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">callback</span>(<span class="params">data</span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(data.url)</div><div class="line">    &#125;</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">'http://b.com/b.js'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">...</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- b.com/b.js --&gt;</span></div><div class="line">callback(&#123;url: 'http://www.rccoder.net'&#125;)</div></pre></td></tr></table></figure>
<p> 利用这一点，假如 b.js 里面的内容不是固定的，而是根据一些东西自动生成的， 嗯，这就是 JSONP 的主要原理了。回调函数+数据就是 JSON With Padding 了，回调函数用来响应应该在页面中调用的函数，数据则用来传入要执行的回调函数，至于这个数据是怎么产生的，无非就是服务端的字符串拼接了。</p>
<p> 以下是 jsonp 请求的实现：</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> loadJsonp = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> seq = <span class="keyword">new</span> <span class="built_in">Date</span>() * <span class="number">1</span>;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">url, params, callback</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> funName = <span class="string">'XYJsonp'</span> + seq++,</div><div class="line">            head = <span class="built_in">document</span>.getElementsByTagName(<span class="string">'head'</span>)[<span class="number">0</span>],</div><div class="line">            script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> params) &#123;</div><div class="line">            url += (<span class="regexp">/\?/</span>.test(url) ? <span class="string">'&amp;'</span>: <span class="string">'?'</span>) + key + <span class="string">'='</span> + <span class="built_in">encodeURIComponent</span>(params[key]);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        url += <span class="string">'&amp;callback='</span> + funName;</div><div class="line"></div><div class="line">        <span class="built_in">window</span>[funName] = <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</div><div class="line">            <span class="built_in">window</span>[funName] = <span class="literal">undefined</span>;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                <span class="keyword">delete</span> <span class="built_in">window</span>[funName];</div><div class="line">            &#125; </div><div class="line">            <span class="keyword">catch</span>(e) &#123;&#125;</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (head) &#123;</div><div class="line">                head.removeChild(script);</div><div class="line">            &#125;</div><div class="line">            callback(data);</div><div class="line">        &#125;;</div><div class="line"></div><div class="line">        script.charset = <span class="string">"UTF-8"</span>;</div><div class="line">        script.src = url;</div><div class="line">        head.appendChild(script);</div><div class="line">    &#125;;</div><div class="line">&#125; ());</div></pre></td></tr></table></figure>
<p> <strong>注意：JSONP的这种实现方式不受同源策略的影响，兼容性也很好；但是它之支持 GET 方式的请求，只支持 HTTP 请求这种特殊的情况，对于两个不同域之间两个页面的互相调用也是无能为力。</strong></p>
</li>
<li><p><strong>利用 iframe 和 location.hash</strong></p>
<p> 这个办法比较绕，把数据的变化显示在 url 的 hash 里面。原理是利用 location.hash 来进行传值。但是由于 chrome 和 IE 不允许修改 parent.location.hash 的值，所以需要再加一层。</p>
<p> a.html 和 b.html 进行数据交换：</p>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- a.com/a.html --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">startRequest</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> ifr = <span class="built_in">document</span>.createElement(<span class="string">'iframe'</span>);</div><div class="line">        ifr.style.display = <span class="string">'none'</span>;</div><div class="line">        ifr.src = <span class="string">'http://b.com/b.html#paramdo'</span>;</div><div class="line">        <span class="built_in">document</span>.body.appendChild(ifr);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">checkHash</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">var</span> data = location.hash ? location.hash.substring(<span class="number">1</span>) : <span class="string">''</span>;</div><div class="line">            <span class="keyword">if</span> (<span class="built_in">console</span>.log) &#123;</div><div class="line">                <span class="built_in">console</span>.log(<span class="string">'Now the data is '</span>+data);</div><div class="line">            &#125;</div><div class="line">        &#125; </div><div class="line">        <span class="keyword">catch</span>(e) &#123;&#125;;</div><div class="line">    &#125;</div><div class="line">    setInterval(checkHash, <span class="number">2000</span>);</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- b.com/b.html --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 模拟一个简单的参数处理操作</span></div><div class="line">    <span class="keyword">switch</span>(location.hash)&#123;</div><div class="line">        <span class="keyword">case</span> <span class="string">'#paramdo'</span>:</div><div class="line">            callBack();</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="string">'#paramset'</span>:</div><div class="line">            <span class="comment">//do something……</span></div><div class="line">            <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">callBack</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            parent.location.hash = <span class="string">'somedata'</span>;</div><div class="line">        &#125; </div><div class="line">        <span class="keyword">catch</span> (e) &#123;</div><div class="line">            <span class="comment">// ie、chrome 的安全机制无法修改 parent.location.hash，</span></div><div class="line">            <span class="comment">// 所以要利用一个中间域下的代理 iframe</span></div><div class="line">            <span class="keyword">var</span> ifrproxy = <span class="built_in">document</span>.createElement(<span class="string">'iframe'</span>);</div><div class="line">            ifrproxy.style.display = <span class="string">'none'</span>;</div><div class="line">            ifrproxy.src = <span class="string">'http://a.com/c.html#somedata'</span>; <span class="comment">// 注意该文件在 a.com 域下</span></div><div class="line">            <span class="built_in">document</span>.body.appendChild(ifrproxy);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- a.com/c.html --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// 因为 parent.parent 和自身属于同一个域，所以可以改变其 location.hash 的值</span></div><div class="line">    parent.parent.location.hash = self.location.hash.substring(<span class="number">1</span>);</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p><strong>window.name 实现跨域数据传输</strong></p>
<p> <code>window.name</code> 在一个窗口（标签）的生命周期之内是共享的，利用这点结合 iframe：当在 iframe 中加载新页面时，<code>name</code> 的属性值依旧保持不变。</p>
<p> 总结起来即：iframe 的 src 属性由外域转向本地域，跨域数据即由 iframe 的 window.name 从外域传递到本地域。这个就巧妙地绕过了浏览器的跨域访问限制，但同时它又是安全操作。</p>
<p> 需要3个文件：a.com/a.html, a.com/proxy.html, b.com/b.html</p>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- a.com/a.html --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="keyword">var</span> state = <span class="number">0</span>, </div><div class="line">        iframe = <span class="built_in">document</span>.createElement(<span class="string">'iframe'</span>),</div><div class="line">        loadfn = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">if</span> (state === <span class="number">1</span>) &#123;</div><div class="line">                <span class="keyword">var</span> data = iframe.contentWindow.name;    <span class="comment">// 读取数据</span></div><div class="line">                alert(data);    <span class="comment">//弹出'I was there!'</span></div><div class="line">            &#125; </div><div class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (state === <span class="number">0</span>) &#123;</div><div class="line">                state = <span class="number">1</span>;</div><div class="line">                iframe.contentWindow.location = <span class="string">"http://a.com/proxy.html"</span>;    <span class="comment">// 设置的代理文件</span></div><div class="line">            &#125;  </div><div class="line">        &#125;;</div><div class="line"></div><div class="line">    iframe.src = <span class="string">'http://b.com/b.html'</span>;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (iframe.attachEvent) &#123;</div><div class="line">        iframe.attachEvent(<span class="string">'onload'</span>, loadfn);</div><div class="line">    &#125; </div><div class="line">    <span class="keyword">else</span> &#123;</div><div class="line">        iframe.onload  = loadfn;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="built_in">document</span>.body.appendChild(iframe);</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- b.com/b.html --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="built_in">window</span>.name = <span class="string">'I was there!'</span>;    </div><div class="line">    <span class="comment">// 这里是要传输的数据，大小一般为2M，IE和firefox下可以大至32M左右</span></div><div class="line">    <span class="comment">// 数据格式可以自定义，如json、字符串</span></div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p> proxy 是一个代理文件，空的就可以，需要和 a 在同一域下</p>
</li>
<li><p><strong>利用 HTML5 postMessage</strong></p>
<p> <code>window.postMessage</code> 是 HTML5 新增 API 之一，可以用来向其他所有的 window 对象发送消息。需要注意的是我们必须要保证所有的脚本执行完才发送 MessageEvent，如果在函数执行的过程中调用了他，就会让后面的函数超时无法执行。</p>
<p> 下一代浏览器支持这个功能 Chrome 2.0+, Internet Explorer 8.0+, Firefox 1.0+, Opera 9.6+, 和 Safari 4.0+ 。</p>
<p> 参考资料：</p>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/window.postMessage" target="_blank" rel="external">https://developer.mozilla.org/en-US/docs/Web/API/window.postMessage</a></li>
</ul>
</li>
<li><p><strong>CORS</strong></p>
<p> CORS 的全称是 Cross-Origin Resource Sharing，即跨域资源共享。他的原理就是使用自定义的 HTTP 头部，让服务器与浏览器进行沟通，主要是通过设置响应头的 Access-Control-Allow-Origin 来达到目的，这样，XMLHttpRequest 就能跨域了。</p>
<p> 参考资料：</p>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS" target="_blank" rel="external">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS</a></li>
</ul>
</li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;什么情况会跨域&quot;&gt;&lt;a href=&quot;#什么情况会跨域&quot; class=&quot;headerlink&quot; title=&quot;什么情况会跨域&quot;&gt;&lt;/a&gt;什么情况会跨域&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;主域不同&lt;/li&gt;
&lt;li&gt;主域相同，子域不同&lt;/li&gt;
&lt;li&gt;域名相同，协议不同（http / https）&lt;/li&gt;
&lt;li&gt;域名相同，端口不同
    
    </summary>
    
      <category term="Javascript" scheme="http://zqianduan.com/categories/Javascript/"/>
    
    
      <category term="jsonp" scheme="http://zqianduan.com/tags/jsonp/"/>
    
      <category term="iframe" scheme="http://zqianduan.com/tags/iframe/"/>
    
  </entry>
  
  <entry>
    <title>圣杯布局</title>
    <link href="http://zqianduan.com/2016/03/08/holy-grail-layout/"/>
    <id>http://zqianduan.com/2016/03/08/holy-grail-layout/</id>
    <published>2016-03-08T09:01:08.000Z</published>
    <updated>2017-04-27T07:01:51.000Z</updated>
    
    <content type="html"><![CDATA[<p>经典的三列布局，也叫做圣杯布局 <strong>Holy Grail of Layouts</strong>，是Kevin Cornell在2006年提出的一个布局模型概念，在国内最早是由淘宝UED的工程师传播开来，在中国也有叫法是双飞翼布局，它的布局要求有几点：</p>
<ol>
<li><p>三列布局，中间宽度自适应，两边定宽</p>
</li>
<li><p>中间栏要在浏览器中优先展示渲染</p>
</li>
<li><p>允许任意列的高度最高</p>
<a id="more"></a>
</li>
<li><p>要求只用一个额外的 div 标签</p>
</li>
<li><p>要求用最少的 CSS，最少的 Hack 语句</p>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"header"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrap"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"center"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"left"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"right"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"footer"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
 <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.wrap</span> &#123;</div><div class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">100px</span> <span class="number">0</span> <span class="number">120px</span>; </div><div class="line">    <span class="attribute">overflow</span>: hidden; </div><div class="line">    <span class="attribute">zoom</span>: <span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.center</span>, <span class="selector-class">.left</span>, <span class="selector-class">.right</span> &#123;</div><div class="line">    <span class="attribute">float</span>: left; </div><div class="line">    <span class="attribute">height</span>: <span class="number">200px</span>; </div><div class="line">    <span class="attribute">padding-bottom</span>: <span class="number">9999px</span>; </div><div class="line">    <span class="attribute">margin-bottom</span>: -<span class="number">9999px</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.center</span> &#123;</div><div class="line">    <span class="attribute">width</span>: <span class="number">100%</span>; </div><div class="line">    <span class="attribute">background</span>: <span class="number">#eee</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.left</span> &#123;</div><div class="line">    <span class="attribute">width</span>: <span class="number">120px</span>; </div><div class="line">    <span class="attribute">margin-left</span>: -<span class="number">100%</span>; </div><div class="line">    <span class="attribute">background</span>: <span class="number">#ace</span>; </div><div class="line">    <span class="attribute">position</span>: relative; </div><div class="line">    <span class="attribute">left</span>: -<span class="number">120px</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.right</span> &#123;</div><div class="line">    <span class="attribute">width</span>: <span class="number">100px</span>; </div><div class="line">    <span class="attribute">margin-left</span>: -<span class="number">100px</span>; </div><div class="line">    <span class="attribute">background</span>: <span class="number">#f50</span>; </div><div class="line">    <span class="attribute">position</span>: relative; </div><div class="line">    <span class="attribute">right</span>: -<span class="number">100px</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;经典的三列布局，也叫做圣杯布局 &lt;strong&gt;Holy Grail of Layouts&lt;/strong&gt;，是Kevin Cornell在2006年提出的一个布局模型概念，在国内最早是由淘宝UED的工程师传播开来，在中国也有叫法是双飞翼布局，它的布局要求有几点：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;三列布局，中间宽度自适应，两边定宽&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;中间栏要在浏览器中优先展示渲染&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;允许任意列的高度最高&lt;/p&gt;
    
    </summary>
    
      <category term="Snippet" scheme="http://zqianduan.com/categories/Snippet/"/>
    
    
      <category term="layout" scheme="http://zqianduan.com/tags/layout/"/>
    
      <category term="css" scheme="http://zqianduan.com/tags/css/"/>
    
  </entry>
  
</feed>
